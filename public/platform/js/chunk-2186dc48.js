(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2186dc48","chunk-748b470d"],{"0bd7":function(t,e,i){"use strict";i("8ac0")},"4bb5d":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var a=i("ea87");function s(t){if(Array.isArray(t))return Object(a["a"])(t)}i("6073"),i("2c5c"),i("c5cb"),i("36fa"),i("02bf"),i("a617"),i("17c8");function o(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}var n=i("9877");function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){return s(t)||o(t)||Object(n["a"])(t)||r()}},"8ac0":function(t,e,i){},fa54:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mt-10 mb-20 mh-full",on:{click:function(e){t.act_price_visible=!1,t.act_stock_num_visible=!1}}},[e("a-form-model",t._b({ref:"form",attrs:{model:t.formData,rules:t.rules}},"a-form-model",{labelCol:{span:4},wrapperCol:{span:10}},!1),[e("a-card",{attrs:{title:"基本信息",bordered:!1}},[e("a-form-model-item",{attrs:{label:"活动时间",required:""}},[e("a-form-model-item",{ref:"startTime",style:{display:"inline-block"},attrs:{prop:"start_time",autoLink:!1}},[e("a-date-picker",{attrs:{disabled:2==t.formData.status||1==t.formData.status,"show-time":"",format:"YYYY-MM-DD HH:mm:ss","disabled-date":t.disabledStartDate,placeholder:"请选择活动开始时间",getCalendarContainer:function(t){return t.parentNode}},on:{change:t.onDateStartChange},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}})],1),e("span",{style:{display:"inline-block",width:"24px",textAlign:"center"}},[t._v(" - ")]),e("a-form-model-item",{ref:"endTime",style:{display:"inline-block"},attrs:{prop:"end_time",autoLink:!1}},[e("a-date-picker",{attrs:{disabled:2==t.formData.status,"show-time":"",format:"YYYY-MM-DD HH:mm:ss","disabled-date":t.disabledEndDate,placeholder:"请选择活动结束时间",getCalendarContainer:function(t){return t.parentNode}},on:{change:t.onDateEndChange},model:{value:t.end_time,callback:function(e){t.end_time=e},expression:"end_time"}})],1)],1),e("a-form-model-item",{attrs:{label:"拼团有效时间",prop:"affect_time",help:"邀请好友参与拼团有效时间"}},[e("a-row",{attrs:{type:"flex"}},[e("a-col",{attrs:{span:8}},[e("a-select",{staticStyle:{width:"80%"},attrs:{disabled:2==t.formData.status,placeholder:"请选择",value:t.affect_time.day||0===t.affect_time.day?t.affect_time.day:"请选择",getPopupContainer:function(t){return t.parentNode}},on:{change:function(e){return t.affectTimeChange(e,"day")}}},t._l(t.dayOptions,(function(i,a){return e("a-select-option",{key:i,attrs:{value:a}},[t._v(" "+t._s(a)+" ")])})),1),e("span",{staticClass:"ml-10"},[t._v("天")])],1),e("a-col",{attrs:{span:8}},[e("a-select",{staticStyle:{width:"80%"},attrs:{disabled:2==t.formData.status,placeholder:"请选择",value:t.affect_time.hours||0===t.affect_time.hours?t.affect_time.hours:"请选择",getPopupContainer:function(t){return t.parentNode}},on:{change:function(e){return t.affectTimeChange(e,"hours")}}},t._l(25,(function(i,a){return e("a-select-option",{key:i,attrs:{value:a}},[t._v(" "+t._s(a>9?a:"0"+a)+" ")])})),1),e("span",{staticClass:"ml-10"},[t._v("时")])],1),e("a-col",{attrs:{span:8}},[e("a-select",{staticStyle:{width:"80%"},attrs:{disabled:2==t.formData.status,placeholder:"请选择",value:t.affect_time.minutes||0===t.affect_time.minutes?t.affect_time.minutes:"请选择",getPopupContainer:function(t){return t.parentNode}},on:{change:function(e){return t.affectTimeChange(e,"minutes")}}},t._l(61,(function(i,a){return e("a-select-option",{key:i,attrs:{value:a}},[t._v(" "+t._s(a>9?a:"0"+a)+" ")])})),1),e("span",{staticClass:"ml-10"},[t._v("分")])],1)],1)],1),e("a-form-model-item",{attrs:{label:"拼团人数",prop:"complete_num"}},[e("a-input-number",{staticStyle:{width:"180px"},attrs:{min:2,max:100,placeholder:"请输入2-100人"},model:{value:t.formData.complete_num,callback:function(e){t.$set(t.formData,"complete_num",e)},expression:"formData.complete_num"}})],1),e("a-form-model-item",{attrs:{label:"模拟参团",prop:"is_open_group",help:"模拟参与用户拼团，提高成交量"}},[e("a-switch",{attrs:{"checked-children":"开","un-checked-children":"关","default-checked":""},on:{click:t.openGroupChange},model:{value:t.formData.is_open_group,callback:function(e){t.$set(t.formData,"is_open_group",e)},expression:"formData.is_open_group"}})],1),e("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:t.formData.is_open_group,expression:"formData.is_open_group"}],attrs:{label:"","wrapper-col":{span:18,offset:4}}},[e("a-radio-group",{staticStyle:{width:"100%"},on:{change:t.machineIntoCheck},model:{value:t.simulate_group_radio,callback:function(e){t.simulate_group_radio=e},expression:"simulate_group_radio"}},[e("a-row",{attrs:{type:"flex",align:"middle"}},[e("a-col",{attrs:{span:6}},[e("a-radio",{attrs:{value:1}},[t._v(" 所有未拼成的团 ")])],1),e("a-col",{attrs:{span:18}},[e("div",{staticClass:"flex align-center"},[e("span",{staticClass:"mr-10"},[t._v("用户开团后")]),e("a-form-model-item",{staticClass:"simulate-group-num",attrs:{label:"",prop:"all_machine_into_time"}},[e("a-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",value:t.all_noGroup_time.hours||0===t.all_noGroup_time.hours?t.all_noGroup_time.hours:"请选择",getPopupContainer:function(t){return t.parentNode}},on:{change:function(e){return t.machineIntoTime(e,"hours",1)}}},t._l(25,(function(i,a){return e("a-select-option",{key:i,attrs:{value:a}},[t._v(" "+t._s(a>9?a:"0"+a)+" ")])})),1),e("span",{staticClass:"ml-10 mr-10"},[t._v("时")]),e("a-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",value:t.all_noGroup_time.minutes||0===t.all_noGroup_time.minutes?t.all_noGroup_time.minutes:"请选择",getPopupContainer:function(t){return t.parentNode}},on:{change:function(e){return t.machineIntoTime(e,"minutes",1)}}},t._l(61,(function(i,a){return e("a-select-option",{key:i,attrs:{value:a}},[t._v(" "+t._s(a>9?a:"0"+a)+" ")])})),1),e("span",{staticClass:"ml-10"},[t._v("分")]),e("span",{staticClass:"ml-10"},[t._v("进行模拟拼团")])],1)],1)])],1),e("a-row",{staticClass:"mt-10",attrs:{type:"flex",align:"middle"}},[e("a-col",{staticClass:"flex align-center",attrs:{span:6}},[e("a-form-model-item",{staticClass:"simulate-group-num",attrs:{label:"",prop:"simulate_group_num"}},[e("a-radio",{attrs:{value:2}},[t._v("参团人数大于等于")]),e("a-input-number",{attrs:{min:0},model:{value:t.formData.simulate_group_num,callback:function(e){t.$set(t.formData,"simulate_group_num",e)},expression:"formData.simulate_group_num"}}),e("span",{staticClass:"ml-10"},[t._v("的团")])],1)],1),e("a-col",{attrs:{span:18}},[e("div",{staticClass:"flex align-center"},[e("span",{staticClass:"mr-10"},[t._v("用户开团后")]),e("a-form-model-item",{staticClass:"simulate-group-num",attrs:{label:"",prop:"machine_into_time"}},[e("a-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",value:t.simulate_group_time.hours||0===t.simulate_group_time.hours?t.simulate_group_time.hours:0,getPopupContainer:function(t){return t.parentNode}},on:{change:function(e){return t.machineIntoTime(e,"hours",2)}}},t._l(25,(function(i,a){return e("a-select-option",{key:i,attrs:{value:a}},[t._v(" "+t._s(a>9?a:"0"+a)+" ")])})),1),e("span",{staticClass:"ml-10 mr-10"},[t._v("时")]),e("a-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",value:t.simulate_group_time.minutes||0===t.simulate_group_time.minutes?t.simulate_group_time.minutes:0,getPopupContainer:function(t){return t.parentNode}},on:{change:function(e){return t.machineIntoTime(e,"minutes",2)}}},t._l(61,(function(i,a){return e("a-select-option",{key:i,attrs:{value:a}},[t._v(" "+t._s(a>9?a:"0"+a)+" ")])})),1),e("span",{staticClass:"ml-10"},[t._v("分")]),e("span",{staticClass:"ml-10"},[t._v("进行模拟拼团")])],1)],1)])],1)],1)],1)],1),e("a-card",{staticStyle:{"margin-top":"10px"},attrs:{title:"优惠信息",bordered:!1}},[e("a-form-model-item",{attrs:{label:"优惠是否同享",prop:"is_discount_share"}},[e("a-radio-group",{model:{value:t.formData.is_discount_share,callback:function(e){t.$set(t.formData,"is_discount_share",e)},expression:"formData.is_discount_share"}},[e("a-radio",{attrs:{value:1}},[t._v(" 是 ")]),e("a-radio",{attrs:{value:2}},[t._v(" 否 ")])],1),1==t.formData.is_discount_share?e("div",[e("a-checkbox-group",{model:{value:t.formData.share_discount,callback:function(e){t.$set(t.formData,"share_discount",e)},expression:"formData.share_discount"}},[e("a-checkbox",{attrs:{value:"1"}},[t._v(" 商家会员卡 ")]),e("a-checkbox",{attrs:{value:"2"}},[t._v(" 商家优惠券 ")])],1)],1):t._e()],1),e("a-form-model-item",{attrs:{label:"限购",prop:"limit_num",help:"0代表不限购，请输入0~999正整数"}},[e("span",{staticClass:"mr-10"},[t._v("每人限购")]),e("a-input-number",{attrs:{min:0,max:999},model:{value:t.formData.limit_num,callback:function(e){t.$set(t.formData,"limit_num",e)},expression:"formData.limit_num"}}),e("span",{staticClass:"ml-10"},[t._v("单")])],1)],1),e("a-card",{staticStyle:{"margin-top":"10px"},attrs:{title:"商品信息",bordered:!1}},[e("a-form-model-item",{attrs:{label:"活动商品",prop:"goods_info"}},[e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.addProduct()}}},[t._v(" 添加商品 ")]),t.goodsList.length?[e("span",{on:{click:function(t){t.stopPropagation()}}},[e("a-popconfirm",{attrs:{placement:"top","ok-text":"确认","cancel-text":"取消",visible:t.act_price_visible,getPopupContainer:function(t){return t.parentNode}},on:{cancel:function(e){t.act_price="",t.act_price_visible=!1},confirm:function(e){return e.stopPropagation(),t.batchSet(e,"act_price")}}},[e("template",{slot:"title"},[e("a-input-number",{attrs:{suffix:"元",prefix:""},model:{value:t.act_price,callback:function(e){t.act_price=e},expression:"act_price"}})],1),e("a-button",{staticClass:"ml-20",on:{click:function(e){e.stopPropagation(),t.act_price_visible=!t.act_price_visible,t.act_stock_num_visible=!1,t.act_price=""}}},[t._v(" 设置拼团价 ")])],2)],1),e("span",{on:{click:function(t){t.stopPropagation()}}},[e("a-popconfirm",{attrs:{placement:"top","ok-text":"确认","cancel-text":"取消",visible:t.act_stock_num_visible,getPopupContainer:function(t){return t.parentNode}},on:{cancel:function(e){e.stopPropagation(),t.act_stock_num="",t.act_stock_num_visible=!1},confirm:function(e){return e.stopPropagation(),t.batchSet(e,"act_stock_num")}}},[e("template",{slot:"title"},[e("a-input-number",{model:{value:t.act_stock_num,callback:function(e){t.act_stock_num=e},expression:"act_stock_num"}})],1),e("a-button",{staticClass:"ml-20",on:{click:function(e){e.stopPropagation(),t.act_stock_num_visible=!t.act_stock_num_visible,t.act_price_visible=!1,t.act_stock_num=""}}},[t._v(" 设置活动库存 ")])],2)],1)]:t._e()],2),e("a-form-model-item",{attrs:{"wrapper-col":{span:20,offset:4}}},[t.goodsList&&t.goodsList.length?e("a-table",{staticClass:"mt-20",attrs:{columns:t.columns,"data-source":t.goodsList,rowKey:"goods_id",childrenColumnName:"children",defaultExpandAllRows:!0,scroll:{x:!1},pagination:!1},scopedSlots:t._u([{key:"name",fn:function(i,a){return e("span",{},[e("a-avatar",{attrs:{shape:"square",size:64,src:a.image}}),e("span",{staticClass:"ml-10 name"},[t._v(t._s(i))])],1)}},{key:"skuStr",fn:function(i,a){return e("span",{},[a.sku_info&&"sku"==a.goods_type?e("span",[t._v(" 多规格 ")]):e("span",[t._v(" "+t._s(i||"----")+" ")])])}},{key:"actStockNum",fn:function(i,a){return e("span",{},[a.sku_info&&a.sku_info.length&&a.sku_info.length>1?e("span",[t._v(" ---- ")]):e("span",[e("a-form-item",{staticStyle:{margin:"-5px 0"},attrs:{prop:"act_stock_num"}},[-1==a.stock_num?e("a-input-number",{attrs:{min:-1},on:{change:function(e){return t.handleChange(a.act_stock_num,a,"act_stock_num")}},model:{value:a.act_stock_num,callback:function(e){t.$set(a,"act_stock_num",e)},expression:"record.act_stock_num"}}):e("a-input-number",{attrs:{max:a.stock_num-0,min:0},on:{change:function(e){return t.handleChange(a.act_stock_num,a,"act_stock_num")}},model:{value:a.act_stock_num,callback:function(e){t.$set(a,"act_stock_num",e)},expression:"record.act_stock_num"}})],1)],1)])}},{key:"price",fn:function(i,a){return e("span",{staticClass:"cr-red"},[a.sku_info&&"sku"==a.goods_type?e("span",[t._v(" ￥"+t._s(a.min_price)+" ~ ￥"+t._s(a.max_price)+" ")]):e("span",[t._v(" ￥"+t._s(i)+" ")])])}},{key:"actPrice",fn:function(i,a){return e("span",{},[a.sku_info&&a.sku_info.length&&a.sku_info.length>1?e("span",[t._v(" ---- ")]):e("span",[e("a-form-item",{staticStyle:{margin:"-5px 0"},attrs:{prop:"act_price"}},[e("a-input-number",{attrs:{min:0,max:a.price-0},on:{change:function(e){return t.handleChange(a.act_price,a,"act_price")}},model:{value:a.act_price,callback:function(e){t.$set(a,"act_price",e)},expression:"record.act_price"}})],1)],1)])}},{key:"action",fn:function(i,a){return e("span",{},[a.sku_id?t._e():e("a",{staticClass:"ml-10 inline-block",on:{click:function(e){return t.removeGoods(a)}}},[t._v("删除")])])}}],null,!1,748920878)},[e("span",{attrs:{slot:"actStockNumTitle"},slot:"actStockNumTitle"},[t._v(" 活动库存 "),e("a-tooltip",{attrs:{trigger:"hover"}},[e("template",{slot:"title"},[t._v("设置每个sku的活动库存，活动库存不能大于当前库存，-1代表无限量库存")]),e("a-icon",{staticClass:"ml-10",attrs:{type:"question-circle"}})],2)],1),e("span",{attrs:{slot:"actPriceTitle"},slot:"actPriceTitle"},[t._v(" 拼团价 "),e("a-tooltip",{attrs:{trigger:"hover"}},[e("template",{slot:"title"},[t._v("设置每个商品的拼团价，拼团价不可大于原价格")]),e("a-icon",{staticClass:"ml-10",attrs:{type:"question-circle"}})],2)],1)]):t._e(),t.dataSource.length?e("div",{staticClass:"pagination-wrap"},[e("a-pagination",{attrs:{size:"middle",pageSize:t.pageSize,pageSizeOptions:t.sizeList,total:t.total,showSizeChanger:"",showQuickJumper:""},on:{change:t.pageNumberChange,showSizeChange:t.sizeChange},model:{value:t.current,callback:function(e){t.current=e},expression:"current"}})],1):t._e()],1),e("a-form-model-item",{attrs:{label:"团长价",prop:"team_discount_price",help:"仅用于开团的用户，在拼团价的基础上再次优惠的金额，未填写或填写为0代表未开启团长价"}},[e("span",{staticClass:"mr-10"},[t._v("优惠")]),e("a-input-number",{attrs:{min:0,max:t.min_act_price-0},model:{value:t.formData.team_discount_price,callback:function(e){t.$set(t.formData,"team_discount_price",e)},expression:"formData.team_discount_price"}})],1)],1),2!=t.formData.status?e("a-form-model-item",{attrs:{"wrapper-col":{span:16,offset:2}}},[e("div",{staticClass:"mt-20 mb-20"},[e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.saveData()}}},[t._v(" 保存 ")])],1)]):t._e()],1),e("select-goods",{ref:"selectGoods",attrs:{storeId:t.store_id,source:"group",type:"radio",startTime:t.formData.start_time,endTime:t.formData.end_time,selectedList:t.goodsList},on:{submit:t.selecrGoodsSubmit}})],1)},s=[],o=i("4bb5d"),n=(i("075f"),i("c5cb"),i("08c7"),i("54f8"),i("cd5d"),i("9ae4"),i("4afa"),i("3849"),i("19f1"),i("4031")),r=i("2f42"),c=i.n(r),u=i("37fd"),_=i("ac0d"),m={name:"GroupEdit",mixins:[_["d"]],components:{SelectGoods:u["default"]},data:function(){return{store_id:"",id:"",formData:{start_time:"",end_time:"",complete_num:"",is_open_group:!0,simulate_group_num:"",machine_into_time:"",all_machine_into_time:"",limit_num:0,is_discount_share:1,share_discount:[],team_discount_price:0,affect_time:"",goods_info:""},simulate_group_radio:1,all_machine_into_time:"",machine_into_time:"",rules:{start_time:[{required:!0,message:"请选择活动开始时间",trigger:["blur","change"]}],end_time:[{required:!0,message:"请选择活动结束时间",trigger:["blur","change"]}],complete_num:[{required:!0,message:"请输入拼团人数",trigger:["blur","change"]}],is_discount_share:[{required:!0,message:"请选择优惠是否同享",trigger:["blur","change"]}],affect_time:[{required:!0,message:"请选择拼团有效时间",trigger:["blur","change"]}],act_stock_num:[{required:!0,message:"请输入商品活动库存",trigger:["blur","change"]}],act_price:[{required:!0,message:"请输入商品拼团价",trigger:["blur","change"]}],is_open_group:[{required:!0,message:"",trigger:["blur","change"]}],goods_info:[{required:!0,message:"请添加活动商品",trigger:["blur","change"]}]},columns:[{title:"商品信息",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"规格",dataIndex:"sku_str",scopedSlots:{customRender:"skuStr"}},{title:"当前库存",dataIndex:"stock_num",scopedSlots:{customRender:"stockNum"}},{dataIndex:"act_stock_num",key:"act_stock_num",slots:{title:"actStockNumTitle"},scopedSlots:{customRender:"actStockNum"}},{title:"原价格",dataIndex:"price",scopedSlots:{customRender:"price"}},{dataIndex:"act_price",key:"act_price",slots:{title:"actPriceTitle"},scopedSlots:{customRender:"actPrice"}},{title:"操作",dataIndex:"goods_id",width:"100px",scopedSlots:{customRender:"action"}}],goodsList:[],act_price:"",act_stock_num:"",min_act_price:0,affect_time:{day:"",hours:"",minutes:""},all_noGroup_time:{hours:"",minutes:""},simulate_group_time:{hours:"",minutes:""},act_price_visible:!1,act_stock_num_visible:!1,sizeList:["5","10","20","30"],pageSize:10,current:1,total:0,dataSource:[],showSource:[],start_time:null,end_time:null}},watch:{"$route.path":function(t){"/merchant/merchant.mall/editGroup"==t&&this.resetForm()},"$route.query.store_id":function(t){t&&(this.store_id=t,this.resetForm())},"$route.query.id":function(t){var e=this;this.$nextTick((function(){e.activatedFlag&&t?(e.id=t,e.resetForm(),e.getFormData()):(e.id="",e.resetForm())}))}},computed:{dayOptions:function(){var t=7;if(this.start_time&&this.end_time){var e=c()(this.start_time),i=c()(this.end_time),a=i.format("x")-e.format("x"),s=c.a.duration(a);t=s.days()+1>6?7:s.days()+2}var o=this.affect_time.day;return o&&o>t&&this.$set(this.affect_time,"day",""),t}},created:function(){this.store_id=this.$route.query.store_id,this.resetForm(),this.$route.query.id&&(this.id=this.$route.query.id,this.getFormData())},mounted:function(){console.log(this.$route.query.id,"id---mounted")},methods:{moment:c.a,disabledStartDate:function(t){return!this.$route.query.id&&(t&&t<c()().subtract(1,"days"))},disabledEndDate:function(t){var e=this.start_time;return e?e.valueOf()>=t.valueOf():t&&t<c()().subtract(1,"days")},onDateStartChange:function(t,e){this.$set(this.formData,"start_time",e),this.$refs.startTime.onFieldChange()},onDateEndChange:function(t,e){var i=c()(this.formData.start_time).valueOf(),a=c()(e).valueOf();a<i?this.$message.error("活动结束时间必须大于活动开始时间！"):(this.$set(this.formData,"end_time",e),this.$refs.endTime.onFieldChange())},getFormData:function(){var t=this;this.request(n["a"].getGroupInfo,{id:this.id}).then((function(e){console.log("res-----------1",e),t.start_time=c()(e.start_time),t.end_time=c()(e.end_time),1==e.is_discount_share&&(e.share_discount=[],1==e.discount_card&&e.share_discount.push("1"),1==e.discount_coupon&&e.share_discount.push("2")),e.affect_time&&(t.affect_time=t.timeStamp(e.affect_time),console.log(t.affect_time,"this.affect_time")),e.is_open_group&&1==e.is_open_group?e.is_open_group=!0:e.is_open_group=!1,e.simulate_group_num&&0!=e.simulate_group_num?(t.simulate_group_time=t.timeStamp(e.machine_into_time),t.machine_into_time=e.machine_into_time,t.simulate_group_radio=2):(t.all_noGroup_time=t.timeStamp(e.machine_into_time),t.all_machine_into_time=e.machine_into_time,t.simulate_group_radio=1),console.log(t.all_machine_into_time,"this.all_machine_into_time"),t.$set(t,"formData",e),console.log(t.formData);var i=e.goods_info||[];t.goodsList=i.length?i.map((function(e){if(e.type="group",e.sku_info&&e.sku_info.length&&e.sku_info.length>1&&(e.children=[],e.sku_info.forEach((function(i){i.name=e.name,i.image=e.image,i.act_stock_num||(i.act_stock_num=0),i.act_price||(i.act_price=0),(0==t.min_act_price||t.min_act_price>i.act_price)&&(t.min_act_price=i.act_price),e.children.push(i)}))),e.sku_info&&e.sku_info.length&&1==e.sku_info.length){var i=e.sku_info[0];for(var a in i)e[a]=i[a];(0==t.min_act_price||t.min_act_price>e.act_price)&&(t.min_act_price=e.act_price)}return e.sku_info&&!e.sku_info.length&&(e.sku_info=""),e})):[],console.log(t.goodsList,"this.goodsList"),t.dataSource=t.goodsList&&t.goodsList.length&&t.goodsList[0].sku_info||[],t.dataSourceChange()}))},pageNumberChange:function(t,e){var i=this;this.current=t,this.pageSize=e,this.showSource=this.getShowSource(),console.log(this.showSource,"this.showSource"),this.goodsList=this.goodsList.filter((function(t){return t.sku_info=i.showSource,t})),console.log(this.goodsList,"this.goodsList---goodsList---showSource")},sizeChange:function(t,e){var i=this;this.current=t,this.pageSize=e,this.showSource=this.getShowSource(),this.goodsList=this.goodsList.filter((function(t){return t.sku_info=i.showSource,t}))},getShowSource:function(){for(var t=0,e=this.dataSource,i=0;i<e.length;i++){t+=1;var a={key:t};e[i]=Object.assign(e[i],a)}var s=this.pageSize*this.current-this.pageSize,o=this.pageSize*this.current;return e.slice(s,o)},timeStamp:function(t){var e=Math.floor(t/86400),i=Math.floor((t-24*e*3600)/3600),a=Math.floor((t-24*e*3600-3600*i)/60);return{day:e,hours:i,minutes:a}},addProduct:function(){var t=this.activeTimeCheck(),e=t.activeTime,i=t.message;e||!i?this.$refs.selectGoods.openDialog():this.$message.error(i)},activeTimeCheck:function(){var t=!0,e="";return this.start_time||this.end_time?this.start_time?this.end_time||(e="请先选择活动的结束时间！",t=!1):(e="请先选择活动的开始时间！",t=!1):(e="请先选择活动的开始时间和结束时间！",t=!1),{activeTime:t,message:e}},selecrGoodsSubmit:function(t){console.log(t,"e-----selecrGoodsSubmit-----选择商品回调"),t.goods=t.goods.map((function(t){if(t.type="group",t.sku_info&&t.sku_info.length&&t.sku_info.length>1&&(t.children=[],t.sku_info.forEach((function(e){e.goods_id=t.goods_id+"_"+e.sku_id,e.name=t.name,e.image=t.image,e.act_stock_num||(e.act_stock_num=0),e.act_price||(e.act_price=0),t.children.push(e)}))),t.sku_info&&t.sku_info.length&&1==t.sku_info.length){var e=t.sku_info[0];for(var i in e)t[i]=e[i]}return t.sku_info&&!t.sku_info.length&&(t.act_stock_num=0,t.act_price=0,t.sku_info=""),t})),this.goodsList=t.goods,this.$set(this.formData,"goods_info",this.goodsList.length?this.goodsList[0]:""),console.log(this.goodsList,"this.goodsList"),this.goodsList.length&&this.$refs.form.clearValidate(["goods_info"]),this.dataSource=this.goodsList&&this.goodsList.length&&this.goodsList[0].sku_info||[],this.dataSourceChange()},dataSourceChange:function(){this.total=this.dataSource.length,this.current=1,this.pageSize=10,this.pageNumberChange(this.current,this.pageSize)},removeGoods:function(t){var e=this;if(t.sku_id)this.goodsList.forEach((function(e){e.sku_info&&e.sku_info.length&&e.sku_info.forEach((function(i,a){i.sku_id==t.sku_id&&e.sku_info.splice(a,1)}))}));else if(t.goods_id){for(var i=0;i<this.goodsList.length;i++)this.goodsList[i].goods_id===t.goods_id&&this.goodsList.splice(i,1);this.dataSource=[],this.dataSourceChange()}this.dataSource.length&&this.dataSource.forEach((function(i,a){i.sku_id==t.sku_id&&(e.dataSource.splice(a,1),e.dataSourceChange())}))},resetForm:function(){this.formData=this.$options.data().formData,this.affect_time=this.$options.data().affect_time,this.all_noGroup_time=this.$options.data().all_noGroup_time,this.simulate_group_time=this.$options.data().simulate_group_time,this.start_time=this.$options.data().start_time,this.end_time=this.$options.data().end_time,this.goodsList=[],this.$forceUpdate()},handleChange:function(t,e,i){var a=this;this.goodsList=this.goodsList.map((function(s){return!e.sku_str||e.sku_info&&1==e.sku_info.length?e.sku_info&&1==e.sku_info.length&&e.sku_id==e.sku_info[0].sku_id?e.sku_info[0][i]=t:(e.goods_id==s.goods_id&&(s[i]=t),a[i]=t):(e.sku_id==s.sku_id&&(s[i]=t),(0==a.min_act_price||a[i]>t)&&(a[i]=t)),!s.children&&s.sku_info&&s.sku_info.forEach((function(t){for(var e in t)t[e]=s[e]})),"act_price"==i&&(s.children&&s.children.length?a.min_act_price=s.sku_info.map((function(t){return t.act_price})).sort((function(t,e){return t-e}))[0]||0:a.min_act_price=s.act_price||0),s}))},batchSet:function(t,e){var i=this,a=0;if(this.goodsList.forEach((function(t){t.sku_info?t.sku_info&&t.sku_info.length&&(a=t.min_price):a=t.price})),"act_price"==e&&Number(this.act_price)>Number(a))return this.$message.error("拼团价不能大于原价格"),void(this.act_price_visible=!0);this.act_price_visible=!1,this.act_stock_num_visible=!1;var s=0;if(this.goodsList.forEach((function(t){t.sku_info?t.sku_info&&t.sku_info.length&&(s=Math.min.apply(Math,Object(o["a"])(t.sku_info.map((function(t){return t.stock_num}))))):s=t.stock_num})),"act_stock_num"==e)this.goodsList.forEach((function(t){if(t.sku_info){if(t.sku_info&&t.sku_info.length)try{t.sku_info.forEach((function(t){if(Number(t.stock_num)<Number(i.act_stock_num)&&-1!=Number(t.stock_num))throw i.$message.error("活动库存不能大于当前库存"),i.act_stock_num_visible=!0,Error()}))}catch(e){}}else if(Number(i.act_stock_num)>Number(s)&&-1!=Number(s))return i.$message.error("活动库存不能大于当前库存"),void(i.act_stock_num_visible=!0)}));else{if("act_stock_num"==e&&0==Number(this.act_stock_num))return this.$message.error("活动库存不能设置为0"),void(this.act_stock_num_visible=!0);this.act_price_visible=!1,this.act_stock_num_visible=!1}this.goodsList=this.goodsList.map((function(t){return!t.sku_info||t.sku_info&&1==t.sku_info.length?t[e]=i[e]:t.sku_info&&t.sku_info.length&&(t.sku_info=t.sku_info.map((function(t){return"act_price"==e&&(t.act_price=i.act_price,i.min_act_price=i.act_price),"act_stock_num"==e&&(t.act_stock_num=i.act_stock_num),t}))),t})),this.dataSource.length&&(this.dataSource=this.dataSource.map((function(t){return"act_price"==e&&(t.act_price=i.act_price),"act_stock_num"==e&&(t.act_stock_num=i.act_stock_num),t}))),"act_price"==e?this.act_price="":"act_stock_num"==e&&(this.act_stock_num="")},affectTimeChange:function(t,e){this.$set(this.affect_time,e,t);var i=this.affect_time,a=i.day,s=void 0===a?0:a,o=i.hours,n=void 0===o?0:o,r=i.minutes,c=void 0===r?0:r,u=24*Number(s)*60*60+60*Number(n)*60+60*Number(c);this.$set(this.formData,"affect_time",u),u&&this.$refs.form.clearValidate(["affect_time"])},machineIntoTime:function(t,e,i){1==i?(this.$set(this.all_noGroup_time,e,t),this.all_machine_into_time=60*Number(this.all_noGroup_time.hours)*60+60*Number(this.all_noGroup_time.minutes),this.$set(this.formData,"all_machine_into_time",this.all_machine_into_time)):(this.$set(this.simulate_group_time,e,t),this.machine_into_time=60*Number(this.simulate_group_time.hours)*60+60*Number(this.simulate_group_time.minutes),this.$set(this.formData,"machine_into_time",this.machine_into_time))},openGroupChange:function(){this.formData.is_open_group||(this.all_noGroup_time=this.$options.data().all_noGroup_time,this.simulate_group_time=this.$options.data().simulate_group_time,this.all_machine_into_time=this.$options.data().all_machine_into_time,this.machine_into_time=this.$options.data().machine_into_time)},machineIntoCheck:function(){this.$refs.form.clearValidate();var t=this.simulate_group_radio;if(console.log(this.all_machine_into_time,"this.all_machine_into_time---1"),console.log(t,"simulate_group_radio"),this.formData.is_open_group)if(1==t){if(this.rules.simulate_group_num&&this.$delete(this.rules,"simulate_group_num"),this.rules.machine_into_time&&this.$delete(this.rules,"machine_into_time"),this.all_machine_into_time)this.$delete(this.rules,"all_machine_into_time");else{var e=[{required:!0,message:"请选择模拟参团介入时间",trigger:["blur","change"]}];this.$set(this.rules,"all_machine_into_time",e)}this.formData.simulate_group_num=0}else{if(this.rules.all_machine_into_time&&this.$delete(this.rules,"all_machine_into_time"),!this.formData.simulate_group_num){var i=[{required:!0,message:"请输入模拟参团团数",trigger:["blur","change"]}];this.$set(this.rules,"simulate_group_num",i)}if(!this.formData.machine_into_time){var a=[{required:!0,message:"请选择模拟参团介入时间",trigger:["blur","change"]}];this.$set(this.rules,"machine_into_time",a)}}else this.rules.simulate_group_num&&this.$delete(this.rules,"simulate_group_num"),this.rules.machine_into_time&&this.$delete(this.rules,"machine_into_time"),this.rules.all_machine_into_time&&this.$delete(this.rules,"all_machine_into_time")},saveData:function(){var t=this;this.machineIntoCheck(),console.log(this.all_machine_into_time,"all_machine_into_time "),console.log(this.formData,"this.formData");var e=this.activeTimeCheck(),i=e.activeTime,a=e.message;i||!a?this.$refs.form.validate((function(e){if(!e)return console.log("error submit!!",t.formData),!1;console.log(t.goodsList,"this.goodsList");var i=t.formData;if(0!=t.affect_time.day||0!=t.affect_time.hours||0!=t.affect_time.minutes)if(1!=i.is_discount_share||0!=i.share_discount.length)if(0!=t.goodsList.length){var a=JSON.parse(JSON.stringify(t.goodsList)).filter((function(e){if(!e.sku_info||e.sku_info&&!e.sku_info.length){if(e.act_stock_num&&Number(e.act_stock_num)>Number(e.stock_num)&&-1!=e.stock_num)return e}else if(e.sku_info&&e.sku_info.length&&(e.sku_info=t.dataSource.filter((function(t){if(t.act_stock_num&&Number(t.act_stock_num)>Number(t.stock_num)&&-1!=t.stock_num)return t})),e.sku_info.length))return e}))||[];if(a.length)t.$message.error("商品活动库存不能大于当前库存");else{var s=JSON.parse(JSON.stringify(t.goodsList)).filter((function(e){if(!e.sku_info||e.sku_info&&!e.sku_info.length){if((null==e.act_price||void 0==e.act_price||""==e.act_price)&&0!=e.act_price)return e}else if(e.sku_info&&e.sku_info.length&&(e.sku_info=t.dataSource.filter((function(t){if((null==t.act_price||void 0==t.act_price||""==t.act_price)&&0!=t.act_price)return t})),e.sku_info.length))return e}))||[];if(s.length)t.$message.error("请设置商品的拼团价");else{if(i.team_discount_price&&t.goodsList.length){var r=t.dataSource||[];if(r.length){var c=Math.min.apply(Math,Object(o["a"])(r.map((function(t){return t.act_price-0}))));if(Number(i.team_discount_price)>Number(c))return void t.$message.error("团长价不能大于拼团价")}else if(Number(i.team_discount_price)>Number(t.goodsList[0].act_price))return void t.$message.error("团长价不能大于拼团价")}if(t.dataSource.length)for(var u in t.dataSource)if(0==t.dataSource[u].act_stock_num)return void t.$message.error("库存不能为0");1==i.is_discount_share&&(i.discount_card=0,i.discount_coupon=0,i.share_discount.forEach((function(t){1==t?i.discount_card=1:2==t&&(i.discount_coupon=1)}))),i.store_id=t.store_id,t.id&&(i.id=t.id),(t.goodsList.length||i.goods_info)&&(i.goods_info=t.goodsList.length?t.goodsList[0]:"",i.goods_info["sku_info"]=t.dataSource||[]);var _={id:t.id,store_id:t.store_id,start_time:i.start_time,end_time:i.end_time,affect_time:i.affect_time,complete_num:i.complete_num,limit_num:i.limit_num,is_open_group:i.is_open_group?1:0,machine_into_time:1==t.simulate_group_radio?t.all_machine_into_time:t.machine_into_time,simulate_group_num:i.simulate_group_num,team_discount_price:i.team_discount_price,is_discount_share:i.is_discount_share,discount_card:i.discount_card,discount_coupon:i.discount_coupon,goods_info:i.goods_info};console.log(_,"params"),t.request(n["a"].groupAdd,_).then((function(e){t.resetForm(),t.$message.success("提交成功！"),t.$router.push({path:"/merchant/merchant.mall/groupList",query:{store_id:t.store_id}}),sessionStorage.setItem("groupEdit",1)})).catch((function(e){t.dataSourceChange()}))}}}else t.$message.error("请选择活动商品");else t.$message.error("请选择优惠同享类型");else t.$message.error("拼团有效时间不能都为0")})):this.$message.error(a)}}},l=m,h=(i("0bd7"),i("0b56")),d=Object(h["a"])(l,a,s,!1,null,"f761a1f6",null);e["default"]=d.exports}}]);