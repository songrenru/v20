(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3058cbb8"],{"7bef":function(t,i,e){},d219:function(t,i,e){"use strict";e("7bef")},d8f9:function(t,i,e){"use strict";e.r(i);var a=function(){var t=this,i=t._self._c;return i("div",{staticClass:"face_upload"},[i("div",{staticClass:"top_tips",staticStyle:{width:"100%"}},[i("div",[t._v("1、请上传1张脸部轮廓清晰的照片，确保为本人照片，否则影响开门")]),i("div",[t._v("2、人脸上传成功后可点击下方同步人脸按钮同步至门禁设备中")]),i("div",[t._v("3、建议尺寸："+t._s(t.options.autoCropWidth)+"x"+t._s(t.options.autoCropHeight))])]),i("div",{staticClass:"upload_con"},[i("div",{staticClass:"images_list"},t._l(t.imageList,(function(e,a){return i("div",{key:a,staticClass:"img_con"},[i("img",{attrs:{preview:"1",src:e.imgPath,alt:""}}),i("div",{staticClass:"delete_btn",on:{click:function(i){return t.deleteImage(a)}}},[t._v("x")])])})),0),i("div",{staticClass:"right_operate"},[t.imageList.length<1?i("a-upload",{attrs:{"show-upload-list":!1,action:"/v20/public/index.php/common/common.UploadFile/uploadPictures","before-upload":t.beforeUpload},on:{change:t.handleChange}},[i("a-button",{attrs:{size:"small"}},[i("a-icon",{attrs:{type:"upload"}}),t._v("从本地文件选择")],1)],1):t._e(),t.imageList.length<1?i("a-button",{staticClass:"dele_btn",attrs:{size:"small",type:"primary"},on:{click:t.cameraModal}},[t._v("打开摄像头")]):t._e(),1==t.imageList.length?i("a-button",{staticClass:"dele_btn",style:{backgroundColor:t.isSynchronize?"#999999":""},attrs:{size:"small",type:"primary"},on:{click:t.synchronizeFace}},[t._v(t._s(t.isSynchronize?"同步中...":"同步人脸"))]):t._e()],1)]),i("div",{staticClass:"top_tips",staticStyle:{width:"100%","margin-top":"20px"}},[t.faceInfo.face_img_status_txt?i("div",{style:{color:1==t.faceInfo.face_img_status?"green":"red"}},[t._v(t._s(t.faceInfo.face_img_status_txt))]):t._e(),t.faceInfo.face_img_reason?i("div",[t._v(t._s(t.faceInfo.face_img_reason))]):t._e()]),i("a-modal",{staticStyle:{"z-index":"999"},attrs:{title:"修改头像",visible:t.visible,maskClosable:!1,confirmLoading:t.confirmLoading,width:598,footer:null},on:{cancel:t.cancelHandel}},[i("a-row",[i("a-col",{style:{height:"550px"},attrs:{xs:24,md:24}},[i("vue-cropper",{ref:"cropper",attrs:{img:t.options.img,info:!0,autoCrop:t.options.autoCrop,autoCropWidth:t.options.autoCropWidth,autoCropHeight:t.options.autoCropHeight,fixedBox:t.options.fixedBox},on:{realTime:t.realTime}})],1)],1),i("a-row",{staticStyle:{"margin-top":"10px"}},[i("a-col",{attrs:{lg:{span:1,offset:2},md:2}},[i("a-button",{attrs:{icon:"plus"},on:{click:function(i){return t.changeScale(1)}}})],1),i("a-col",{attrs:{lg:{span:1,offset:1},md:2}},[i("a-button",{attrs:{icon:"minus"},on:{click:function(i){return t.changeScale(-1)}}})],1),i("a-col",{attrs:{lg:{span:1,offset:1},md:2}},[i("a-button",{attrs:{icon:"undo"},on:{click:t.rotateLeft}})],1),i("a-col",{attrs:{lg:{span:1,offset:1},md:2}},[i("a-button",{attrs:{icon:"redo"},on:{click:t.rotateRight}})],1),i("a-col",{attrs:{lg:{span:2,offset:6},md:2}},[i("a-button",{attrs:{type:"primary"},on:{click:function(i){return t.finish("blob")}}},[t._v("保存")])],1)],1)],1),i("a-modal",{attrs:{title:"摄像头【请先点击‘拍照’在提交】",visible:t.cameraVisible,maskClosable:!1,width:600,footer:null},on:{cancel:t.cancelPhotoHandel}},[i("div",[i("div",{staticClass:"box"},[i("video",{directives:[{name:"show",rawName:"v-show",value:!t.imgSrc,expression:"!imgSrc"}],staticClass:"canvas",attrs:{id:"videoCamera",width:t.videoWidth,height:t.videoHeight,autoPlay:""}}),i("canvas",{directives:[{name:"show",rawName:"v-show",value:t.imgSrc,expression:"imgSrc"}],staticClass:"canvas",attrs:{id:"canvasCamera",width:t.videoWidth,height:t.videoHeight}})]),i("div",[i("a-button",{attrs:{icon:"el-icon-camera",size:"small"},on:{click:t.photographBtn}},[t._v("拍照")]),t.os?i("a-button",{attrs:{icon:"el-icon-video-camera",size:"small"},on:{click:t.openCamera}},[t._v("打开摄像头")]):i("a-button",{attrs:{icon:"el-icon-switch-button",size:"small"},on:{click:t.stopCamera}},[t._v("关闭摄像头")]),i("a-button",{attrs:{icon:"el-icon-refresh",size:"small"},on:{click:t.resetBtn}},[t._v("重置")]),i("a-button",{attrs:{icon:"el-icon-circle-close",size:"small"},on:{click:t.submitBtn}},[t._v("提交")])],1)])])],1)},s=[];e("075f"),e("c5cb"),e("02bf"),e("a617"),e("ffa0"),e("2113"),e("4afa");function o(t,i){var e=new FileReader;e.addEventListener("load",(function(){return i(e.result)})),e.readAsDataURL(t)}var n={data:function(){return{visible:!1,id:null,confirmLoading:!1,fileList:[],uploading:!1,options:{img:"",autoCrop:!0,autoCropWidth:295,autoCropHeight:413,fixedBox:!0},previews:{},previewVisible:!1,previewImage:"",loading:!1,imageUrl:"",os:!1,thisVideo:null,thisContext:null,thisCancas:null,imgSrc:"",videoWidth:550,videoHeight:550,imageList:[],cameraVisible:!1,uid:"",faceInfo:{},faceList:[],isSynchronize:!1}},created:function(){this.uid=this.$route.query.id,this.$route.query.width&&this.$route.query.height&&(this.options.autoCropWidth=this.$route.query.width,this.options.autoCropHeight=this.$route.query.height),this.getCapFaceInfo()},methods:{getCapFaceInfo:function(){var t=this;this.request("/community/village_api.FaceDevice/capFaceInfo",{pigcms_id:this.uid}).then((function(i){t.faceInfo=i.faceInfo,t.faceList=i.list,t.imageList=[],i.list.length>0&&i.list.map((function(i){t.imageList.push({imgPath:i.img_url})}))}))},uploadFaceImage:function(){var t=this;0!=this.imageList.length?this.request("/community/village_api.FaceDevice/uploadFaceImg",{pigcms_id:this.uid,imageBase64:this.imageList[0].imgPath}).then((function(i){t.$message.success("图片上传成功！")})).catch((function(i){t.$message.error(i.msg)})):this.$message.warn("请先选择上传的图片")},synchronizeFace:function(){var t=this;this.isSynchronize?this.$message.warn("正在同步中，请稍等"):(this.isSynchronize=!0,this.request("/community/village_api.FaceDevice/synToDeviceUserImg",{pigcms_id:this.uid}).then((function(i){t.isSynchronize=!1,t.$message.success(i.msg),t.getCapFaceInfo()})).catch((function(i){t.isSynchronize=!1,t.$message.error(i.msg)})))},close:function(){this.id=null,this.visible=!1,this.options.img=""},cancelHandel:function(){this.close()},changeScale:function(t){t=t||1,this.$refs.cropper.changeScale(t)},rotateLeft:function(){this.$refs.cropper.rotateLeft()},rotateRight:function(){this.$refs.cropper.rotateRight()},finish:function(t){var i=this;new FormData;"blob"===t&&this.$refs.cropper.getCropData((function(t){i.imageUrl=t,i.imageList.push({imgPath:t}),i.visible=!1,i.options.img="",i.uploadFaceImage(),i.$previewRefresh()}))},realTime:function(t){this.previews=t},handleChange:function(t){var i=this;"uploading"!==t.file.status?"done"===t.file.status&&o(t.file.originFileObj,(function(t){i.options.img=t,i.visible=!0,i.loading=!1})):this.loading=!0},beforeUpload:function(t){var i="image/jpeg"===t.type||"image/png"===t.type;i||this.$message.error("You can only upload JPG file!");var e=t.size/1024/1024<2;return e||this.$message.error("Image must smaller than 2MB!"),i&&e},submitBtn:function(){var t=this;this.imgSrc?(this.options.img=this.imgSrc,this.visible=!0,this.cameraVisible=!1,this.$nextTick((function(){t.imgSrc=""}))):this.$message.warn("请先点击【拍照】后，在进行提交")},openCamera:function(){var t=this;this.$nextTick((function(){var i=t;t.os=!1,t.thisCancas=document.getElementById("canvasCamera"),t.thisContext=t.thisCancas.getContext("2d"),t.thisVideo=document.getElementById("videoCamera"),void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(t){var i=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;return i?new Promise((function(e,a){i.call(navigator,t,e,a)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))});var e={audio:!1,video:{width:i.videoWidth,height:i.videoHeight,transform:"scaleX(-1)"}};navigator.mediaDevices.getUserMedia(e).then((function(t){"srcObject"in i.thisVideo?i.thisVideo.srcObject=t:i.thisVideo.src=window.URL.createObjectURL(t),i.thisVideo.onloadedmetadata=function(t){i.thisVideo.play()}})).catch((function(i){t.$message.error("没有开启摄像头权限或浏览器版本不兼容")}))}))},photographBtn:function(){this.thisContext.drawImage(this.thisVideo,0,0,this.videoWidth,this.videoHeight),this.imgSrc=this.thisCancas.toDataURL("image/png")},clearCanvas:function(t){var i=document.getElementById(t),e=i.getContext("2d");e.clearRect(0,0,i.width,i.height)},resetBtn:function(){this.imgSrc="",this.clearCanvas("canvasCamera")},stopCamera:function(){this.thisVideo&&null!==this.thisVideo&&(this.thisVideo.srcObject.getTracks()[0].stop(),this.os=!0)},cancelPhotoHandel:function(){this.cameraVisible=!1,this.imgSrc=""},deleteImage:function(t){this.faceInfo={},this.imageList.splice(t,1)},cameraModal:function(){this.cameraVisible=!0,this.options.img="",this.openCamera()}}},c=n,r=(e("d219"),e("0b56")),l=Object(r["a"])(c,a,s,!1,null,"b9370a6c",null);i["default"]=l.exports}}]);