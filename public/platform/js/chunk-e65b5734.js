(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e65b5734","chunk-2d0bacf3"],{3990:function(e,t,i){"use strict";var a={villageInfo:"/community/village_api.VillageConfig/getVillageInfo",baseConfig:"/community/village_api.VillageConfig/baseConfig",buildingIndex:"/community/village_api.Building/index",roomIndex:"/community/village_api.Room/index",ownerIndex:"/community/village_api.Owner/index",ownerReview:"/community/village_api.Owner/review",ownerUnbid:"/community/village_api.Owner/unbind",familyIndex:"/community/village_api.FamilyMember/index",enantIndex:"/community/village_api.Enant/index",buildingList:"/community/village_api.Building/index",deleteBuilding:"/community/village_api.Building/deleteBuilding",buildingInfo:"/community/village_api.Building/buildingInfo",updateBuildingStatus:"/community/village_api.Building/updateBuildingStatus",saveBuildingButler:"/community/village_api.Building/saveBuildingButler",getBuildingButler:"community/village_api.Building/getBuildingButler",updateBuildingInfoByID:"community/village_api.Building/updateBuildingInfoByID",buildingUnitFloor:"community/village_api.Building/unitFloor",buildingFloorLayerRooms:"community/village_api.Building/floorLayerRooms",unitRentalList:"/community/village_api.UnitRental/index",deleteUnitRental:"/community/village_api.UnitRental/deleteUnitRental",unitRentalInfo:"/community/village_api.UnitRental/unitRentalInfo",updateUnitRentalStatus:"/community/village_api.UnitRental/updateUnitRentalStatus",saveUnitRentalButler:"/community/village_api.UnitRental/saveUnitRentalButler",getUnitRentalButler:"community/village_api.UnitRental/getUnitRentalButler",updateUnitRentalInfoByID:"community/village_api.UnitRental/updateUnitRentalInfoByID",unitRentalFloorList:"community/village_api.UnitRental/unitRentalFloorList",updateUnitRentalFloorStatus:"community/village_api.UnitRental/updateUnitRentalFloorStatus",deleteUnitRentalFloor:"community/village_api.UnitRental/deleteUnitRentalFloor",unitRentalFloorInfo:"community/village_api.UnitRental/unitRentalFloorInfo",saveUnitRentalFloorInfo:"community/village_api.UnitRental/saveUnitRentalFloorInfo",unitRentalLayerList:"community/village_api.UnitRental/unitRentalLayerList",unitRentalLayerInfo:"community/village_api.UnitRental/unitRentalLayerInfo",saveUnitRentalLayerInfo:"community/village_api.UnitRental/saveUnitRentalLayerInfo",updateUnitRentalLayerStatus:"community/village_api.UnitRental/updateUnitRentalLayerStatus",deleteUnitRentalLayer:"community/village_api.UnitRental/deleteUnitRentalLayer",thirdVillageUploadFile:"community/village_api.third.Room/villageUploadFile",thirdStartRoomImport:"community/village_api.third.Room/startRoomImport",thirdStartUserImport:"community/village_api.third.Room/startUserImport",thirdStartChargeImport:"community/village_api.third.Room/startChargeImport",thirdRefreshProcess:"community/village_api.third.Room/refreshProcess",ownerList:"/community/village_api.People.Owner/index",servicesImgPreview:"/community/village_api.WorkWeiXin/servicesImgPreview"};t["a"]=a},6093:function(e,t,i){"use strict";i("da9d")},da9d:function(e,t,i){},f07f:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-modal",{attrs:{title:"楼栋导入向导",width:1e3,visible:e.visible,maskClosable:!1,footer:e.isImporting?null:void 0},on:{cancel:e.handleCancel}},[i("a-tabs",{attrs:{"default-active-key":1},on:{change:e.tabChange}},[i("a-tab-pane",{key:1,attrs:{tab:"导入操作"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.firstStep&&!e.isImporting,expression:"firstStep && !isImporting"}],staticClass:"step_one"},[i("h4",[e._v("步骤一：上传 Excel 文件")]),i("p",[e._v("您要从何处导入数据，请选择导入的 Excel 文件")]),i("div",{staticStyle:{display:"flex",width:"80%"}},[i("div",{staticClass:"label",staticStyle:{width:"82px","text-align":"left"}},[e._v("Excel文件")]),i("a-upload-dragger",{staticStyle:{height:"100px",width:"calc(100% - 82px)","margin-left":"10px"},attrs:{name:"file",multiple:!0,action:e.uploadUrl,beforeUpload:e.beforeUploadExcel,showUploadList:!1,headers:e.headers,data:{upload_dir:"building",system_type:"village",type:"building"}},on:{change:e.handleUploadChange}},[i("a-icon",{attrs:{type:e.uploadLoading?"loading":"upload"}}),e._v(" 拖拽或点击上传 Excel 文件 ")],1)],1),e.fileList.length>0?i("div",{staticClass:"select_list",staticStyle:{display:"flex","align-items":"center",height:"50px"}},[i("div",{staticClass:"label",staticStyle:{width:"82px","text-align":"left"}},[e._v("选择Sheet表")]),i("a-select",{staticStyle:{width:"120px","margin-left":"10px"},attrs:{"default-value":0},on:{change:e.handleSelectChange}},e._l(e.fileList,(function(t,a){return i("a-select-option",{key:a,attrs:{value:a}},[e._v(" "+e._s(t.worksheetName)+" ")])})),1),i("div",{staticStyle:{color:"red","margin-left":"10px"}},[e._v("总数据量："+e._s(e.selectObj.totalRows?e.selectObj.totalRows-1:0)+" 条")])],1):e._e(),e.fileList.length>0?i("div",{staticClass:"select_list",staticStyle:{display:"flex","align-items":"center",height:"50px"}},[i("div",{staticClass:"label",staticStyle:{width:"90px","text-align":"left"}},[e._v("数据重复时")]),i("a-radio-group",{attrs:{name:"radioGroup"},model:{value:e.isSkip,callback:function(t){e.isSkip=t},expression:"isSkip"}},[i("a-radio",{attrs:{value:0}},[e._v("跳过")]),i("a-radio",{attrs:{value:1}},[e._v("覆盖")])],1),1==e.isSkip?i("div",{staticStyle:{"margin-left":"10px",display:"flex","align-items":"center"}},[i("div",[e._v("当")]),i("a-select",{staticStyle:{width:"120px",margin:"0 10px"},attrs:{value:e.selectreplaceFie},on:{change:e.handleReplaceChange}},e._l(e.replaceFieldSelect,(function(t,a){return i("a-select-option",{key:a,attrs:{value:t.option}},[e._v(e._s(t.title))])})),1),i("div",[e._v("重复时，覆盖现有客户数据")])],1):e._e()],1):e._e(),i("h5",[e._v("导入步骤：")]),i("p",[e._v(" 第一步：上传存储有楼栋的资料 Excel 文件；【您可以直接上传 Excel 文件或者下载模板："),i("a-button",{attrs:{type:"link"},on:{click:e.downloadExcel}},[e._v(" 模板下载")]),e._v("】 ")],1),i("p",[e._v(" 第二步：设置 Excel 里的列与系统中的列的对应关系")]),i("p",[e._v(" 第三步：开始导入")])]),e.firstStep||e.isImporting?e._e():i("div",{staticClass:"step_two"},[i("div",{staticClass:"top_desc",staticStyle:{display:"flex","align-items":"center",height:"30px"}},[i("h4",[e._v("步骤二：【企业客户创建对应关系】建立系统列与Excel列的对应关系")]),i("p",{staticStyle:{"margin-left":"10px","margin-top":"7px"}},[e._v("建立系统列与Excel列的对应关系")])]),i("div",{staticClass:"line",staticStyle:{width:"100%",height:"1px",border:"0","background-color":"#999999",margin:"10px 0"}}),i("div",{staticClass:"list"},[i("div",{staticClass:"title"},[i("span",[e._v("楼层信息")]),i("span",{staticStyle:{"margin-left":"10px",color:"red"}},[e._v("*号为必填项")])]),i("div",{staticClass:"top_label",staticStyle:{width:"100%",height:"30px",display:"flex","justify-content":"space-between margin-top: 10px"}},[i("div",{staticClass:"left_label",staticStyle:{width:"50%",display:"flex","background-color":"#dddddd",border:"1px solid #999999"}},e._l(e.labelList,(function(t,a){return i("div",{key:a,staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"center"}},[e._v(e._s(t.name))])})),0),i("div",{staticClass:"right_label",staticStyle:{width:"50%",display:"flex","background-color":"#dddddd",border:"1px solid #999999"}},e._l(e.labelList,(function(t,a){return i("div",{key:a,staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"center"}},[e._v(e._s(t.name))])})),0)]),i("div",{staticClass:"select_con",staticStyle:{width:"100%",display:"flex","flex-wrap":"wrap"}},e._l(e.sourceMapFields,(function(t,a){return i("div",{key:a,staticClass:"select_list",staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"space-around"}},[i("div",{staticClass:"left_label",staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"center"}},[e._v(e._s(t.key)),t.val.isMust?i("span",{staticStyle:{color:"red","margin-left":"5px"}},[e._v("*")]):e._e(),e._v("：")]),i("div",{staticClass:"right_select",staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"center"}},[e.refreshSelect?i("a-select",{staticStyle:{width:"200px","margin-left":"10px","margin-top":"10px"},attrs:{"default-value":t.selected?t.key:""},on:{change:function(i){return e.handleExcelChange(i,t.val.field)}}},e._l(e.excelCloumns,(function(t,a){return i("a-select-option",{key:a,staticStyle:{height:"32px"},attrs:{value:t.key}},[e._v(" "+e._s(t.val)+" ")])})),1):e._e()],1)])})),0)])])]),i("a-tab-pane",{key:2,attrs:{tab:"导入日志"}},[e._v(" 导入日志 ")])],1),e.isImporting?e._e():i("template",{slot:"footer"},[i("div",{staticClass:"footer_con",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},[e.firstStep?i("div",{staticClass:"left"}):e._e(),e.firstStep?e._e():i("div",{staticClass:"left"},[e._v(" 请注意系统列与Excel列的类型要匹配 ")]),i("div",{staticClass:"right"},[e.firstStep?e._e():i("a-button",{attrs:{type:"default"},on:{click:e.preStep}},[e._v("上一步")]),e.firstStep?i("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.nextStep}},[e._v("下一步")]):e._e(),e.firstStep?e._e():i("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.startImport}},[e._v("开始导入")]),i("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"default"},on:{click:e.handleCancel}},[e._v("取消")])],1)])]),e.isImporting&&2!=e.currentKey?i("div",{staticClass:"progress_content",staticStyle:{width:"100%",height:"450px",display:"flex","align-items":"center","justify-content":"center","flex-direction":"column"}},[i("a-progress",{attrs:{type:"circle","stroke-color":{"0%":"#108ee9","100%":"#87d068"},percent:e.percentVal}}),i("div",{staticClass:"importing",staticStyle:{"margin-top":"15px"}},[e._v(" 总行数 "),i("span",{staticStyle:{"font-size":"larger"}},[e._v(e._s(e.readRowTotal))]),e._v("，正在导入，剩余"),i("span",{staticStyle:{"font-size":"larger"}},[e._v(e._s(e.readRowTotal-(e.successInsterTotal+e.errorTotal))+" ")]),e._v(" 条记录待导入，成功"),i("span",{staticStyle:{color:"#68C472","font-size":"larger"}},[e._v(e._s(e.successInsterTotal))]),e._v("条,失败"),i("span",{staticStyle:{color:"red","font-size":"larger"}},[e._v(" "+e._s(e.errorTotal)+" ")]),e._v("条 ")]),i("div",{staticClass:"desc",staticStyle:{"margin-top":"15px",color:"#999999","font-size":"14px"}},[e._v(" 正在等待导入，你可以关闭本窗口，稍后再来查看 "),100==e.percentVal?i("a-button",{attrs:{type:"link"},on:{click:e.goBack}},[e._v("重新导入")]):e._e()],1)],1):e._e()],2)},l=[],n=(i("a9e3"),i("ac1f"),i("1276"),i("b0c0"),i("d81d"),i("a434"),i("4de4"),i("d3b7"),i("8bbf")),o=i.n(n),s=(i("5880"),i("ca00")),c=i("ed09"),r=(i("3990"),Object(c["c"])({props:{visible:{type:Boolean,default:!1},upload_type:{type:[String,Number],default:0}},setup:function(e,t){var i=Object(c["h"])(0),a=Object(c["h"])(""),l=Object(c["h"])(null),n=Object(c["h"])(!1),r=Object(c["h"])(0),u=[{name:"系统列"},{name:"Excel列"}],p=Object(c["h"])("/v20/public/index.php/community/village_api.Building/villageUploadFile"),d=Object(c["h"])([]),v=Object(c["h"])(!1),g=Object(c["h"])(!0),m=Object(c["h"])(!1),f=Object(c["h"])(0),y=function(e){var t=e.name.split(".").pop();if("xlsx"!=t&&"xls"!=t)return v.value=!1,o.a.prototype.$message.warn("上传文件格式非 Excel"),!1},h=function(){D(),t.emit("exit",!1)},_=function(){g.value=!0},x=Object(c["h"])([]),b=function(e,t){if("root"!=e){var i=!0;x.value.map((function(a,l){a.key==t&&(a.value=e,i=!1)})),i&&x.value.push({key:t,value:e})}else x.value.map((function(e,i){e.key==t&&x.value.splice(i,1)}))},S=function(){O.totalRows&&0==O.totalRows?o.a.prototype.$message.warn("请完善上传信息"):j.value&&C.value?(g.value=!1,T()):o.a.prototype.$message.warn("请先上传Excel文件")},R=function(e){a.value=e,Object(c["d"])()},w=function(){var e=E.value.filter((function(e){return e.val.isMust})).length,t=0;E.value.map((function(e){x.value.map((function(i){e.val.isMust&&i.key==e.val.field&&t++}))})),t==e?o.a.prototype.request("/community/village_api.Building/startImport ",{relationship:x.value,inputFileName:C.value,worksheetName:j.value,isRepeated:i.value,replaceField:a.value,selectWorkSheetIndex:f.value}).then((function(e){o.a.prototype.$message.success("提交成功，准备导入，调整画面为进度条画面！"),n.value=!0,l.value=setInterval((function(){q()}),1e3)})).catch((function(e){n.value=!1,D()})):o.a.prototype.$message.warn("有必填项未选")},k=Object(s["k"])("/community/village_api.Building/villageUploadFile"),I=o.a.ls.get(k),U=Object(c["g"])({authorization:"authorization-text",ticket:I}),C=Object(c["h"])(""),j=Object(c["h"])(""),B=function(e){v.value=!0,"uploading"!==e.file.status&&(v.value=!0),"done"===e.file.status?(C.value=e.file.response.data,v.value=!1,1e3==e.file.response.status?M(C.value):o.a.prototype.$message.error(e.file.response.msg)):"error"===e.file.status&&(v.value=!1,o.a.prototype.$message.error("".concat(e.file.name," file upload failed.")))},O=Object(c["h"])({}),F=function(e){O.value=d.value[e],j.value=d.value[e].worksheetName,f.value=e,Object(c["d"])()},L=Object(c["h"])([]),E=Object(c["h"])([]),T=function(){o.a.prototype.request("/community/village_api.Building/startBindExcelCol",{inputFileName:C.value,worksheetName:j.value,selectWorkSheetIndex:f.value}).then((function(e){console.log("startBindExcelCol res----------\x3e",e),L.value=e.excelCloumns,L.value.unshift({key:"root",val:""}),E.value=e.sourceMapFields,x.value=[],e.sourceMapFields.map((function(t){if(t.selected){var i=e.excelCloumns.filter((function(e){return e.val==t.key}))[0].key;console.log("value--\x3e",i),x.value.push({key:t.val.field,value:i})}})),console.log("sourceMapFields.value--\x3e",E.value),console.log("relationship.value--\x3e",x.value),m.value=!1,Object(c["e"])((function(){m.value=!0})),Object(c["d"])()})).catch((function(e){}))},N=Object(c["h"])([]),M=function(e){o.a.prototype.request("/community/village_api.Building/importForExcel",{inputFileName:e}).then((function(e){d.value=e.worksheet,O.value=e.worksheet[0],j.value=e.worksheet[0].worksheetName,N.value=e.replaceFieldSelect,a.value=e.replaceFieldSelect[0].option,console.log("importForExcel ------\x3e",e,N.value,a.value),Object(c["d"])()})).catch((function(e){}))},$=Object(c["h"])(0),z=Object(c["h"])(0),P=Object(c["h"])(0),V=Object(c["h"])(0),q=function(){o.a.prototype.request("/community/village_api.Building/refreshProcess",{type:"building"}).then((function(e){e.process&&($.value=e.process,z.value=e.processInfo.readRowTotal,P.value=e.processInfo.successInsterTotal,V.value=e.processInfo.errorTotal,100==e.process&&(o.a.prototype.$message.warn("导入执行完毕！"),D()))})).catch((function(e){D()}))},D=function(){clearInterval(l.value),l.value=null},W=function(){},J=function(){g.value=!0,n.value=!1},K=Object(c["h"])(1),G=function(e){K.value=e};return Object(c["i"])((function(){return e.visible}),(function(e){}),{deep:!0}),{handleCancel:h,headers:U,handleUploadChange:B,currentIndex:r,uploadUrl:p,uploadExcelFile:M,downloadExcel:W,fileList:d,uploadLoading:v,selectObj:O,handleSelectChange:F,nextStep:S,firstStep:g,preStep:_,startImport:w,labelList:u,getSelectList:T,pathUrl:C,excelCloumns:L,sourceMapFields:E,handleExcelChange:b,relationship:x,beforeUploadExcel:y,refreshSelect:m,interval:l,refreshProgress:q,isImporting:n,percentVal:$,clearTimer:D,replaceFieldSelect:N,selectreplaceFie:a,isSkip:i,handleReplaceChange:R,readRowTotal:z,successInsterTotal:P,errorTotal:V,goBack:J,tabChange:G,currentKey:K}}})),u=r,p=(i("6093"),i("2877")),d=Object(p["a"])(u,a,l,!1,null,"af6f6b98",null);t["default"]=d.exports}}]);