(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0802de10","chunk-09d38c13"],{"1b98":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-modal",{staticClass:"dialog",attrs:{title:e.titleName,width:"800",centered:"",visible:e.dialogVisible,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel}},[i("div",{staticClass:"select-goods"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.keywords,expression:"!keywords"}],staticClass:"left scroll_content"},[i("a-menu",{attrs:{mode:"inline","open-keys":e.openKeys,selectedKeys:e.selectedSort},on:{openChange:e.onOpenChange,select:e.onSelect}},[e._l(e.sortList,(function(t){return[t.children&&t.children.length?i("a-sub-menu",{key:t.id},[i("span",{attrs:{slot:"title"},slot:"title"},[i("span",[e._v(e._s(t.name))])]),t.children&&t.children.length?e._l(t.children,(function(t){return i("a-menu-item",{key:t.id},[e._v(e._s(t.name))])})):e._e()],2):i("a-menu-item",{key:t.id},[e._v(e._s(t.name))])]}))],2)],1),i("div",{staticClass:"right"},[i("div",{staticClass:"top"},[e.keywords?i("a-icon",{staticClass:"fs-16 pointer",attrs:{type:"left"},on:{click:function(t){return e.backToSort()}}}):e._e(),i("a-input-search",{staticClass:"search",attrs:{placeholder:"sport"==e.source?"场馆名称":"景区名称","allow-clear":""},on:{change:e.getGoodsList,search:e.getGoodsList},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}})],1),i("div",{staticClass:"bottom"},[i("a-table",{key:"spu_table",attrs:{"row-selection":e.rowSelection,columns:e.columns,"data-source":e.tableList,rowKey:"ticket_id",scroll:{y:500},pagination:!!e.tableList.length&&e.pagination},scopedSlots:e._u([{key:"ticket_title",fn:function(t,o){return i("span",{},[i("div",{staticClass:"product-info"},[i("div",[i("img",{attrs:{src:o.image}})]),i("div",[e._v(e._s(o.title))])])])}},{key:"price",fn:function(t,o){return i("span",{},[i("span",{key:"spu_goods"},[e._v("￥"+e._s(o.price))])])}},{key:"current_stock",fn:function(t){return i("span",{},[e._v(" "+e._s(-1==t?"无限量":t)+" ")])}}])})],1)])])])},s=[],a=(i("d3b7"),i("159b"),i("7db0"),i("d81d"),i("a434"),i("4d95")),r=null,n={name:"SelectShopGoods",props:{source:{type:String,default:"shipping"},targeTage:{type:Array,default:function(){return[]}},group_type:{type:Array,default:function(){return[]}},type:{type:String,default:"checkbox"},startTime:String,endTime:String,selectedList:{type:Array,default:function(){return[]}}},data:function(){return{titleName:"选择景区门票",dialogVisible:!1,start_time:0,end_time:0,rootSubmenuKeys:[],openKeys:[],columns:[{title:"门票信息",dataIndex:"ticket_title",scopedSlots:{customRender:"ticket_title"},width:"300px"},{title:"价格",dataIndex:"price",scopedSlots:{customRender:"price"},width:"200px"},{title:"当前库存",dataIndex:"stock_num",scopedSlots:{customRender:"current_stock"}}],menuId:0,hasSelected:[],selectedRowKeys:[],selectedSort:[],sortList:[],keywords:"",tableList:[],oldMenuId:"",sList:[],isSku:!1,pagination:{current:1,total:0,pageSize:10,onChange:function(e,t){return r.onPageChange(e,t)}}}},computed:{rowSelection:function(){return this.isSku?null:{selectedRowKeys:this.selectedRowKeys,type:this.type,onSelect:this.onRowSelect,onSelectAll:this.onSelectAll,getCheckboxProps:function(e){return{props:{disabled:0==e.can_be_choose}}}}}},created:function(){r=this},watch:{selectedList:function(e){this.sList=JSON.parse(JSON.stringify(e)),"sport"==this.source&&(this.titleName="选择场馆门票")}},methods:{openDialog:function(){this.dialogVisible=!0,this.sList=JSON.parse(JSON.stringify(this.selectedList)),console.log(this.selectedList,"selectedList"),this.getSortList()},init:function(){this.rootSubmenuKeys=[],this.openKeys=[],this.selectedSort=[],this.tableList=[],this.keywords="",this.start_time=new Date(this.startTime).getTime()/1e3,this.end_time=new Date(this.endTime).getTime()/1e3,this.pagination=this.$options.data().pagination},getSortList:function(){var e=this;this.request(a["a"].getMerchantSort,{source:this.source}).then((function(t){t.list&&t.list.length&&(e.sortList=t.list,e.handleDefaultSelect())}))},handleDefaultSelect:function(){var e=this;this.init(),this.sortList.forEach((function(t,i){if(e.rootSubmenuKeys.push(t.id),t.children&&t.children.length){0==i&&e.openKeys.push(t.id);var o=t.children;o.forEach((function(t,o){t.children&&t.children.length?0==o&&e.openKeys.push(t.id):0==i&&0==o&&(e.menuId=t.id)}))}else 0==i&&(e.menuId=t.id)})),this.selectedSort.push(this.menuId),this.getGoodsList()},onSelect:function(e){var t=e.key;this.selectedSort=[t],this.menuId=t,this.$set(this.pagination,"current",1),this.getGoodsList()},getGoodsList:function(){var e=this;this.tableList=[];var t={keyword:this.keywords,page:this.pagination.current,pageSize:this.pagination.pageSize,source:this.source,targeTage:this.targeTage,group_type:this.group_type};this.keywords||(t.tools_id=this.menuId),this.request(a["a"].getLifeToolsTicket,t).then((function(t){t.list&&t.list.length&&(e.tableList=JSON.parse(JSON.stringify(t.list)),e.$set(e.pagination,"total",t.count),e.handleList())}))},handleList:function(){var e=this;this.selectedRowKeys=[],this.sList.length&&("radio"==this.type?(this.sList.length>1&&(this.sList=[this.sList[0]]),this.selectedRowKeys=[this.sList[0].ticket_id]):this.sList.forEach((function(t){e.selectedRowKeys.push(t.ticket_id)}))),this.selectedRows=this.sList},handleOk:function(){var e=this.selectedRowKeys,t=this.sList;t.length?(this.$emit("submit",{ids:e,goods:t}),this.handleCancel()):this.$message.error("请选择商品")},handleCancel:function(){this.dialogVisible=!1},onOpenChange:function(e){var t=this,i=e.find((function(e){return-1===t.openKeys.indexOf(e)}));-1===this.rootSubmenuKeys.indexOf(i)?this.openKeys=e:this.openKeys.push(i)},backToSort:function(){this.keywords="",this.getGoodsList()},onRowSelect:function(e,t,i){"radio"==this.type?(this.sList=[e],this.selectedRowKeys=[e.ticket_id]):t?(this.sList.push(e),this.selectedRowKeys.push(e.ticket_id)):(this.sList.remove(e),this.selectedRowKeys.remove(e.ticket_id))},onSelectAll:function(e,t,i){var o=this;e?i.map((function(e){o.selectedRowKeys.push(e.ticket_id),o.sList.push(e)})):i.map((function(e){o.sList.remove(e),o.selectedRowKeys.remove(e.ticket_id)}))},onPageChange:function(e,t){this.$set(this.pagination,"current",e),this.getGoodsList()}}};Array.prototype.remove=function(e){var t=this.indexOf(e),i=-1;t>-1?this.splice(t,1):(this.map((function(t,o){t.goods_id==e.goods_id&&(i=o)})),i>-1&&this.splice(i,1))};var l=n,c=(i("ed37"),i("2877")),d=Object(c["a"])(l,o,s,!1,null,"69b1ed08",null);t["default"]=d.exports},"386c":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mt-10 mb-20 mh-full"},[i("a-form-model",e._b({ref:"form",attrs:{model:e.formData,rules:e.rules}},"a-form-model",{labelCol:{span:4},wrapperCol:{span:10}},!1),[i("a-card",{attrs:{title:"基本信息",bordered:!1}},[i("a-form-model-item",{attrs:{label:"活动名称",prop:"name"}},[i("a-input",{attrs:{placeholder:"请输入活动名称",disabled:2==e.formData.status},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),i("a-form-model-item",{attrs:{label:"活动预告设置",prop:"is_discount_share"}},[i("a-radio-group",{model:{value:e.formData.notice_type,callback:function(t){e.$set(e.formData,"notice_type",t)},expression:"formData.notice_type"}},[i("a-radio",{attrs:{value:1}},[e._v(" 不进行活动预告")]),i("a-radio",{attrs:{value:2}},[e._v(" 进行活动预告")])],1)],1),2==e.formData.notice_type?i("a-form-model-item",{attrs:{"wrapper-col":{span:8,offset:4},help:"最多填写240小时,填写’0‘代表不进行活动预告"}},[i("span",{staticClass:"mr-10"},[e._v("活动开始前")]),i("a-input-number",{attrs:{min:0,max:240},model:{value:e.formData.notice_time,callback:function(t){e.$set(e.formData,"notice_time",t)},expression:"formData.notice_time"}}),i("span",{staticClass:"ml-10"},[e._v("小时进行活动预告")])],1):e._e()],1),i("a-card",{staticStyle:{"margin-top":"10px"},attrs:{title:"优惠信息",bordered:!1}},[i("a-form-model-item",{attrs:{label:"活动时间",help:"活动将按照指定周期自动生效",prop:"time_type"}},[i("a-radio-group",{on:{change:e.changeTimeType},model:{value:e.formData.time_type,callback:function(t){e.$set(e.formData,"time_type",t)},expression:"formData.time_type"}},[i("a-radio",{attrs:{value:1}},[e._v(" 固定时间")]),i("a-radio",{attrs:{value:2}},[e._v(" 按周期")])],1)],1),i("a-form-model-item",{attrs:{label:"起止日期"}},[i("a-form-model-item",{ref:"startTime",style:{display:"inline-block"},attrs:{prop:"start_time",autoLink:!1}},[i("a-date-picker",{attrs:{disabled:2==e.formData.status||1==e.formData.status,"show-time":e.showTime,format:e.dateFormat,"disabled-date":e.disabledStartDate,placeholder:"请选择活动开始时间",getCalendarContainer:function(e){return e.parentNode}},on:{change:e.onDateStartChange},model:{value:e.start_time,callback:function(t){e.start_time=t},expression:"start_time"}})],1),i("span",{style:{display:"inline-block",width:"24px",textAlign:"center"}},[e._v(" - ")]),i("a-form-model-item",{ref:"endTime",style:{display:"inline-block"},attrs:{prop:"end_time",autoLink:!1}},[i("a-date-picker",{attrs:{disabled:2==e.formData.status,"show-time":e.showTime,format:e.dateFormat,"disabled-date":e.disabledEndDate,placeholder:"请选择活动结束时间",getCalendarContainer:function(e){return e.parentNode}},on:{change:e.onDateEndChange},model:{value:e.end_time,callback:function(t){e.end_time=t},expression:"end_time"}})],1)],1),2==e.formData.time_type?i("a-form-model-item",{attrs:{"wrapper-col":{span:8,offset:4}}},[i("a-radio-group",{on:{change:e.cycleTypeChange},model:{value:e.formData.cycle_type,callback:function(t){e.$set(e.formData,"cycle_type",t)},expression:"formData.cycle_type"}},[i("a-radio",{attrs:{value:1}},[e._v(" 每日")]),i("a-radio",{attrs:{value:2}},[e._v(" 每周")]),i("a-radio",{attrs:{value:3}},[e._v(" 每月")])],1)],1):e._e(),2==e.formData.time_type&&2==e.formData.cycle_type?i("a-form-model-item",{attrs:{"wrapper-col":{span:8,offset:4}}},[i("a-checkbox-group",{model:{value:e.formData.cycle_date,callback:function(t){e.$set(e.formData,"cycle_date",t)},expression:"formData.cycle_date"}},[i("a-checkbox",{attrs:{value:"1"}},[e._v(" 周一")]),i("a-checkbox",{attrs:{value:"2"}},[e._v(" 周二")]),i("a-checkbox",{attrs:{value:"3"}},[e._v(" 周三")]),i("a-checkbox",{attrs:{value:"4"}},[e._v(" 周四")]),i("a-checkbox",{attrs:{value:"5"}},[e._v(" 周五")]),i("a-checkbox",{attrs:{value:"6"}},[e._v(" 周六")]),i("a-checkbox",{attrs:{value:"0"}},[e._v(" 周日")])],1)],1):e._e(),2==e.formData.time_type&&3==e.formData.cycle_type?i("a-form-model-item",{attrs:{"wrapper-col":{span:8,offset:4}}},[i("a-input-number",{attrs:{min:0,max:30},model:{value:e.formData.cycle_date,callback:function(t){e.$set(e.formData,"cycle_date",t)},expression:"formData.cycle_date"}}),e._v("号 ")],1):e._e(),2==e.formData.time_type?i("a-form-model-item",{attrs:{"wrapper-col":{span:8,offset:4}}},[i("a-time-picker",{attrs:{"default-value":e.moment(e.formData.cycle_start_time,"HH:mm"),format:"HH:mm",getPopupContainer:function(e){return e.parentNode}},on:{change:e.onCycleStimeeRangeChange}}),i("span",[e._v("-")]),i("a-time-picker",{attrs:{"default-value":e.moment(e.formData.cycle_end_time,"HH:mm"),format:"HH:mm",getPopupContainer:function(e){return e.parentNode}},on:{change:e.onCycleEtimeeRangeChange}})],1):e._e(),i("a-form-model-item",{attrs:{label:"限购",prop:"buy_limit",help:"0代表不限购，请输入0~999正整数"}},[i("span",{staticClass:"mr-10"},[e._v("每人最多可参与")]),i("a-input-number",{attrs:{min:0,max:999},model:{value:e.formData.buy_limit,callback:function(t){e.$set(e.formData,"buy_limit",t)},expression:"formData.buy_limit"}}),i("span",{staticClass:"ml-10"},[e._v("次")])],1),i("a-form-model-item",{attrs:{label:"优惠是否同享",prop:"is_discount_share"}},[i("a-radio-group",{model:{value:e.formData.is_discount_share,callback:function(t){e.$set(e.formData,"is_discount_share",t)},expression:"formData.is_discount_share"}},[i("a-radio",{attrs:{value:1}},[e._v(" 是")]),i("a-radio",{attrs:{value:2}},[e._v(" 否")])],1)],1)],1),i("a-card",{staticStyle:{"margin-top":"10px"},attrs:{title:"商品信息",bordered:!1}},[i("a-form-model-item",{attrs:{label:"活动门票",prop:"goods_info"}},[i("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.addProduct()}}},[e._v(" 添加门票 ")]),e.goodsList.length?[i("a-popconfirm",{attrs:{placement:"top","ok-text":"确认","cancel-text":"取消",visible:e.reduce_money_visible,getPopupContainer:function(e){return e.parentNode}},on:{cancel:function(t){e.reduce_money="",e.reduce_money_visible=!1},confirm:function(t){return e.batchSet(t,"reduce_money")}}},[i("template",{slot:"title"},[i("a-input-number",{attrs:{min:0,suffix:"元",prefix:""},model:{value:e.reduce_money,callback:function(t){e.reduce_money=t},expression:"reduce_money"}})],1),i("a-button",{staticClass:"ml-20",on:{click:function(t){e.reduce_money_visible=!e.reduce_money_visible,e.discount_rate_visible=!1}}},[e._v(" 批量设置减少金额 ")])],2),i("a-popconfirm",{attrs:{placement:"top","ok-text":"确认","cancel-text":"取消",visible:e.discount_rate_visible,getPopupContainer:function(e){return e.parentNode}},on:{cancel:function(t){e.discount_rate="",e.discount_rate_visible=!1},confirm:function(t){return e.batchSet(t,"discount_rate")}}},[i("template",{slot:"title"},[i("a-input-number",{attrs:{min:0,suffix:"元",prefix:""},model:{value:e.discount_rate,callback:function(t){e.discount_rate=t},expression:"discount_rate"}})],1),i("a-button",{staticClass:"ml-20",on:{click:function(t){e.discount_rate_visible=!e.discount_rate_visible,e.reduce_money_visible=!1}}},[e._v(" 批量设置折扣比例 ")])],2)]:e._e()],2),i("a-form-model-item",{attrs:{"wrapper-col":{span:20,offset:4}}},[i("a-table",{directives:[{name:"show",rawName:"v-show",value:e.goodsList.length,expression:"goodsList.length"}],staticClass:"mt-20",attrs:{columns:e.columns,"data-source":e.goodsList,rowKey:"ticket_id",childrenColumnName:"sku_info",defaultExpandAllRows:!0,scroll:{x:!1}},scopedSlots:e._u([{key:"name",fn:function(t,o){return i("span",{},[i("a-avatar",{attrs:{shape:"square",size:64,src:o.image}}),i("span",{staticClass:"ml-10 name"},[e._v(e._s(t))])],1)}},{key:"actStockNum",fn:function(t,o){return i("span",{},[i("a-form-item",{staticStyle:{margin:"-5px 0"},attrs:{prop:"act_stock_num"}},[i("a-input-number",{attrs:{min:0,max:o.act_stock_num-0},on:{change:function(t){return e.handleChange(o.act_stock_num,o,"act_stock_num",o.ticket_id)}},model:{value:o.act_stock_num,callback:function(t){e.$set(o,"act_stock_num",t)},expression:"record.act_stock_num"}})],1)],1)}},{key:"price",fn:function(t){return i("span",{staticClass:"cr-red"},[e._v(" ￥"+e._s(t)+" ")])}},{key:"reduceMoney",fn:function(t,o){return i("span",{},[i("a-form-item",{staticStyle:{margin:"-5px 0"}},[i("a-input-number",{attrs:{min:0,max:o.price-0},on:{change:function(t){return e.handleChange(o.reduce_money,o,"reduce_money",o.ticket_id)}},model:{value:o.reduce_money,callback:function(t){e.$set(o,"reduce_money",t)},expression:"record.reduce_money"}})],1)],1)}},{key:"discountRate",fn:function(t,o){return i("span",{},[i("a-form-item",{staticStyle:{margin:"-5px 0"}},[i("a-input-number",{attrs:{min:0,max:10},on:{change:function(t){return e.handleChange(o.discount_rate,o,"discount_rate",o.ticket_id)}},model:{value:o.discount_rate,callback:function(t){e.$set(o,"discount_rate",t)},expression:"record.discount_rate"}})],1)],1)}},{key:"action",fn:function(t,o){return i("span",{},[i("a",{staticClass:"ml-10 inline-block",on:{click:function(t){return e.removeGoods(o)}}},[e._v("删除")])])}}])},[i("span",{attrs:{slot:"actStockNumTitle"},slot:"actStockNumTitle"},[e._v(" 活动库存 "),i("a-tooltip",{attrs:{trigger:"hover"}},[i("template",{slot:"title"},[e._v("设置每个sku的活动库存")]),i("a-icon",{staticClass:"ml-10",attrs:{type:"question-circle"}})],2)],1),i("span",{attrs:{slot:"reduceMoneyTitle"},slot:"reduceMoneyTitle"},[e._v(" 减少金额 "),i("a-tooltip",{attrs:{trigger:"hover"}},[i("template",{slot:"title"},[e._v("设置每张门票的减少金额")]),i("a-icon",{staticClass:"ml-10",attrs:{type:"question-circle"}})],2)],1),i("span",{attrs:{slot:"discountRateTitle"},slot:"discountRateTitle"},[e._v(" 折扣比例 "),i("a-tooltip",{attrs:{trigger:"hover"}},[i("template",{slot:"title"},[e._v("设置每张门票的折扣比列（范围0-10）")]),i("a-icon",{staticClass:"ml-10",attrs:{type:"question-circle"}})],2)],1)])],1)],1),2!=e.formData.status?i("a-form-model-item",{attrs:{"wrapper-col":{span:16,offset:2}}},[i("div",{staticClass:"mt-20 mb-20"},[i("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveData()}}},[e._v(" 保存")])],1)]):e._e()],1),i("select-goods",{ref:"selectGoods",attrs:{source:"limited",startTime:e.formData.start_time,endTime:e.formData.end_time,selectedList:e.goodsList},on:{submit:e.selecrGoodsSubmit}})],1)},s=[],a=(i("ac1f"),i("1276"),i("d81d"),i("35b3"),i("a9e3"),i("b680"),i("d3b7"),i("159b"),i("a434"),i("25f0"),i("4de4"),i("4d95")),r=i("c1df"),n=i.n(r),l=i("1b98"),c=(i("ca00"),i("ac0d")),d={name:"ScenicToolsLimitEdit",mixins:[c["d"]],components:{SelectGoods:l["default"]},data:function(){return{id:"",addGoodsModalVisible:!1,formData:{name:"",start_time:"",end_time:"",time_type:1,cycle_type:1,cycle_date:[],cycle_start_time:"00:00",cycle_end_time:"00:00",remove_type:1,buy_limit:0,is_discount_share:1,goods_info:"",notice_type:1,notice_time:""},rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],start_time:[{required:!0,message:"请选择活动开始时间",trigger:["blur","change"]}],end_time:[{required:!0,message:"请选择活动结束时间",trigger:["blur","change"]}],time_type:[{required:!0,message:"请选择秒杀活动时间",trigger:"blur"}],buy_limit:[{required:!0,message:"请选择限购数量",trigger:"blur"}],is_discount_share:[{required:!0,message:"请选择优惠是否同享",trigger:"blur"}],goods_info:[{required:!0,message:"请添加活动商品",trigger:"blur"}]},columns:[{title:"景区信息",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"秒杀门票",dataIndex:"tickect_name",scopedSlots:{customRender:"tickect_name"}},{title:"当前库存",dataIndex:"stock_num",scopedSlots:{customRender:"stockNum"}},{dataIndex:"act_stock_num",key:"act_stock_num",slots:{title:"actStockNumTitle"},scopedSlots:{customRender:"actStockNum"}},{title:"原价格",dataIndex:"price",scopedSlots:{customRender:"price"}},{dataIndex:"reduce_money",key:"reduce_money",slots:{title:"reduceMoneyTitle"},scopedSlots:{customRender:"reduceMoney"}},{dataIndex:"discount_rate",key:"discount_rate",slots:{title:"discountRateTitle"},scopedSlots:{customRender:"discountRate"}},{title:"活动价",dataIndex:"act_price",scopedSlots:{customRender:"act_price"}},{title:"操作",dataIndex:"goods_id",width:"100px",scopedSlots:{customRender:"action"}}],goodsList:[],selectedRowKeys:[],reduce_money:"",discount_rate:"",reduce_money_visible:!1,discount_rate_visible:!1,start_time:null,end_time:null,showTime:{format:"HH:mm"},dateFormat:"YYYY-MM-DD HH:mm"}},watch:{"$route.query.id":function(e){var t=this;this.$nextTick((function(){t.activatedFlag&&e?(t.id=e,t.resetForm(),t.getFormData()):(t.id="",t.resetForm())}))}},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,type:"checkbox",onChange:this.onSelectChange,getCheckboxProps:function(e){return{props:{}}}}}},created:function(){this.resetForm(),this.$route.query.id&&(this.id=this.$route.query.id,this.getFormData())},methods:{moment:n.a,disabledStartDate:function(e){return e<n()().add(-1,"d")},disabledEndDate:function(e){var t=this.start_time;return t?t.valueOf()>=e.valueOf():e<n()().add(-1,"d")},onDateStartChange:function(e,t){this.$set(this.formData,"start_time",t),this.$refs.startTime.onFieldChange()},onDateEndChange:function(e,t){var i=n()(this.formData.start_time).valueOf(),o=n()(t).valueOf();console.log("1-----------活动结束时间选择"),console.log(i),console.log(o),o<=i?this.$message.error("活动结束时间必须大于活动开始时间！"):(this.$set(this.formData,"end_time",t),this.$refs.endTime.onFieldChange())},changeTimeType:function(e){1==e.target.value?(this.showTime={format:"HH:mm"},this.dateFormat="YYYY-MM-DD HH:mm"):(this.showTime=!1,this.dateFormat="YYYY-MM-DD")},getFormData:function(){var e=this;this.request(a["a"].getLimitedInfo,{id:this.id}).then((function(t){e.start_time=n()(t.start_time),e.end_time=n()(t.end_time),1==t.time_type?(e.showTime={format:"HH:mm"},e.dateFormat="YYYY-MM-DD HH:mm"):(e.showTime=!1,e.dateFormat="YYYY-MM-DD"),2==t.time_type&&2==t.cycle_type&&(t.cycle_date=t.cycle_date.split(",")),e.$set(e,"formData",t);var i=t.goods_info||[];e.goodsList=i.length?i.map((function(e){return e})):[]}))},cycleTypeChange:function(){2==this.formData.cycle_type?this.$set(this.formData,"cycle_date",[]):this.$set(this.formData,"cycle_date","")},onCycleStimeeRangeChange:function(e,t){this.$set(this.formData,"cycle_start_time",t)},onCycleEtimeeRangeChange:function(e,t){this.$set(this.formData,"cycle_end_time",t)},handleChange:function(e,t,i,o){var s=this;this.goodsList=this.goodsList.map((function(t){if(t.ticket_id==o)if(t[i]=s[i],"act_stock_num"==i)t.act_stock_num=e;else if("reduce_money"==i){t.act_price=Math.round(100*(t.price-e+Number.EPSILON))/100,t.reduce_money=Math.round(100*(e+Number.EPSILON))/100;var a=(10*(1-e/t.price)).toFixed(2);a=a>0?a:.01;var r=t.price>0?a:0;t.discount_rate=r}else if("discount_rate"==i){t.discount_rate=e;var n=(1-e/10)*t.price;t.reduce_money=Math.round(100*(n+Number.EPSILON))/100,t.act_price=Math.round(100*(t.price-t.reduce_money+Number.EPSILON))/100}return t}))},batchSet:function(e,t){var i=this,o=0;this.goodsList.forEach((function(e){o=e.price})),"reduce_money"==t&&Number(this.reduce_money)>Number(o)?this.$message.error("批量设置减少金额不能大于原价格"):(this.reduce_money_visible=!1,this.discount_rate_visible=!1,"discount_rate"==t&&Number(this.discount_rate)>10?this.$message.error("批量设置折扣比例不能大于10"):(this.reduce_money_visible=!1,this.discount_rate_visible=!1,this.goodsList=this.goodsList.map((function(e){if("reduce_money"==t){e.act_price=Math.round(100*(e.price-i.reduce_money+Number.EPSILON))/100,e.reduce_money=Math.round(100*(i.reduce_money+Number.EPSILON))/100;var o=e.price>0?(i.reduce_money/e.price*10).toFixed(2):0;e.discount_rate=10-o}else{e.discount_rate=i.discount_rate;var s=(1-e.discount_rate/10)*e.price;e.reduce_money=Math.round(100*(s+Number.EPSILON))/100,e.act_price=Math.round(100*(e.price-e.reduce_money+Number.EPSILON))/100}return e})),"reduce_money"==t?this.reduce_money="":"discount_rate"==t&&(this.discount_rate="")))},addProduct:function(){this.start_time&&this.end_time?this.$refs.selectGoods.openDialog():this.$message.error("请先选择活动起止日期！")},selecrGoodsSubmit:function(e){console.log(e,"e-----selecrGoodsSubmit-----选择商品回调"),e.goods=e.goods.map((function(e){return e.type="limited",e.act_price=e.price,e.act_stock_num=e.stock_num,e.tickect_name=e.title,e.stock_type=e.stock_type,e})),this.goodsList=e.goods,this.$set(this.formData,"goods_info",this.goodsList.length?this.goodsList[0]:"")},onSelectChange:function(e){this.selectedRowKeys=e},removeGoods:function(e){if(e.ticket_id)for(var t=0;t<this.goodsList.length;t++)this.goodsList[t].ticket_id===e.ticket_id&&this.goodsList.splice(t,1)},resetForm:function(){this.formData=this.$options.data().formData,this.start_time=this.$options.data().start_time,this.end_time=this.$options.data().end_time,this.goodsList=[],this.$forceUpdate()},saveData:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return console.log("error submit!!",e.formData),!1;var i={};for(var o in e.formData)i[o]=e.formData[o];if(0!=e.goodsList.length)if(e.id&&(i.id=e.id),i.start_time&&i.end_time){if(1==i.time_type){var s=n()(i.start_time).valueOf(),r=n()(i.end_time).valueOf();if(r<=s)return void e.$message.error("活动结束时间必须大于活动开始时间！")}else{var l=n()(i.start_time).valueOf(),c=n()(i.end_time).valueOf();if(c<=l)return void e.$message.error("周期结束时间必须大于活动开始时间！")}if(2==i.cycle_type){if(!i.cycle_date.length)return void e.$message.error("请选择每周周期");i.cycle_date=i.cycle_date.toString()}if(3!=i.cycle_type||i.cycle_date)if(e.goodsList.length){i.goods_sku=JSON.stringify(e.goodsList);var d=JSON.parse(JSON.stringify(e.goodsList)).filter((function(e){if(e.act_stock_num&&Number(e.act_stock_num)>Number(e.stock_num)&&-1!=e.stock_num&&1==e.stock_type)return e}))||[];if(d.length)e.$message.error("商品活动库存不能大于当前库存");else{var m=JSON.parse(JSON.stringify(e.goodsList)).filter((function(e){return null==e.reduce_money||void 0==e.reduce_money||0==e.reduce_money||null==e.discount_rate||void 0==e.discount_rate||0==e.discount_rate?e:void 0}))||[];m.length?e.$message.error("请设置商品的减少金额或折扣"):(console.log(i),delete i.goods_info,e.request(a["a"].updateLimited,i).then((function(t){e.resetForm(),e.id&&e.getFormData(),e.$message.success("提交成功！"),e.$router.push({path:"/merchant/merchant.life_tools/scenicToolsLimitList"}),sessionStorage.setItem("limitedEdit",1)})))}}else e.$message.error("请选择活动商品");else e.$message.error("请填写每月周期")}else e.$message.error("请先选择活动起止日期！");else e.$message.error("请选择活动商品")}))}}},m=d,u=i("2877"),f=Object(u["a"])(m,o,s,!1,null,"7a9fef5a",null);t["default"]=f.exports},"39fd":function(e,t,i){},"4d95":function(e,t,i){"use strict";var o={getTicketList:"life_tools/merchant.LifeToolsTicket/getList",getTicketDetail:"life_tools/merchant.LifeToolsTicket/getDetail",ticketDel:"life_tools/merchant.LifeToolsTicket/del",TicketEdit:"life_tools/merchant.LifeToolsTicket/addOrEdit",getLifeToolsList:"life_tools/merchant.LifeTools/getInformationList",setLifeToolsAttrs:"life_tools/merchant.LifeTools/setLifeToolsAttrs",getSportsOrderList:"/life_tools/merchant.SportsOrder/getOrderList",exportToolsOrder:"/life_tools/merchant.SportsOrder/exportToolsOrder",getSportsOrderDetail:"/life_tools/merchant.SportsOrder/getOrderDetail",agreeSportsOrderRefund:"/life_tools/merchant.SportsOrder/agreeRefund",refuseSportsOrderRefund:"/life_tools/merchant.SportsOrder/refuseRefund",getEditInfo:"life_tools/merchant.LifeToolsTicket/getEditInfo",getCategoryList:"life_tools/merchant.LifeToolsCategory/getCategoryList",getMapConfig:"life_tools/merchant.LifeTools/getMapConfig",getAddressList:"life_tools/merchant.LifeTools/getAddressList",addEditLifeTools:"life_tools/merchant.LifeTools/addEditLifeTools",getLifeToolsDetail:"life_tools/merchant.LifeTools/getLifeToolsDetail",delLifeTools:"life_tools/merchant.LifeTools/delLifeTools",getReplyList:"/life_tools/merchant.LifeToolsReply/searchReply",isShowReply:"/life_tools/merchant.LifeToolsReply/isShowReply",getReplyDetails:"/life_tools/merchant.LifeToolsReply/getReplyDetails",delReply:"/life_tools/merchant.LifeToolsReply/delReply",subReply:"/life_tools/merchant.LifeToolsReply/subReply",getReplyContent:"/life_tools/merchant.LifeToolsReply/getReplyContent",getCardList:"/life_tools/merchant.EmployeeCard/getCardList",editCard:"/life_tools/merchant.EmployeeCard/editCard",saveCard:"/life_tools/merchant.EmployeeCard/saveCard",delCard:"/life_tools/merchant.EmployeeCard/delCard",getSportsVerifyList:"/life_tools/merchant.SportsOrder/getVerifyList",exportVerifyRecord:"/life_tools/merchant.SportsOrder/exportVerifyRecord",getLimitedList:"/life_tools/merchant.LifeScenicLimitedAct/getLimitedList",updateLimited:"/life_tools/merchant.LifeScenicLimitedAct/addLimited",limitedChangeState:"/life_tools/merchant.LifeScenicLimitedAct/changeState",removeLimited:"/life_tools/merchant.LifeScenicLimitedAct/del",getLimitedInfo:"/life_tools/merchant.LifeScenicLimitedAct/edit",getMerchantSort:"/life_tools/merchant.LifeToolsTicket/getMerchantSort",getLifeToolsTicket:"/life_tools/merchant.LifeToolsTicket/getLifeToolsTicket",getToolsCardList:"/life_tools/merchant.LifeTools/getToolsCardList",AddOrEditToolsCard:"/life_tools/merchant.LifeTools/AddOrEditToolsCard",getToolsCardEdit:"/life_tools/merchant.LifeTools/getToolsCardEdit",delToolsCard:"/life_tools/merchant.LifeTools/delToolsCard",getAllToolsList:"/life_tools/merchant.LifeTools/getAllToolsList",getToolsCardRecord:"/life_tools/merchant.LifeTools/getToolsCardRecord",getCardOrderList:"/life_tools/merchant.LifeTools/getCardOrderList",getCardOrderDetail:"/life_tools/merchant.LifeTools/getCardOrderDetail",agreeCardOrderRefund:"/life_tools/merchant.LifeTools/agreeCardOrderRefund",refuseCardOrderRefund:"/life_tools/merchant.LifeTools/refuseCardOrderRefund",getSportsActivityList:"/life_tools/merchant.LifeToolsSportsActivity/getSportsActivityList",updateSportsActivityStatus:"/life_tools/merchant.LifeToolsSportsActivity/updateSportsActivityStatus",getSportsActivityOrderList:"/life_tools/merchant.LifeToolsSportsActivity/getSportsActivityOrderList",addSportsActivity:"/life_tools/merchant.LifeToolsSportsActivity/addSportsActivity",editSportsActivity:"/life_tools/merchant.LifeToolsSportsActivity/editSportsActivity",getTravelList:"/life_tools/merchant.LifeToolsGroupTravelAgency/getTravelList",agencyAudit:"/life_tools/merchant.LifeToolsGroupTravelAgency/audit",getStaffList:"/life_tools/merchant.LifeToolsTicket/getStaffList",getAppointList:"life_tools/merchant.LifeToolsAppoint/getList",getAppointMsg:"life_tools/merchant.LifeToolsAppoint/getToolAppointMsg",saveAppoint:"life_tools/merchant.LifeToolsAppoint/saveToolAppoint",lookAppointUser:"life_tools/merchant.LifeToolsAppoint/lookAppointUser",closeAppoint:"life_tools/merchant.LifeToolsAppoint/closeAppoint",exportAppointUserOrder:"life_tools/merchant.LifeToolsAppoint/exportUserOrder",delAppoint:"life_tools/merchant.LifeToolsAppoint/delAppoint",getSeatMap:"/life_tools/merchant.LifeToolsAppoint/getSeatMap",getAppointOrderDetail:"life_tools/merchant.LifeToolsAppoint/getAppointOrderDetail",auditRefund:"life_tools/merchant.LifeToolsAppoint/auditRefund",suspend:"life_tools/merchant.LifeToolsAppoint/suspend",getSportsSecondsKillList:"/life_tools/merchant.LifeToolsSportsSecondsKill/getSecondsKillList",saveSportsSecondsKill:"/life_tools/merchant.LifeToolsSportsSecondsKill/saveSecondsKill",ChangeSportsSecondsKill:"/life_tools/merchant.LifeToolsSportsSecondsKill/ChangeSportsSecondsKill",delSportsSecondsKill:"/life_tools/merchant.LifeToolsSportsSecondsKill/delSecondsKill",getSportsSecondsKillDetail:"/life_tools/merchant.LifeToolsSportsSecondsKill/getSecondsKillDetail",getGroupTicketList:"life_tools/merchant.group/getGroupTicketList",getGroupLifeToolsTicket:"life_tools/merchant.LifeToolsTicket/getLifeToolsTicket",addGroupTicket:"life_tools/merchant.group/addGroupTicket",delGroupTicket:"life_tools/merchant.group/delGroupTicket",editSettingData:"life_tools/merchant.group/editSettingData",editGroupTicket:"life_tools/merchant.group/editGroupTicket",getSettingDataDetail:"life_tools/merchant.group/getSettingDataDetail",getStatisticsData:"life_tools/merchant.LifeToolsGroupOrder/getStatisticsData",getOrderList:"life_tools/merchant.LifeToolsGroupOrder/getOrderList",getOrderAuditList:"/life_tools/merchant.LifeToolsGroupOrder/getAuditGroupOrderList",orderAudit:"/life_tools/merchant.LifeToolsGroupOrder/audit",groupOrderRefand:"life_tools/merchant.LifeToolsGroupOrder/groupOrderRefand",editDistributionPrice:"life_tools/merchant.LifeToolsDistribution/editDistributionPrice",getDistributionSettingDataDetail:"/life_tools/merchant.LifeToolsDistribution/getSettingDataDetail",getDistributionSettingeditSetting:"/life_tools/merchant.LifeToolsDistribution/editSetting",getAtatisticsInfo:"/life_tools/merchant.LifeToolsDistribution/getAtatisticsInfo",getDistributorList:"/life_tools/merchant.LifeToolsDistribution/getDistributorList",getLowerLevel:"/life_tools/merchant.LifeToolsDistribution/getLowerLevel",audit:"/life_tools/merchant.LifeToolsDistribution/audit",getDistributionOrderList:"/life_tools/merchant.LifeToolsDistribution/getDistributionOrderList",editDistributionOrderNote:"/life_tools/merchant.LifeToolsDistribution/editDistributionOrderNote",delDistributor:"/life_tools/merchant.LifeToolsDistribution/delDistributor",addStatement:"/life_tools/merchant.LifeToolsDistribution/addStatement",getStatementList:"/life_tools/merchant.LifeToolsDistribution/getStatement",getStatementDetail:"/life_tools/merchant.LifeToolsDistribution/getStatementDetail",lifeToolsAudit:"/life_tools/platform.LifeTools/lifeToolsAudit",auditTicket:"/life_tools/platform.LifeToolsTicket/auditTicket",getMapCity:"/g=Index&c=Map&a=suggestion",getCarParkList:"/life_tools/merchant.LifeToolsCarPark/getCarParkList",addCarPark:"/life_tools/merchant.LifeToolsCarPark/addCarPark",showCarPark:"/life_tools/merchant.LifeToolsCarPark/showCarPark",getToolsList:"/life_tools/merchant.LifeToolsCarPark/getToolsList",deleteCarPark:"/life_tools/merchant.LifeToolsCarPark/deleteCarPark",statusCarPark:"/life_tools/merchant.LifeToolsCarPark/statusCarPark",wifiList:"life_tools/merchant.LifeToolsWifi/wifiList",wifiAdd:"life_tools/merchant.LifeToolsWifi/wifiAdd",wifiShow:"life_tools/merchant.LifeToolsWifi/wifiShow",wifiStatusChange:"life_tools/merchant.LifeToolsWifi/wifiStatusChange",wifiDelete:"life_tools/merchant.LifeToolsWifi/wifiDelete",scenicMapSave:"/life_tools/merchant.LifeToolsScenicMap/saveMap",scenicMapPlaceList:"/life_tools/merchant.LifeToolsScenicMap/mapPlaceList",scenicMapPlaceSave:"/life_tools/merchant.LifeToolsScenicMap/saveMapPlace",scenicMapPlaceDel:"/life_tools/merchant.LifeToolsScenicMap/mapPlaceDel",scenicMapLineList:"/life_tools/merchant.LifeToolsScenicMap/mapLineList",scenicMapLineSave:"/life_tools/merchant.LifeToolsScenicMap/saveMapLine",scenicMapLineDel:"/life_tools/merchant.LifeToolsScenicMap/mapLineDel",scenicMapScenicList:"/life_tools/merchant.LifeToolsScenicMap/scenicList",scenicMapPlaceCatList:"/life_tools/merchant.LifeToolsScenicMap/categoryList",scenicMapPlaceCategoryDel:"/life_tools/merchant.LifeToolsScenicMap/categoryDel",scenicMapPlaceCategorySave:"/life_tools/merchant.LifeToolsScenicMap/saveCategory",scenicMapList:"/life_tools/merchant.LifeToolsScenicMap/mapList",scenicMapDel:"/life_tools/merchant.LifeToolsScenicMap/mapDel",scenicMapStatusSave:"/life_tools/merchant.LifeToolsScenicMap/saveMapStatus",changeCloseStatus:"life_tools/merchant.LifeTools/changeCloseStatus",getAddEditCardMerchantInfo:"/life_tools/merchant.LifeTools/getAddEditCardMerchantInfo"};t["a"]=o},ed37:function(e,t,i){"use strict";i("39fd")}}]);