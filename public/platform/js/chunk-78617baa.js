(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78617baa","chunk-237d90a6"],{"0b52":function(t,e,a){"use strict";a.r(e);a("54f8");var i=function(){var t=this,e=t._self._c;return e("div",[e("a-drawer",{attrs:{width:1450,title:"抄表记录",visible:t.visible_record,maskClosable:!1,"confirm-loading":t.confirmLoading,"dialog-style":{top:"20px"}},on:{close:t.handleCancel}},[e("div",{staticClass:"message-suggestions-list-box"},[e("div",{staticClass:"search-box",staticStyle:{"margin-top":"12px","margin-left":"10px"}},[e("a-row",{staticStyle:{"margin-bottom":"12px"},attrs:{gutter:48}},[e("a-col",{staticStyle:{"padding-right":"0px"},attrs:{md:6,sm:14}},[e("label",{staticStyle:{"margin-top":"5px"}},[t._v("房间：")]),e("a-cascader",{staticClass:"cascader_style margin_left_10",attrs:{options:t.options,"load-data":t.loadDataFunc,placeholder:"请选择房间","change-on-select":""},on:{change:t.setVisionsFunc},model:{value:t.room_id,callback:function(e){t.room_id=e},expression:"room_id"}})],1),e("a-col",{staticClass:"padding-tp10",staticStyle:{"padding-left":"5px","padding-right":"1px",width:"470px"},attrs:{md:8,sm:20}},[e("label",{staticStyle:{"margin-top":"5px"}},[t._v("时间筛选：")]),e("a-range-picker",{staticStyle:{width:"325px"},attrs:{allowClear:!0},on:{change:t.dateChange},model:{value:t.date_time,callback:function(e){t.date_time=e},expression:"date_time"}},[e("a-icon",{attrs:{slot:"suffixIcon",type:"calendar"},slot:"suffixIcon"})],1)],1),t.is_show?e("a-col",{staticClass:"padding-tp10",staticStyle:{"padding-left":"5px","padding-right":"1px",width:"210px"},attrs:{md:6,sm:24}},[e("label",{staticClass:"label_title"},[t._v("交易类型：")]),e("a-select",{staticStyle:{width:"110px"},attrs:{"show-search":"",placeholder:"请选择"},model:{value:t.transaction_type,callback:function(e){t.transaction_type=e},expression:"transaction_type"}},t._l(t.pay_order_type,(function(a,i){return e("a-select-option",{attrs:{value:a.value}},[t._v(" "+t._s(a.name)+" ")])})),1)],1):t._e(),e("a-col",{staticStyle:{"padding-left":"0px","padding-right":"1px",width:"90px"},attrs:{md:2,sm:24}},[e("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(e){return t.searchList()}}},[t._v(" 查询 ")])],1),e("a-col",{attrs:{md:2,sm:24}},[e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.printList()}}},[t._v("Excel导出")])],1),e("a-col",{attrs:{md:2,sm:24}},[e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.$refs.createUploadModal.add(t.charge_name,t.project_id)}}},[t._v("导入")])],1)],1)],1),e("br"),e("a-table",{staticClass:"components-table-demo-nested",attrs:{columns:t.is_show?t.columns1:t.columns,"data-source":t.data,pagination:t.pagination,loading:t.loading},on:{change:t.table_change},scopedSlots:t._u([{key:"action",fn:function(a,i){return e("span",{},[1==i.is_edit?e("a",{on:{click:function(e){return t.$refs.addMeter.edit(i)}}},[t._v("修改")]):t._e(),1==i.order_is_pay&&i.mdy_change_ammeter>0&&i.mdy_change_money>0?e("a-divider",{attrs:{type:"vertical"}}):t._e(),1==i.order_is_pay&&i.mdy_change_ammeter>0&&i.mdy_change_money>0?e("a",{attrs:{loading:t.createNewOrderLoading},on:{click:function(e){return t.createNewOrder(i)}}},[t._v("生成收费账单")]):t._e()],1)}}])},[e("span",{attrs:{slot:"footer"},slot:"footer"},[t._v(" 总计抄表用量："+t._s(t.total_info.cost_degrees)+"    总计金额："+t._s(t.total_info.cost_money)+" ")])])],1)]),e("meter-upload",{ref:"createUploadModal",attrs:{height:800,width:500},on:{ok:t.handleOks}}),e("add-meter",{ref:"addMeter",on:{okk:t.handleOks}})],1)},n=[],o=a("4bb5d"),s=a("dff4"),r=a("d34b"),l=(a("aa48"),a("8f7e"),a("075f"),a("c5cb"),a("4868"),a("a0e0")),d=a("ca00"),c=a("d2cd"),h=a("b794"),u=[{title:"住址",dataIndex:"address",key:"address"},{title:"姓名",dataIndex:"name",key:"name"},{title:"电话",dataIndex:"phone",key:"phone"},{title:"单价(元)",dataIndex:"unit_price",key:"unit_price"},{title:"倍率",dataIndex:"rate",key:"rate"},{title:"抄表时间",dataIndex:"add_time_txt",key:"add_time_txt"},{title:"起度",dataIndex:"start_ammeter",key:"start_ammeter"},{title:"止度",dataIndex:"last_ammeter",key:"last_ammeter"},{title:"总价(元)",dataIndex:"cost_money",key:"cost_money"},{title:"操作人",dataIndex:"realname",key:"realname"},{title:"备注",dataIndex:"note",key:"note"},{title:"操作",dataIndex:"",width:190,key:"action",scopedSlots:{customRender:"action"}}],m=[{title:"住址",dataIndex:"address",key:"address"},{title:"姓名",dataIndex:"name",key:"name"},{title:"电话",dataIndex:"phone",key:"phone"},{title:"单价(元)",dataIndex:"unit_price",key:"unit_price"},{title:"倍率",dataIndex:"rate",key:"rate"},{title:"抄表时间",dataIndex:"opt_meter_time_str",key:"opt_meter_time_str"},{title:"起度",dataIndex:"start_ammeter",key:"start_ammeter"},{title:"止度",dataIndex:"last_ammeter",key:"last_ammeter"},{title:"总价(元)",dataIndex:"cost_money",key:"cost_money"},{title:"交易类型",dataIndex:"transaction_type_txt",key:"transaction_type_txt"},{title:"操作人",dataIndex:"realname",key:"realname"},{title:"备注",dataIndex:"note",key:"note"},{title:"操作",dataIndex:"",width:190,key:"action",scopedSlots:{customRender:"action"}}],p=[],g={components:{meterUpload:c["default"],addMeter:h["default"]},data:function(){var t=this;return{is_show:!0,visible_record:!1,confirmLoading:!1,data:p,columns:u,columns1:m,options:[],pay_order_type:[{name:"全部",value:0},{name:"购买",value:1},{name:"缴费",value:2}],pagination:{current:1,pageSize:10,total:10,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:function(t){return"共 ".concat(t," 条")},onShowSizeChange:function(e,a){return t.onTableChange(e,a)},onChange:function(e,a){return t.onTableChange(e,a)}},loading:!1,charge_name:"",rule_name:"",project_id:0,page:1,room_id:[],transaction_type:"",date_time:[],tokenName:"",sysName:"",createNewOrderLoading:!1,total_info:[]}},mounted:function(){var t=Object(d["i"])(location.hash);t?(this.tokenName=t+"_access_token",this.sysName=t):this.sysName="village"},methods:{dateChange:function(t,e){this.date_time=e,console.log("dateString",this.date_time)},get:function(t,e,a){this.date_time=[],this.room_id=[],this.charge_name=t,this.project_id=e,this.page=1,a&&(this.rule_name=a),this.getList(t,e),this.getSingleListByVillage(),this.visible_record=!0},printList:function(){var t=this;this.loading=!0,this.request(l["a"].printRecordList,{charge_name:this.charge_name,room_id:this.room_id,date_time:this.date_time,tokenName:this.tokenName,rule_name:this.rule_name,project_id:this.project_id}).then((function(e){window.location.href=e.url,t.loading=!1}))},createNewOrder:function(t){var e="生成新收费订单确认",a="止度增加了"+t.mdy_change_ammeter+"，费用增加了"+t.mdy_change_money+"元，您确认生成收费账单吗？",i=this;this.$confirm({title:e,content:a,onOk:function(){i.createNewOrderLoading=!0;var e={idd:t.id,mdy_change_ammeter:t.mdy_change_ammeter,mdy_change_money:t.mdy_change_money,tokenName:i.tokenName};i.request(l["a"].addMdyMeterReadingOrder,e).then((function(t){i.createNewOrderLoading=!1,i.$message.success("操作成功"),i.getList(i.charge_name,i.project_id)}))},onCancel:function(){}})},handleOks:function(){this.getList(this.charge_name,this.project_id)},handleCancel:function(){this.visible_record=!1},onTableChange:function(t,e){this.page=t,this.pagination.current=t,this.pagination.pageSize=e,this.getList(this.charge_name,this.project_id),console.log("onTableChange==>",t,e)},table_change:function(t){console.log("e",t),t.current&&t.current>0&&(this.page=t.current,this.getList(this.charge_name,this.project_id))},getList:function(t,e){var a=this;this.loading=!0,this.request(l["a"].getMeterReadingRecord,{charge_name:t,project_id:e,page:this.page,limit:this.pagination.pageSize,room_id:this.room_id,date_time:this.date_time,tokenName:this.tokenName,single_id:this.single_id,floor_id:this.floor_id,layer_id:this.layer_id,transaction_type:this.transaction_type}).then((function(t){a.pagination.total=t.count?t.count:0,a.pagination.pageSize=t.total_limit?t.total_limit:10,a.data=t.list,a.total_info=t.total_info,a.is_show=t.is_show,a.loading=!1}))},searchList:function(){console.log("search",this.search),this.getList(this.charge_name,this.project_id)},getSingleListByVillage:function(){var t=this;this.request(l["a"].getSingleListByVillage,{tokenName:this.tokenName}).then((function(e){if(console.log("+++++++Single",e),e){var a=[];e.map((function(t){a.push({label:t.name,value:t.id,isLeaf:!1})})),t.options=a}}))},getFloorList:function(t){var e=this;return new Promise((function(a){e.request(l["a"].getFloorList,{pid:t,tokenName:e.tokenName}).then((function(t){console.log("+++++++Single",t),console.log("resolve",a),a(t)}))}))},getLayerList:function(t){var e=this;return new Promise((function(a){e.request(l["a"].getLayerList,{pid:t,tokenName:e.tokenName}).then((function(t){console.log("+++++++Single",t),t&&a(t)}))}))},getVacancyList:function(t){var e=this;return new Promise((function(a){e.request(l["a"].getVacancyList,{pid:t,tokenName:e.tokenName}).then((function(t){console.log("+++++++Single",t),t&&a(t)}))}))},loadDataFunc:function(t){return Object(r["a"])(Object(s["a"])().mark((function e(){var a;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=t[t.length-1],a.loading=!0,setTimeout((function(){a.loading=!1}),100);case 3:case"end":return e.stop()}}),e)})))()},setVisionsFunc:function(t){var e=this;return Object(r["a"])(Object(s["a"])().mark((function a(){var i,n,r,l,d,c,h,u,m,p,g,_;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(1!==t.length){a.next=12;break}return i=Object(o["a"])(e.options),a.next=4,e.getFloorList(t[0]);case 4:n=a.sent,console.log("res",n),r=[],n.map((function(t){return r.push({label:t.name,value:t.id,isLeaf:!1}),i["children"]=r,!0})),i.find((function(e){return e.value===t[0]}))["children"]=r,e.options=i,a.next=39;break;case 12:if(2!==t.length){a.next=24;break}return a.next=15,e.getLayerList(t[1]);case 15:l=a.sent,d=Object(o["a"])(e.options),c=[],l.map((function(t){return c.push({label:t.name,value:t.id,isLeaf:!1}),!0})),h=d.find((function(e){return e.value===t[0]})),h.children.find((function(e){return e.value===t[1]}))["children"]=c,e.options=d,a.next=39;break;case 24:if(3!==t.length){a.next=38;break}return a.next=27,e.getVacancyList(t[2]);case 27:u=a.sent,m=Object(o["a"])(e.options),p=[],u.map((function(t){return p.push({label:t.name,value:t.id,isLeaf:!0}),!0})),g=m.find((function(e){return e.value===t[0]})),_=g.children.find((function(e){return e.value===t[1]})),_.children.find((function(e){return e.value===t[2]}))["children"]=p,e.options=m,console.log("options",e.options),a.next=39;break;case 38:4===t.length&&console.log("room_id+++",e.room_id);case 39:case"end":return a.stop()}}),a)})))()}}},_=g,f=(a("2d48"),a("0b56")),y=Object(f["a"])(_,i,n,!1,null,"cec7494c",null);e["default"]=y.exports},"2b6b":function(t,e,a){},"2d48":function(t,e,a){"use strict";a("2b6b")},3117:function(t,e,a){"use strict";a("d015")},d015:function(t,e,a){},d2cd:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:t.title,width:300,visible:t.visibleUpload,maskClosable:!1,confirmLoading:t.confirmLoading,footer:null},on:{cancel:t.handleCancel}},[e("a-spin",{attrs:{spinning:t.confirmLoading,height:800}},[e("div",[e("span",[t._v("示例表格")]),e("a",{staticStyle:{"margin-left":"20px"},attrs:{href:"/static/file/village/meter/addMeter.xls",target:"_blank"}},[t._v("点击下载")])]),e("div",{staticStyle:{"border-bottom":"1px solid #dad8d8","border-top":"1px solid #dad8d8","margin-top":"20px"}},[e("span",[t._v("导入Excel")]),e("a-upload",{attrs:{name:"file","file-list":t.avatarFileList,action:t.upload,headers:t.headers,"before-upload":t.beforeUploadFile},on:{change:t.handleChangeUpload}},[e("a-button",{staticStyle:{margin:"20px   20px  10px"},attrs:{type:"primary"}},[e("a-icon",{attrs:{type:"upload"}}),t._v(" 导入 ")],1)],1)],1),t.show?e("div",{staticStyle:{"margin-top":"20px"}},[e("span",[t._v("导入失败")]),e("a",{staticStyle:{"margin-left":"20px"},attrs:{href:t.url,target:"_blank"}},[t._v("点击下载带入失败数据表格")])]):t._e()])],1)},n=[],o=a("a0e0"),s=a("ca00"),r={data:function(){return{upload:"/v20/public/index.php"+o["a"].uploadMeterFiles+"?upload_dir=/house/excel/meterUpload",avatarFileList:[],headers:{authorization:"authorization-text"},visibleUpload:!1,confirmLoading:!1,title:"导入",url:"",show:!1,fileloading:!1,data_arr:[],tokenName:"",sysName:"",charge_name:"",project_id:0}},activated:function(){var t=Object(s["i"])(location.hash);t?(this.tokenName=t+"_access_token",this.sysName=t):this.sysName="village"},methods:{add:function(t,e){this.title="导入",this.visibleUpload=!0,this.url=window.location.host+"/v20/runtime/demo.xlsx",this.avatarFileList=[],this.charge_name=t,this.project_id=e},beforeUploadFile:function(t){var e=t.size/1024/1024<20;return e?this.fileloading?(this.$message.warning("当前还有文件上传中，请等候上传完成!"),!1):e:(this.$message.error("上传图片最大支持20MB!"),!1)},handleChangeUpload:function(t){var e=this;if(console.log("########",t),t.file&&!t.file.status&&this.fileloading)return!1;if("uploading"===t.file.status){if(this.fileloading)return!1;this.fileloading=!0,this.avatarFileList=t.fileList}if("uploading"!==t.file.status&&(this.fileloading=!1,console.log(t.file,t.fileList)),"done"==t.file.status&&t.file&&t.file.response){var a=t.file.response;if(1e3===a.status)this.data_arr.push(a.data),console.log("data_arr",this.data_arr),this.avatarFileList=t.fileList,console.log("--------",a.data.url),this.request(o["a"].exportMeter,{tokenName:this.tokenName,file:a.data.url,charge_name:this.charge_name}).then((function(t){t.error?(e.$parent.getList(e.charge_name,e.project_id),e.$message.success("上传成功")):window.location.href=t.data})),this.visibleUpload=!1;else for(var i in this.$message.error(t.file.response.msg),this.avatarFileList=[],t.fileList)if(t.fileList[i]){var n=t.fileList[i];console.log("info_1",n),n&&n.response&&1e3===n.response.status&&this.avatarFileList.push(n)}}if("removed"==t.file.status&&t.file){var s=t.file.response;if(s&&1e3===s.status)for(var i in this.data_arr=[],t.fileList)if(t.fileList[i]){var r=t.fileList[i];r&&r.response&&1e3===r.response.status&&this.data_arr.push(r.response.data)}this.avatarFileList=t.fileList,console.log("data_arr1",this.data_arr)}},handleCancel:function(){this.visibleUpload=!1}}},l=r,d=(a("3117"),a("0b56")),c=Object(d["a"])(l,i,n,!1,null,"21c34c8b",null);e["default"]=c.exports}}]);