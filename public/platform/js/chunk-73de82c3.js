(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73de82c3","chunk-7477f697","chunk-7477f697"],{1972:function(t,e,i){},49420:function(t,e){var i={getrem:function(){var t=1/window.devicePixelRatio;document.write('<meta name="viewport" content="width=device-width,initial-scale='+t+",minimum-scale="+t+",maximum-scale="+t+'" />');var e=document.getElementsByTagName("html")[0],i=e.getBoundingClientRect().width;e.style.fontSize=i/10+"px"}};t.exports=i},"6ac6":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"equipPoint"},[t._m(0),i("div",{staticClass:"btn_list"},[i("div",{staticClass:"draw_point",class:t.canDraw?"gray":null,on:{click:t.drawPoint}},[t._v("绘制设备点位")]),i("div",{staticClass:"edit_point",class:t.canDraw?"gray":null,on:{click:t.editPoint}},[t._v("编辑设备点位")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.canDraw&&t.pointArr.length>0,expression:"canDraw && pointArr.length>0"}],staticClass:"clear_point",on:{click:t.delCur}},[t._v("清除")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.canDraw&&t.pointArr.length>0,expression:"canDraw && pointArr.length>0"}],staticClass:"confirm_point",on:{click:t.savePoint}},[t._v("确定")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showEditbtn,expression:"showEditbtn"}],staticClass:"delete_point",on:{click:t.delPoint}},[t._v("删除")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showEditbtn,expression:"showEditbtn"}],staticClass:"confirm_point",class:t.choosePointStatus?"gray":null,on:{click:t.choosePoint}},[t._v(t._s(t.choosePointStatus?"取消选点":"选替换点"))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.choosePointStatus&&t.editArr.length>0,expression:"choosePointStatus && editArr.length>0"}],staticClass:"confirm_point",on:{click:t.editThis}},[t._v("确定替换")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.canEdit,expression:"canEdit"}],staticClass:"cancel_edit",on:{click:t.cancelEdit}},[t._v("退出编辑")])]),i("div",{ref:"canvas_con",staticClass:"draw_canvas",on:{click:t.selectPoint}},[i("img",{staticClass:"back_image",style:{width:t.canvasProp.width,height:t.canvasProp.height},attrs:{src:"https://img0.baidu.com/it/u=1324019691,3896841313&fm=26&fmt=auto"}}),i("canvas",{staticClass:"my_canvas",attrs:{id:"myCanvas",width:t.canvasProp.width,height:t.canvasProp.height}})]),i("a-modal",{attrs:{title:t.dialogTitle,visible:t.visible},on:{cancel:t.handleCancel}},[i("a-form-model",{attrs:{model:t.equipPointForm,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[i("a-form-model-item",{attrs:{label:"选择设备"}},[i("a-select",{staticStyle:{width:"200px"},attrs:{"show-search":"",placeholder:"请选择一个设备","option-filter-prop":"children","filter-option":t.filterOption},on:{change:t.selectChange},model:{value:t.equipPointForm.device_id,callback:function(e){t.$set(t.equipPointForm,"device_id",e)},expression:"equipPointForm.device_id"}},t._l(t.deviceList,(function(e,a){return i("a-select-option",{key:a,attrs:{value:e.device_id}},[t._v(" "+t._s(e.device_name)+" ")])})),1)],1),i("a-form-model-item",{attrs:{label:"设备Id"}},[i("a-input",{attrs:{disabled:""},model:{value:t.equipPointForm.device_id,callback:function(e){t.$set(t.equipPointForm,"device_id",e)},expression:"equipPointForm.device_id"}})],1),i("a-form-model-item",{attrs:{label:"设备类型"}},[i("a-input",{attrs:{disabled:""},model:{value:t.equipPointForm.device_type,callback:function(e){t.$set(t.equipPointForm,"device_type",e)},expression:"equipPointForm.device_type"}})],1),i("a-form-model-item",{attrs:{label:"横坐标"}},[i("a-input",{attrs:{disabled:""},model:{value:t.equipPointForm.coordinateX,callback:function(e){t.$set(t.equipPointForm,"coordinateX",e)},expression:"equipPointForm.coordinateX"}})],1),i("a-form-model-item",{attrs:{label:"纵坐标"}},[i("a-input",{attrs:{disabled:""},model:{value:t.equipPointForm.coordinateY,callback:function(e){t.$set(t.equipPointForm,"coordinateY",e)},expression:"equipPointForm.coordinateY"}})],1),i("a-form-model-item",{attrs:{label:"设备图标"}},[i("a-upload",{staticClass:"avatar-uploader",attrs:{name:"avatar","list-type":"picture-card","show-upload-list":!1,action:t.uploadUrl,"before-upload":t.beforeUpload},on:{change:t.handleChange}},[t.imageUrl?i("img",{staticStyle:{width:"6.25rem",height:"6.25rem"},attrs:{src:t.imageUrl,alt:"avatar"}}):i("div",[i("a-icon",{attrs:{type:t.loading?"loading":"plus"}}),i("div",{staticClass:"ant-upload-text"},[t._v(" Upload ")])],1)])],1)],1),i("template",{slot:"footer"},[i("a-button",{attrs:{type:"default"},on:{click:t.handleCancel}},[t._v("取消")]),i("a-button",{attrs:{type:"primary"},on:{click:t.handleOk}},[t._v("确定")])],1)],2)],1)},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tip"},[i("div",{staticClass:"tip_one"},[t._v(" 1、点击“绘制设备定位”按钮 前，状态为查看绘制，查看所有的绘制成功的设备点位数据，在查看页面支持绑定设备信息 ")]),i("div",{staticClass:"tip_two"},[t._v(" 2、点击“编辑设备定位”按钮，进入编辑设备点位页面，支持对设备的位置调整、调整后绑定设备数据不变；支持在编辑设备定位页面，删除定位数据，删除定位后，绑定的设备信息也删除。添加绘制设备定位页面，不显示删除按钮，只在编辑设备定位页面，显示删除按钮。一个设备点位只能绑定一个设备信息。 ")])])}],o=(i("b0c0"),i("d81d"),i("a0e0"));i("49420"),i("8bbf");function s(t,e){var i=new FileReader;i.addEventListener("load",(function(){return e(i.result)})),i.readAsDataURL(t)}var r={name:"equipPoint",data:function(){return{uploadUrl:"/v20/public/index.php/common/common.UploadFile/uploadPictures",pointArr:[],canvasProp:{width:0,height:0,top:0,left:0},canDraw:!1,canEdit:!1,visible:!1,labelCol:{span:6},wrapperCol:{span:16},equipPointForm:{device_id:"",device_name:"",device_type:"",coordinateX:"",coordinateY:"",img:""},deviceList:[],coordinate_list:[],loading:!1,imageUrl:"",dialogTitle:"",equipimgUrl:"",delPointarr:[],showEditbtn:!1,choosePointStatus:!1,editArr:[],device_id:null}},created:function(){var t=this;this.$nextTick((function(){var e=t.$refs.canvas_con.clientWidth,i=t.$refs.canvas_con.clientHeight,a=t.$refs.canvas_con.getBoundingClientRect().left,n=t.$refs.canvas_con.getBoundingClientRect().top;t.canvasProp.width=e-25+"px",t.canvasProp.height=i-25+"px",t.canvasProp.top=n,t.canvasProp.left=a})),this.getVillageAreaPic(),this.getDeviceList()},methods:{filterOption:function(t,e){return e.componentOptions.children[0].text.toLowerCase().indexOf(t.toLowerCase())>=0},getVillageAreaPic:function(){var t=this;this.request(o["a"].getAngeleyeImg,{type:3},"post").then((function(e){t.equipimgUrl=e.village_info.url,t.coordinate_list=e.coordinate_list,t.initDevicePoint()}))},uploadImg:function(t){t.file.status,"done"===t.file.status?this.$message.success("".concat(t.file.name," file uploaded successfully")):"error"===t.file.status&&this.$message.error("".concat(t.file.name," file upload failed."))},choosePoint:function(){if(this.choosePointStatus=!this.choosePointStatus,!this.choosePointStatus&&this.editArr.length>0){var t=document.getElementById("myCanvas").getContext("2d");t.clearRect(this.editArr[0].x-26,this.editArr[0].y-26,52,52),this.editArr=[]}},initDevicePoint:function(){var t=document.getElementById("myCanvas"),e=t.getContext("2d");e.fillStyle="#409EFF",this.coordinate_list.map((function(t){if(t.coordinate){var i=new Image;t.img?i.src=t.img:i.src="https://img2.baidu.com/it/u=622902245,3661794572&fm=26&fmt=auto",i.onload=function(){var a=e.createPattern(i,"no-repeat");e.fillStyle=a,e.fillRect(t.coordinate[0]-25,t.coordinate[1]-25,50,50),e.drawImage(i,t.coordinate[0]-25,t.coordinate[1]-25,50,50)}}}))},judgeDistance:function(t){var e=!1;return this.coordinate_list.map((function(i){if(i.coordinate){var a=t.x-25,n=t.x+25,o=t.y-25,s=t.y+25;a>i.coordinate[0]-26&&a<i.coordinate[0]+26&&o>i.coordinate[1]-26&&o<i.coordinate[1]+26?(e=!0,console.log("覆盖=============>1")):a>i.coordinate[0]-26&&a<i.coordinate[0]+26&&s>i.coordinate[1]-26&&s<i.coordinate[1]+26?(e=!0,console.log("覆盖=============>2")):n>i.coordinate[0]-26&&n<i.coordinate[0]+26&&o>i.coordinate[1]-26&&o<i.coordinate[1]+26?(e=!0,console.log("覆盖=============>3")):n>i.coordinate[0]-26&&n<i.coordinate[0]+26&&s>i.coordinate[1]-26&&s<i.coordinate[1]+26?(e=!0,console.log("覆盖=============>4")):console.log("未覆盖=======>")}})),e},selectPoint:function(t){var e=this;if(this.canDraw&&!this.canEdit&&!this.choosePointStatus){var i={};i.x=t.clientX-this.canvasProp.left-12.5,i.y=t.clientY-this.canvasProp.top-12.5;var a=this.judgeDistance(i);if(a&&0==this.pointArr.length)return void this.$message.warning("设备点位不可相互覆盖!");this.pointArr.push(i),this.pointArr.length<=1&&this.startDraw(i)}if(!this.canDraw&&!this.canEdit&&!this.choosePointStatus){var n=t.x-this.canvasProp.left-12.5,o=t.y-this.canvasProp.top-12.5;this.coordinate_list.map((function(t){if(t.coordinate){var i=t.coordinate[0],a=t.coordinate[1];i-25<n&&n<i+25&&a-25<o&&o<a+25&&(e.equipPointForm.coordinateX=t.coordinate[0],e.equipPointForm.coordinateY=t.coordinate[1],e.equipPointForm.device_id=t.device_id,e.equipPointForm.device_name=t.device_name,e.equipPointForm.device_type=t.device_type,e.equipPointForm.img=t.img,e.imageUrl=t.img,e.dialogTitle="编辑设备点位",e.visible=!0)}}))}if(this.canEdit&&!this.choosePointStatus){var s=t.x-this.canvasProp.left-12.5,r=t.y-this.canvasProp.top-12.5,c=!1;this.coordinate_list.map((function(t){if(t.coordinate){var i=t.coordinate[0],a=t.coordinate[1];if(i-25<s&&s<i+25&&a-25<r&&r<a+25){c=!0,e.delPointarr=[i,a],e.device_id=t.device_id,e.getVillageAreaPic();var n=setTimeout((function(){var t=document.getElementById("myCanvas"),o=t.getContext("2d");o.fillStyle="#000000",o.fillRect(i-10,a-10,20,20),e.showEditbtn=!0,clearTimeout(n)}),300)}}})),c||0!=this.delPointarr.length||this.$message.warning("请先点击选中一个设备点位！")}if(this.choosePointStatus){var l={};l.x=t.clientX-this.canvasProp.left-12.5,l.y=t.clientY-this.canvasProp.top-12.5;var d=this.judgeDistance(l);if(d&&0==this.editArr.length)return void this.$message.warning("所选点位不可与已选点位相互覆盖!");this.editArr.push(l),this.editArr.length<=1&&this.editDraw(l)}},cancelEdit:function(){if(this.getVillageAreaPic(),this.canDraw=!1,this.canEdit=!1,this.showEditbtn=!1,this.choosePointStatus=!1,this.delPointarr=[],this.device_id=null,this.editArr.length>0){var t=document.getElementById("myCanvas").getContext("2d");t.clearRect(this.editArr[0].x-26,this.editArr[0].y-26,52,52),this.editArr=[]}},startDraw:function(t){var e=document.getElementById("myCanvas"),i=e.getContext("2d"),a=new Image;a.src="https://img2.baidu.com/it/u=622902245,3661794572&fm=26&fmt=auto",a.crossOrigin="Anonymous",a.onload=function(){var e=i.createPattern(a,"no-repeat");i.fillStyle=e,i.fillRect(t.x-25,t.y-25,50,50),i.drawImage(a,t.x-25,t.y-25,50,50)}},editDraw:function(t){var e=document.getElementById("myCanvas"),i=e.getContext("2d"),a=new Image;a.src="https://img0.baidu.com/it/u=3785896266,2118421191&fm=26&fmt=auto",a.crossOrigin="Anonymous",a.onload=function(){var e=i.createPattern(a,"no-repeat");i.fillStyle=e,i.fillRect(t.x-25,t.y-25,50,50),i.drawImage(a,t.x-25,t.y-25,50,50)}},clearForm:function(){this.equipPointForm={device_id:"",device_name:"",device_type:"",coordinateX:"",coordinateY:"",img:""},this.loading=!1,this.imageUrl=""},getDeviceList:function(){var t=this;this.request(o["a"].getDeviceList,{},"post").then((function(e){t.deviceList=e.list}))},savePoint:function(){var t=this;if(this.pointArr.length>0){var e={coordinate:[this.pointArr[0].x,this.pointArr[0].y]};this.request(o["a"].addCoordinate,e,"post").then((function(e){t.getVillageAreaPic(),t.$message.success("添加成功！"),t.canDraw=!1,t.pointArr=[]}))}else this.$message.warning("请先选择点位!")},delPoint:function(){if(this.choosePointStatus)this.$message.warning("请先取消选点！");else{var t=this;t.$confirm({title:"提示",content:"确定要删除此设备点吗？",onOk:function(){var e={coordinate:t.delPointarr};t.request(o["a"].delCoordinate,e,"post").then((function(e){t.getVillageAreaPic();var i=document.getElementById("myCanvas").getContext("2d");i.clearRect(t.delPointarr[0]-26,t.delPointarr[1]-26,52,52),t.canDraw=!1,t.canEdit=!1,t.showEditbtn=!1,t.device_id=null,t.delPointarr=[],t.$message.success("删除成功！")}))},onCancel:function(){}})}},drawPoint:function(){this.canDraw||(this.canDraw=!0)},editPoint:function(){this.canDraw||(this.canDraw=!0,this.canEdit=!0)},editThis:function(){var t=this;if(this.device_id){var e={device_id:this.device_id,coordinate:[this.editArr[0].x,this.editArr[0].y]};this.request(o["a"].editCoordinate,e,"post").then((function(e){t.cancelEdit(),t.$message.success("编辑成功！"),t.canDraw=!1,t.editArr=[]}))}else this.$message.warning("当前选中点未绑定设备！")},resetCanvas:function(){if(0!=this.pointArr.length){var t=document.getElementById("myCanvas").getContext("2d");t.clearRect(this.pointArr[0].x-26,this.pointArr[0].y-26,52,52),this.pointArr=[]}},delCur:function(){this.canDraw=!1,this.canEdit=!1,this.resetCanvas()},showModal:function(){this.visible=!0},handleOk:function(t){this.equipPointForm.device_id?(this.visible=!1,console.log("submit!",this.equipPointForm),this.bindDevice()):this.$message.warning("请先选择一个设备!")},bindDevice:function(){var t=this;this.request(o["a"].addDeviceCoordinate,this.equipPointForm,"post").then((function(e){t.clearForm(),t.$message.success("绑定成功!")}))},handleCancel:function(t){this.clearForm(),this.visible=!1},selectChange:function(t){var e=this;this.deviceList.map((function(i){i.device_id==t&&(e.equipPointForm.device_name=i.device_name,e.equipPointForm.device_type=i.device_type)}))},handleChange:function(t){var e=this;if("uploading"!==t.file.status)return"error"===t.file.status?(this.$message.error("上传失败!"),void(this.loading=!1)):void("done"===t.file.status&&s(t.file.originFileObj,(function(t){e.imageUrl=t,e.equipPointForm.img=t,e.loading=!1})));this.loading=!0},beforeUpload:function(t){var e="image/jpeg"===t.type||"image/png"===t.type;e||this.$message.error("You can only upload JPG file!");var i=t.size/1024/1024<2;return i||this.$message.error("Image must smaller than 2MB!"),e&&i}}},c=r,l=(i("d22a"),i("2877")),d=Object(l["a"])(c,a,n,!1,null,"2d616c2a",null);e["default"]=d.exports},d22a:function(t,e,i){"use strict";i("1972")}}]);