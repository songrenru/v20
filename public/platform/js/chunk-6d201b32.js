(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d201b32"],{"4a3fa":function(t,e,s){"use strict";s("d90c")},d90c:function(t,e,s){},f521:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mt-10 mb-20 mh-full"},[s("a-form-model",t._b({ref:"form",attrs:{model:t.formData,rules:t.rules}},"a-form-model",{labelCol:{span:4},wrapperCol:{span:10}},!1),[s("a-card",{attrs:{title:"基本信息",bordered:!1}},[s("a-form-model-item",{attrs:{label:"活动名称",prop:"name"}},[s("a-input",{attrs:{placeholder:"请输入活动名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),s("a-form-model-item",{attrs:{label:"活动时间"}},[s("a-form-model-item",{ref:"startTime",style:{display:"inline-block"},attrs:{prop:"start_time",autoLink:!1}},[s("a-date-picker",{attrs:{disabled:2==t.formData.status||1==t.formData.status,"show-time":"",format:"YYYY-MM-DD","disabled-date":t.disabledStartDate,placeholder:"请选择活动开始时间",getCalendarContainer:function(t){return t.parentNode}},on:{change:t.onDateStartChange},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}})],1),s("span",{style:{display:"inline-block",width:"24px",textAlign:"center"}},[t._v(" - ")]),s("a-form-model-item",{ref:"endTime",style:{display:"inline-block"},attrs:{prop:"end_time",autoLink:!1}},[s("a-date-picker",{attrs:{disabled:2==t.formData.status,"show-time":"",format:"YYYY-MM-DD","disabled-date":t.disabledEndDate,placeholder:"请选择活动结束时间",getCalendarContainer:function(t){return t.parentNode}},on:{change:t.onDateEndChange},model:{value:t.end_time,callback:function(e){t.end_time=e},expression:"end_time"}})],1)],1)],1),s("a-card",{staticStyle:{"margin-top":"10px"},attrs:{title:"优惠信息",bordered:!1}},[s("a-form-model-item",{attrs:{label:"活动类型",prop:"full_type"}},[s("a-radio-group",{on:{change:t.fullTypeChange},model:{value:t.formData.full_type,callback:function(e){t.$set(t.formData,"full_type",e)},expression:"formData.full_type"}},[s("a-radio",{attrs:{value:1}},[t._v(" 满N元 ")]),s("a-radio",{attrs:{value:2}},[t._v(" 满N件 ")])],1)],1),s("a-form-model-item",{attrs:{label:"活动商品",prop:"act_type"}},[s("a-radio-group",{model:{value:t.formData.act_type,callback:function(e){t.$set(t.formData,"act_type",e)},expression:"formData.act_type"}},[s("a-radio",{attrs:{value:1}},[t._v(" 全店商品参与 ")]),s("a-radio",{attrs:{value:0}},[t._v(" 部分商品参与 ")])],1)],1),0==t.formData.act_type?s("a-form-model-item",{attrs:{"wrapper-col":{span:18,offset:4}}},[s("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.addProduct()}}},[t._v(" 添加商品 ")]),t.selectGoods.length?s("a-button",{staticClass:"ml-20",attrs:{type:"danger"},on:{click:function(e){return t.removeGoods()}}},[t._v(" 删除 "+t._s(t.selectGoods.length)+" 项 ")]):t._e(),s("a-table",{directives:[{name:"show",rawName:"v-show",value:t.goodsList.length,expression:"goodsList.length"}],staticClass:"mt-20",attrs:{"row-selection":{selectedRowKeys:t.selectGoods,onChange:t.goodsSelectChange},columns:t.columns,"data-source":t.goodsList,pagination:t.pagination,rowKey:"goods_id"},scopedSlots:t._u([{key:"name",fn:function(e,a){return s("span",{},[s("div",{staticClass:"product-info"},[a.image_url?s("div",[s("img",{attrs:{src:a.image_url}})]):t._e(),s("div",[t._v(t._s(e))])])])}},{key:"price",fn:function(e,a){return s("span",{staticClass:"cr-red"},["sku"==a.goods_type.toLowerCase()?s("span",[t._v(" ￥"+t._s(a.min_price)+" ~ ￥"+t._s(a.max_price)+" ")]):t._e(),"spu"==a.goods_type.toLowerCase()?s("span",[t._v(" ￥"+t._s(a.price)+" ")]):t._e()])}},{key:"action",fn:function(e){return s("span",{},[s("a",{staticClass:"ml-10 inline-block",on:{click:function(s){return t.removeGoods(e)}}},[t._v("删除")])])}}],null,!1,2368486072)})],1):t._e(),t._l(t.formData.gift_detail,(function(e,a){return s("div",{key:e.key},[s("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"优惠条件","wrapper-col":{span:18},prop:"gift_detail."+a+".level_money"}},[s("div",[s("span",{staticClass:"mr-10"},[t._v("满")]),s("a-input-number",{attrs:{min:0},model:{value:e.level_money,callback:function(s){t.$set(e,"level_money",s)},expression:"gift_item.level_money"}}),s("span",{staticClass:"ml-10"},[t._v(t._s(1==t.formData.full_type?"元":"件"))]),s("a-button",{directives:[{name:"show",rawName:"v-show",value:0==a,expression:"gift_index == 0"}],attrs:{type:"link"},on:{click:function(e){return t.addGiftDetail()}}},[t._v("添加一级")]),s("a-button",{directives:[{name:"show",rawName:"v-show",value:0!=a,expression:"gift_index != 0"}],attrs:{type:"link"},on:{click:function(e){return t.delGiftDetail(a)}}},[t._v("删除")])],1)]),s("a-form-model-item",{attrs:{label:"","wrapper-col":{span:18,offset:4}}},[s("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.addGiveProduct(a)}}},[t._v(" 添加赠品 ")]),s("a-table",{directives:[{name:"show",rawName:"v-show",value:e.goods&&e.goods.length,expression:"gift_item.goods && gift_item.goods.length"}],staticClass:"mt-20",attrs:{columns:t.giftGoodsColumns,"data-source":e.goods,pagination:!1,rowKey:"sku_id"},scopedSlots:t._u([{key:"name",fn:function(e,a){return s("span",{},[s("div",{staticClass:"product-info"},[a.image_url?s("div",[s("img",{attrs:{src:a.image_url}})]):t._e(),s("div",[t._v(t._s(e))])])])}},{key:"price",fn:function(e,a){return s("span",{staticClass:"cr-red"},[s("span",[t._v("￥"+t._s(a.price))])])}},{key:"actStockNum",fn:function(e,a){return s("a-form-item",{staticStyle:{margin:"-5px 0"},attrs:{"validate-status":0==a.act_stock_num&&2!=t.formData.status?"error":"",help:0==a.act_stock_num&&2!=t.formData.status?"活动库存不能为0":""}},[t.id?s("div",[s("a-input-number",{attrs:{min:-1==a.stock_num?-1:0,max:-1==a.stock_num?1/0:a.stock_num},on:{change:function(e){return t.giftHandleChange(a.act_stock_num,a,"stock_num")}},model:{value:a.act_stock_num,callback:function(e){t.$set(a,"act_stock_num",e)},expression:"record.act_stock_num"}})],1):s("div",[s("a-input-number",{attrs:{min:-1==a.stock_num?-1:0,max:-1==a.stock_num?1/0:a.stock_num},on:{change:function(e){return t.giftHandleChange(a.stock_num1,a,"act_stock_num")}},model:{value:a.stock_num1,callback:function(e){t.$set(a,"stock_num1",e)},expression:"record.stock_num1"}})],1)])}},{key:"giftNum",fn:function(e,a){return s("a-form-item",{staticStyle:{margin:"-5px 0"}},[s("a-input-number",{attrs:{min:1,max:-1==a.stock_num?1/0:a.act_stock_num},on:{change:function(e){return t.giftHandleChange(a.act_stock_num,a,"gift_num")}},model:{value:a.gift_num,callback:function(e){t.$set(a,"gift_num",e)},expression:"record.gift_num"}})],1)}},{key:"action",fn:function(e,o){return s("span",{},[s("a",{staticClass:"ml-10 inline-block",on:{click:function(e){return t.removeGiftGoods(a,o)}}},[t._v("删除")])])}}],null,!0)},[s("span",{attrs:{slot:"stockNumTitle"},slot:"stockNumTitle"},[t._v(" 当前库存 "),s("a-tooltip",{attrs:{trigger:"hover"}},[s("template",{slot:"title"},[t._v("该商品当前实际剩余库存")]),s("a-icon",{staticClass:"ml-10",attrs:{type:"question-circle"}})],2)],1),t.id?s("div",{scopedSlots:t._u([{key:"stockNum",fn:function(e,a){return s("span",{},[s("span",[t._v(t._s(a.stock_num))])])}}],null,!0)}):s("div",{scopedSlots:t._u([{key:"stockNum",fn:function(e,a){return s("span",{},[s("span",[t._v(t._s(0==a.act_stock_num?a.stock_num+a.act_stock_num:a.stock_num))])])}}],null,!0)}),s("span",{attrs:{slot:"actStockNumTitle"},slot:"actStockNumTitle"},[t._v(" 活动库存 "),s("a-tooltip",{attrs:{trigger:"hover"}},[s("template",{slot:"title"},[t._v("该赠品在活动期间内最多可赠送的库存")]),s("a-icon",{staticClass:"ml-10",attrs:{type:"question-circle"}})],2)],1),s("span",{attrs:{slot:"giftNumTitle"},slot:"giftNumTitle"},[t._v(" 赠送数量 "),s("a-tooltip",{attrs:{trigger:"hover"}},[s("template",{slot:"title"},[t._v("每次满足优惠条件赠送该商品数量")]),s("a-icon",{staticClass:"ml-10",attrs:{type:"question-circle"}})],2)],1)])],1)],1)})),s("a-form-model-item",{attrs:{label:"限购",prop:"join_max_num",help:"0代表不限购，请输入0~999正整数"}},[s("span",{staticClass:"mr-10"},[t._v("每人最多可参与")]),s("a-input-number",{attrs:{min:0,max:999},model:{value:t.formData.join_max_num,callback:function(e){t.$set(t.formData,"join_max_num",e)},expression:"formData.join_max_num"}}),s("span",{staticClass:"ml-10"},[t._v("次")])],1),s("a-form-model-item",{attrs:{label:"优惠是否同享",prop:"is_discount_share"}},[s("a-radio-group",{model:{value:t.formData.is_discount_share,callback:function(e){t.$set(t.formData,"is_discount_share",e)},expression:"formData.is_discount_share"}},[s("a-radio",{attrs:{value:1}},[t._v(" 是 ")]),s("a-radio",{attrs:{value:2}},[t._v(" 否 ")])],1),1==t.formData.is_discount_share?s("div",[s("a-checkbox-group",{model:{value:t.formData.share_discount,callback:function(e){t.$set(t.formData,"share_discount",e)},expression:"formData.share_discount"}},[s("a-checkbox",{attrs:{value:"1"}},[t._v(" 商家会员卡 ")]),s("a-checkbox",{attrs:{value:"2"}},[t._v(" 商家优惠券 ")])],1)],1):t._e()],1)],2),2!=t.formData.status?s("a-form-model-item",{attrs:{"wrapper-col":{span:16,offset:2}}},[s("div",{staticClass:"mt-20 mb-20"},[s("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.saveData()}}},[t._v(" 保存 ")])],1)]):t._e()],1),s("select-goods",{ref:"selectGoods",attrs:{storeId:t.store_id,source:t.source,startTime:t.formData.start_time,endTime:t.formData.end_time,selectedList:t.goodsList},on:{submit:t.selecrGoodsSubmit}})],1)},o=[],i=(s("d3b7"),s("d81d"),s("159b"),s("b0c0"),s("99af"),s("4de4"),s("a434"),s("a9e3"),s("4031")),n=s("c1df"),r=s.n(n),c=s("37fd"),l=s("ac0d"),d={name:"GiveEdit",mixins:[l["d"]],components:{SelectGoods:c["default"]},data:function(){return{store_id:"",id:"",addGoodsModalVisible:!1,pagination:{total:0,pageSize:10,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:function(t){return"共 ".concat(t," 条记录")}},source:"give",formData:{name:"",start_time:"",end_time:"",full_type:1,nums:0,join_max_num:0,is_discount_share:1,share_discount:[],act_type:1,gift_detail:[{level_sort:1,level_money:0,goods:[]}]},rules:{name:[{required:!0,message:"请输入活动名称",trigger:["blur","change"]}],start_time:[{required:!0,message:"请选择活动开始时间",trigger:["blur","change"]}],end_time:[{required:!0,message:"请选择活动结束时间",trigger:["blur","change"]}],full_type:[{required:!0,message:"请选择活动类型",trigger:["blur","change"]}],nums:[{required:!0,message:"请选择满包邮条件",trigger:["blur","change"]}],join_max_num:[{required:!0,message:"请选择限购数量",trigger:["blur","change"]}],is_discount_share:[{required:!0,message:"请选择优惠是否同享",trigger:["blur","change"]}],act_type:[{required:!0,message:"请选择活动商品",trigger:["blur","change"]}]},columns:[{title:"商品信息",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"价格",dataIndex:"price",scopedSlots:{customRender:"price"}},{title:"当前库存",dataIndex:"stock_num"},{title:"操作",dataIndex:"goods_id",width:"100px",scopedSlots:{customRender:"action"}}],goodsList:[],selectGoods:[],giftGoodsColumns:[{title:"商品信息",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"规格",dataIndex:"sku_str",scopedSlots:{customRender:"sku_str"}},{title:"价格",dataIndex:"price",scopedSlots:{customRender:"price"}},{dataIndex:"stock_num",slots:{title:"stockNumTitle"},scopedSlots:{customRender:"stockNum"}},{dataIndex:"act_stock_num",key:"act_stock_num",slots:{title:"actStockNumTitle"},scopedSlots:{customRender:"actStockNum"}},{dataIndex:"gift_num",key:"gift_num",slots:{title:"giftNumTitle"},scopedSlots:{customRender:"giftNum"}},{title:"操作",dataIndex:"goods_id",width:"100px",scopedSlots:{customRender:"action"}}],currentLevel:0,start_time:null,end_time:null}},watch:{"$route.path":function(t){"/merchant/merchant.mall/EditGive"==t&&(this.id="",this.resetForm())},"$route.query.store_id":function(t){t&&(this.store_id=t,this.resetForm())},"$route.query.id":function(t){var e=this;this.$nextTick((function(){e.activatedFlag&&t?(e.id=t,e.resetForm(),e.getFormData()):(e.id="",e.resetForm())}))}},created:function(){this.store_id=this.$route.query.store_id,this.resetForm(),this.$route.query.id&&(this.id=this.$route.query.id,this.getFormData())},methods:{moment:r.a,disabledStartDate:function(t){return!this.$route.query.id&&(t&&t<r()().subtract(1,"days"))},disabledEndDate:function(t){var e=this.start_time;return e?e.valueOf()>=t.valueOf():t&&t<r()().subtract(1,"days")},onDateStartChange:function(t,e){this.$set(this.formData,"start_time",e),this.$refs.startTime.onFieldChange()},onDateEndChange:function(t,e){var s=r()(this.formData.start_time).valueOf(),a=r()(e).valueOf();a<s?this.$message.error("活动结束时间必须大于活动开始时间！"):(this.$set(this.formData,"end_time",e),this.$refs.endTime.onFieldChange())},getFormData:function(){var t=this;this.request(i["a"].getGiveInfo,{id:this.id}).then((function(e){console.log(e),t.start_time=r()(e.start_time),t.end_time=r()(e.end_time),1==e.is_discount_share&&(e.share_discount=[],1==e.discount_card&&e.share_discount.push("1"),1==e.discount_coupon&&e.share_discount.push("2")),t.goodsList=e.goods_sku||[],t.$set(t,"formData",e)}))},addProduct:function(){var t=this,e=this.activeTimeCheck(),s=e.activeTime,a=e.message;s||!a?(this.source="give",this.$nextTick((function(){t.$forceUpdate(),t.$refs.selectGoods.openDialog()}))):this.$message.error(a)},activeTimeCheck:function(){var t=!0,e="";return this.start_time||this.end_time?this.start_time?this.end_time||(e="请先选择活动的结束时间！",t=!1):(e="请先选择活动的开始时间！",t=!1):(e="请先选择活动的开始时间和结束时间！",t=!1),{activeTime:t,message:e}},selecrGoodsSubmit:function(t){if(console.log("e",t),"give"==this.source)this.goodsList=t.goods||[],this.$set(this.pagination,"total",this.goodsList.length);else{t.goods&&t.goods.length&&(t.goods=t.goods.map((function(t){return t&&t.sku_info&&t.sku_info.length&&t.sku_info.forEach((function(e){e.name=t.name,e.goods_id=t.goods_id,e.image=t.image,e.act_stock_num||(e.act_stock_num=t.stock_num),e.gift_num||(e.gift_num=1)})),t.sku_info})).reduce((function(t,e){return t.concat(e)}),[])),console.log(t.goods,"e.goods");var e=this.formData.gift_detail[this.currentLevel]["goods"],s=[];e.map((function(t){s.push(t.sku_id)})),t.goods.map((function(t){if(-1==s.indexOf(t.sku_id)){var a={goods_id:t.goods_id,sku_id:t.sku_id,act_stock_num:t.act_stock_num,gift_num:1,sale_num:t.sale_num,name:t.name,sku_str:t.sku_str,price:t.price,stock_num:t.stock_num};e.push(a)}})),this.formData.gift_detail[this.currentLevel]["goods"]=e,this.$set(this.formData,"gift_detail",this.formData.gift_detail)}},goodsSelectChange:function(t){this.selectGoods=t},fullTypeChange:function(){if(2==this.formData.full_type){var t={required:!0,pattern:/^[+]{0,1}(\d+)$/,message:"请输入正确的优惠条件",trigger:"blur"};this.gift_detail_rules.push(t)}else this.gift_detail_rules=this.gift_detail_rules.filter((function(t){return!t.pattern}));this.$set(this.formData,"act_type",this.$options.data().formData["act_type"]),this.goodsList=[],this.selectGoods=[],this.$set(this.formData,"gift_detail",this.$options.data().formData["gift_detail"]),console.log(this.gift_detail_rules,"this.gift_detail_rules")},removeGoods:function(t){var e=this;if(t){for(var s=0;s<this.goodsList.length;s++)this.goodsList[s].goods_id===t&&this.goodsList.splice(s,1);if(this.selectGoods.length)for(s=0;s<this.selectGoods.length;s++)t===this.selectGoods[s]&&this.selectGoods.splice(s,1)}else this.selectGoods.forEach((function(t,s){e.goodsList.forEach((function(s,a){s.goods_id==t&&e.goodsList.splice(a,1)}))})),this.selectGoods=[]},resetForm:function(){this.formData=this.$options.data().formData,this.start_time=this.$options.data().start_time,this.end_time=this.$options.data().end_time,this.goodsList=[],this.$forceUpdate()},addGiveProduct:function(t){var e=this,s=this.activeTimeCheck(),a=s.activeTime,o=s.message;a||!o?this.goodsList.length||0!=this.formData.act_type?(this.currentLevel=t,this.source="give_gift",this.$nextTick((function(){e.$forceUpdate(),e.$refs.selectGoods.openDialog()}))):this.$message.error("请选择参与活动的商品"):this.$message.error(o)},addGiftDetail:function(){if(5!=this.formData.gift_detail.length)if(this.formData.gift_detail[this.currentLevel]["goods"].length){var t=this.formData.gift_detail[this.formData.gift_detail.length-1]&&this.formData.gift_detail[this.formData.gift_detail.length-1].level_sort?this.formData.gift_detail[this.formData.gift_detail.length-1].level_sort+1:1,e={level_sort:t,level_money:0,goods:[]};this.formData.gift_detail.push(e)}else this.$message.error("请选择参与活动的赠品");else this.$message.error("最多可添加5级")},delGiftDetail:function(t){this.currentLevel=t-1?t-1:0,this.formData.gift_detail.splice(t,1)},giftHandleChange:function(t,e,s){console.log("record",e);var a=e.sku_id,o=this.formData.gift_detail,i="";o.forEach((function(t){t.goods&&t.goods.length&&t.goods.forEach((function(e){e.sku_id==a&&(i=t)}))})),console.log("newData",i),i&&("act_stock_num"==s&&e[s]>e["act_stock_num"]&&-1!=e["stock_num"]&&(t=e["stock_num"],console.log(t,"chaochu")),"stock_num"==s&&e[s]<e["act_stock_num"]&&-1!=e["stock_num"]&&(t=e["stock_num"],console.log(t,"chaochu"))),this.formData.gift_detail=this.formData.gift_detail.filter((function(t){return t.goods_id==e.goods_id&&(t.goods=t.goods.filter((function(t){return t.sku_id==a&&(t=i),t}))),t}))},removeGiftGoods:function(t,e){var s=this,a=this.formData.gift_detail[t]["goods"]||[];a.length&&a.forEach((function(t,s){t.sku_id==e.sku_id&&a.splice(s,1)})),this.formData.gift_detail[t]["goods"]=a,this.$nextTick((function(){s.$set(s.formData,"gift_detail",s.formData.gift_detail)}))},saveData:function(){var t=this,e=this.activeTimeCheck(),s=e.activeTime,a=e.message;s||!a?this.$refs.form.validate((function(e){if(!e)return console.log("error submit!!",t.formData),!1;var s=t.formData;if(s.gift_detail&&s.gift_detail.length){var a=!1,o=!1,n=!1;if(s.gift_detail.forEach((function(t){t.goods.length||(a=!0),t.goods&&t.goods.length&&t.goods.forEach((function(t){t.act_stock_num&&0!=t.act_stock_num||(o=!0),t.gift_num||(n=!0)}))})),a)return void t.$message.error("请选择赠送商品");if(o)return void t.$message.error("赠品活动库存不能为空或0");if(n)return void t.$message.error("赠品数量不能为空");if(1==s.is_discount_share&&0==s.share_discount.length)return void t.$message.error("请选择优惠同享类型");for(var r=!1,c=0;c<s.gift_detail.length;c++)if(s.gift_detail[c+1]&&Number(s.gift_detail[c+1].level_money)<=Number(s.gift_detail[c].level_money)||s.gift_detail[c].level_money<=0){r=!0;break}if(r)return void t.$message.error("优惠条件不符合，请重新输入")}if(1==s.is_discount_share&&(s.discount_card=0,s.discount_coupon=0,s.share_discount.forEach((function(t){1==t?s.discount_card=1:2==t&&(s.discount_coupon=1)}))),s.store_id=t.store_id,t.id&&(s.id=t.id),t.goodsList.length||0!==s.act_type){t.goodsList.length?s.goods_sku=JSON.stringify(t.goodsList):s.goods_sku="",console.log("formData",s);var l={};for(var d in s)"share_discount"!=d&&"time"!=d&&(l[d]=s[d]),s.gift_detail.length&&"gift_detail"==d&&(l[d]=JSON.stringify(s.gift_detail));1==s.act_type&&(l.goods_sku=""),t.request(i["a"].giveAdd,l).then((function(e){t.id||t.resetForm(),t.$router.push({path:"/merchant/merchant.mall/giveList",query:{store_id:t.store_id}}),t.$message.success("提交成功！"),sessionStorage.setItem("giveEdit",1)}))}else t.$message.error("请选择满赠活动商品")})):this.$message.error(a)}}},u=d,m=(s("4a3fa"),s("0c7c")),_=Object(m["a"])(u,a,o,!1,null,"7f344a46",null);e["default"]=_.exports}}]);