(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f189d49a","chunk-2d0b6a79","chunk-2d0b6a79","chunk-2d0b3786"],{"1da1":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("d3b7");function i(e,t,a,i,r,n,s){try{var o=e[n](s),l=o.value}catch(d){return void a(d)}o.done?t(l):Promise.resolve(l).then(i,r)}function r(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var s=e.apply(t,a);function o(e){i(s,r,n,o,l,"next",e)}function l(e){i(s,r,n,o,l,"throw",e)}o(void 0)}))}}},2909:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var i=a("6b75");function r(e){if(Array.isArray(e))return Object(i["a"])(e)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function n(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var s=a("06c5");function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e){return r(e)||n(e)||Object(s["a"])(e)||o()}},b794:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{width:1e3,title:e.xtitle,destroyOnClose:!0,visible:e.visible_meter,maskClosable:!1,"confirm-loading":e.confirmLoading,footer:null},on:{cancel:e.handleCancel}},[a("a-spin",{attrs:{spinning:e.confirmLoading,height:800}},["revise_data"==e.xtype?a("div",{staticStyle:{"margin-left":"25%",color:"red","margin-bottom":"20px"}},[e._v("手工矫正抄表数据，只是生成抄表记录并不生成账单")]):e._e(),e.edit_disabled?a("div",{staticStyle:{margin:"0px 0px 20px 20px"}},[0==e.currentIndex?a("div",[a("a-button",{staticStyle:{"margin-right":"30px"},attrs:{type:"primary"},on:{click:function(t){return e.changeXTab(0)}}},[e._v("修改详情")]),e.show_mdylog?a("a-button",{staticStyle:{"margin-right":"30px"},attrs:{type:"default"},on:{click:function(t){return e.changeXTab(1)}}},[e._v("修改记录")]):e._e()],1):a("div",[a("a-button",{staticStyle:{"margin-right":"30px"},attrs:{type:"default"},on:{click:function(t){return e.changeXTab(0)}}},[e._v("修改详情")]),e.show_mdylog?a("a-button",{staticStyle:{"margin-right":"30px"},attrs:{type:"primary"},on:{click:function(t){return e.changeXTab(1)}}},[e._v("修改记录")]):e._e()],1)]):e._e(),0==e.currentIndex||0==e.edit_id?a("div",{staticClass:"order_list_box"},[a("a-form",{attrs:{form:e.form}},[e.edit_id<1?a("a-form-item",{attrs:{label:"选择",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-cascader",{staticClass:"cascader_style margin_left_10",attrs:{options:e.options,"load-data":e.loadDataFunc,placeholder:"请选择房间","change-on-select":""},on:{change:e.setVisionsFunc}})],1):a("a-form-item",{attrs:{label:"房间",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[a("a-input",{staticStyle:{width:"300px"},attrs:{disabled:"disabled"},model:{value:e.irecord.address,callback:function(t){e.$set(e.irecord,"address",t)},expression:"irecord.address"}})],1),a("a-col",{attrs:{span:6}})],1),a("a-form-item",{attrs:{label:"收费项目",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[a("a-input",{staticStyle:{width:"300px"},attrs:{maxLength:10,disabled:"disabled"},model:{value:e.project_name,callback:function(t){e.project_name=t},expression:"project_name"}})],1),a("a-col",{attrs:{span:6}})],1),a("a-form-item",{attrs:{label:"收费标准名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[a("a-input",{staticStyle:{width:"300px"},attrs:{maxLength:10,disabled:"disabled"},model:{value:e.charge_name,callback:function(t){e.charge_name=t},expression:"charge_name"}})],1),a("a-col",{attrs:{span:6}})],1),a("a-form-item",{attrs:{label:"单价",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[a("a-input",{staticStyle:{width:"300px"},attrs:{maxLength:10,disabled:"disabled"},model:{value:e.unit_price,callback:function(t){e.unit_price=t},expression:"unit_price"}})],1),a("a-col",{attrs:{span:6}})],1),a("a-form-item",{attrs:{label:"倍率",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[a("a-input",{staticStyle:{width:"300px"},attrs:{maxLength:10,disabled:"disabled"},model:{value:e.rate,callback:function(t){e.rate=t},expression:"rate"}})],1),a("a-col",{attrs:{span:6}})],1),a("a-form-item",{attrs:{label:e.timedesc,labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[e.opt_meter_time?a("a-date-picker",{attrs:{"show-time":{format:"HH:mm"},placeholder:e.placeholderStr,value:e.moment(e.opt_meter_time,e.dateFormat),format:e.dateFormat,"disabled-date":e.disabledDate,"disabled-time":e.disabledDateTime,disabled:e.edit_disabled_time},on:{change:e.onMeterChange}}):a("a-date-picker",{attrs:{"show-time":{format:"HH:mm"},placeholder:e.placeholderStr,"disabled-date":e.disabledDate,"disabled-time":e.disabledDateTime,format:e.dateFormat,disabled:e.edit_disabled_time},on:{change:e.onMeterChange}})],1),a("a-col",{attrs:{span:6}})],1),a("a-form-item",{attrs:{label:"起度",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[a("a-input-number",{staticStyle:{width:"300px"},attrs:{maxLength:10,min:0,precision:2,step:.01,disabled:e.edit_disabled},model:{value:e.start_ammeter,callback:function(t){e.start_ammeter=t},expression:"start_ammeter"}})],1),a("a-col",{attrs:{span:6}})],1),a("a-form-item",{attrs:{label:"止度",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[a("a-input-number",{staticStyle:{width:"300px"},attrs:{maxLength:10,min:0,precision:2,step:.01},model:{value:e.last_ammeter,callback:function(t){e.last_ammeter=t},expression:"last_ammeter"}})],1),a("a-col",{attrs:{span:6}})],1),a("a-form-item",{attrs:{label:"备注",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-col",{attrs:{span:18}},[a("a-input",{staticStyle:{width:"300px"},attrs:{maxLength:80},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}})],1),a("a-col",{attrs:{span:6}})],1)],1)],1):e._e(),1==e.currentIndex?a("div",{staticClass:"meter_reading_mdylog",staticStyle:{margin:"30px 0px 20px 35px"}},[a("a-timeline",e._l(e.meterReadingMdylog,(function(t,i){return a("a-timeline-item",{attrs:{color:t.color_v}},[a("p",[a("strong",[e._v("修改人：")]),e._v(" "+e._s(t.role_name))]),a("p",[a("strong",[e._v("修改时间：")]),e._v(" "+e._s(t.add_time_str))]),a("p",[a("strong",[e._v("修改前起始度：")]),e._v(" "+e._s(t.old_ammeter_str))]),a("p",[a("strong",[e._v("修改后起始度：")]),e._v(" "+e._s(t.now_ammeter_str))]),a("p",[a("strong",[e._v("备注：")]),e._v(" "+e._s(t.note))])])})),1)],1):e._e()]),e.is_footer?a("div",{staticStyle:{"text-align":"center"}},[a("a-button",{key:"back",staticStyle:{"margin-right":"50px"},on:{click:e.handleCancel}},[e._v(" 取消 ")]),a("a-button",{key:"submit",attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.handleOk}},[e._v(" 确认 ")])],1):e._e()],1)},r=[],n=a("2909"),s=a("1da1"),o=(a("96cf"),a("d81d"),a("b0c0"),a("d3b7"),a("7db0"),a("a0e0")),l=a("ca00"),d=a("c1df"),c=a.n(d),m={name:"addMeter",data:function(){return{visible_meter:!1,confirmLoading:!1,form:this.$form.createForm(this),labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:13}},options:[],project_name:"",charge_name:"",rate:1,unit_price:0,start_ammeter:"",last_ammeter:"",note:"",single_id:0,floor_id:0,layer_id:0,room_id:0,rule_id:0,project_id:0,charge_type:"",tokenName:"",sysName:"",opt_meter_time:"",dateFormat:"YYYY-MM-DD HH:mm",irecord:{},edit_id:0,xtitle:"用量录入",edit_disabled:!1,edit_disabled_time:!1,show_mdylog:!1,currentIndex:0,meterReadingMdylog:[],is_footer:!0,xtype:"",timedesc:"抄表时间",placeholderStr:"选择抄表时间"}},methods:{moment:c.a,add:function(e,t,a,i,r,n,s,o){var d=Object(l["j"])(location.hash);d?(this.tokenName=d+"_access_token",this.sysName=d):this.sysName="village",this.xtitle="用量录入",this.timedesc="抄表时间",this.placeholderStr="选择抄表时间",this.xtype="",this.opt_meter_time=this.get_data_time(),this.project_name=e,this.charge_name=t,this.unit_price=a,this.rate=i,this.charge_type=r,this.rule_id=n,this.project_id=s,this.getSingleListByVillage(),this.irecord={},this.edit_disabled_time=!1,void 0!=o&&o&&(this.xtype=o),"revise_data"==this.xtype&&(this.xtitle="手工矫正",this.timedesc="矫正时间",this.placeholderStr="选择矫正时间",this.edit_disabled_time=!0),this.edit_id=0,this.edit_disabled=!1,this.show_mdylog=!1,this.currentIndex=0,this.meterReadingMdylog=[],this.is_footer=!0,this.visible_meter=!0},edit:function(e){var t=Object(l["j"])(location.hash);t?(this.tokenName=t+"_access_token",this.sysName=t):this.sysName="village",this.irecord=e,console.log(this.irecord),this.edit_id=e.id,this.edit_disabled=!0,this.edit_disabled_time=!0,this.meterReadingMdylog=[],this.getMeterReading(),this.opt_meter_time=e.opt_meter_time_str,this.unit_price=e.unit_price,this.rate=e.rate,this.project_id=e.project_id,this.start_ammeter=e.start_ammeter,this.last_ammeter=e.last_ammeter,this.note=e.note,this.room_id=e.layer_num,this.xtitle="编辑抄表止度",this.timedesc="抄表时间",this.placeholderStr="选择抄表时间",this.show_mdylog=!1,this.currentIndex=0,this.is_footer=!0,this.visible_meter=!0},changeXTab:function(e){this.currentIndex=e,0==this.currentIndex?this.is_footer=!0:1==this.currentIndex&&(this.is_footer=!1,this.meterReadingMdylogList())},meterReadingMdylogList:function(){var e=this;this.request(o["a"].getMeterReadingMdylog,{meter_reading_id:this.irecord.id,tokenName:this.tokenName}).then((function(t){e.meterReadingMdylog=t.list,e.meterReadingMdylog&&e.meterReadingMdylog.length>0&&(e.show_mdylog=!0)}))},getMeterReading:function(){var e=this;this.request(o["a"].getOneMeterReading,{id:this.irecord.id,tokenName:this.tokenName}).then((function(t){e.irecord=t,e.charge_type=t.charge_type,e.rule_id=t.rule_id,e.project_name=t.project_name,e.charge_name=t.rule_name,e.unit_price=t.unit_price,e.rate=t.rate,e.start_ammeter=t.start_ammeter,e.last_ammeter=t.last_ammeter,e.note=t.note,e.room_id=t.layer_num,e.single_id=t.single_id,e.floor_id=t.floor_id,e.layer_id=t.layer_id,e.meterReadingMdylogList()}))},get_data_time:function(){var e=new Date,t=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes();return console.log(t),t},disabledDate:function(e){return e&&e>c()().endOf("day")},date_range:function(e,t){for(var a=[],i=e;i<=t;i++)a.push(i);return a},disabledDateTime:function(e){console.log("date",e);var t=(new Date).getDate(),a=new Date(e._i).getDate(),i=new Date(e._i).getHours();if(console.log("xday",t,"selectdate",a),a<t)return{disabledHours:function(){return[]},disabledMinutes:function(){return[]}};var r=(new Date).getHours(),n=[],s=r+1;s<23&&(n=this.date_range(s,23));var o=[];if(r==i){var l=(new Date).getMinutes(),d=l+1;d<59&&(o=this.date_range(d,59))}return{disabledHours:function(){return n},disabledMinutes:function(){return o}}},onMeterChange:function(e,t){this.opt_meter_time=t},handleOk:function(){var e=this;if(0==this.room_id)return this.$message.warning("请选择房间"),!1;if("revise_data"!=this.xtype){var t=parseFloat(this.start_ammeter),a=parseFloat(this.last_ammeter);if(t>=a)return this.$message.warning("止度需要大于起度"),!1;if(t<=0&&a<=0)return this.$message.warning("起度/止度不能为空"),!1}this.edit_id>0&&this.edit_disabled?this.request(o["a"].meterReadingEdit,{id:this.edit_id,start_ammeter:this.start_ammeter,last_ammeter:this.last_ammeter,tokenName:this.tokenName,rule_id:this.rule_id,note:this.note}).then((function(t){e.$message.success("操作成功"),e.$emit("okk"),e.start_ammeter="",e.last_ammeter="",e.handleCancel(),e.visible_meter=!1})):this.request(o["a"].meterReadingAdd,{single_id:this.single_id,floor_id:this.floor_id,layer_id:this.layer_id,vacancy_id:this.room_id,start_ammeter:this.start_ammeter,last_ammeter:this.last_ammeter,charge_name:this.project_name,unit_price:this.unit_price,charge_type:this.charge_type,rule_id:this.rule_id,note:this.note,project_id:this.project_id,tokenName:this.tokenName,rate:this.rate,opt_meter_time:this.opt_meter_time,opt_xtype:this.xtype}).then((function(t){var a="录入成功！";"revise_data"==e.xtype&&(a="矫正录入成功！"),e.$message.success(a),e.$emit("getMeterProject"),e.start_ammeter="",e.last_ammeter="",e.handleCancel(),e.visible_meter=!1}))},handleCancel:function(){this.start_ammeter="",this.last_ammeter="",this.visible_meter=!1,this.edit_id=0,this.edit_disabled=!1,this.edit_disabled_time=!1,this.irecord={},this.show_mdylog=!1,this.currentIndex=0,this.is_footer=!0,this.meterReadingMdylog=[]},getLastMeter:function(){var e=this;this.request(o["a"].getIsBind,{project_id:this.project_id,vacancy_id:this.room_id}).then((function(t){t.status?e.request(o["a"].getLastMeter,{project_id:e.project_id,vacancy_id:e.room_id,tokenName:e.tokenName}).then((function(t){e.start_ammeter=t.last_ammeter})):e.$message.warning("当前房间没有绑定该收费项目")}))},getSingleListByVillage:function(){var e=this,t={tokenName:this.tokenName};this.charge_type&&(t["charge_type"]=this.charge_type),this.rule_id&&(t["rule_id"]=this.rule_id),this.project_id&&(t["project_id"]=this.project_id),this.request(o["a"].getSingleListByVillage,t).then((function(t){if(console.log("+++++++Single",t),t){var a=[];t.map((function(e){a.push({label:e.name,value:e.id,isLeaf:!1})})),e.options=a}}))},getFloorList:function(e){var t=this,a={pid:e,tokenName:this.tokenName};return this.charge_type&&(a["charge_type"]=this.charge_type),this.rule_id&&(a["rule_id"]=this.rule_id),this.project_id&&(a["project_id"]=this.project_id),new Promise((function(e){t.request(o["a"].getFloorList,a).then((function(t){console.log("+++++++Single",t),console.log("resolve",e),e(t)}))}))},getLayerList:function(e){var t=this,a={pid:e,tokenName:this.tokenName};return this.charge_type&&(a["charge_type"]=this.charge_type),this.rule_id&&(a["rule_id"]=this.rule_id),this.project_id&&(a["project_id"]=this.project_id),new Promise((function(e){t.request(o["a"].getLayerList,a).then((function(t){console.log("+++++++Single",t),t&&e(t)}))}))},getVacancyList:function(e){var t=this,a={pid:e,tokenName:this.tokenName};return this.charge_type&&(a["charge_type"]=this.charge_type),this.rule_id&&(a["rule_id"]=this.rule_id),this.project_id&&(a["project_id"]=this.project_id),new Promise((function(e){t.request(o["a"].getVacancyList,a).then((function(t){console.log("+++++++Single",t),t&&e(t)}))}))},loadDataFunc:function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e[e.length-1],a.loading=!0,setTimeout((function(){a.loading=!1}),100);case 3:case"end":return t.stop()}}),t)})))()},setVisionsFunc:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r,s,o,l,d,c,m,h,_,u,p;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.room_id=0,1!==e.length){a.next=14;break}return t.single_id=e[0],i=Object(n["a"])(t.options),a.next=6,t.getFloorList(e[0]);case 6:r=a.sent,console.log("res",r),s=[],r.map((function(e){return s.push({label:e.name,value:e.id,isLeaf:!1}),i["children"]=s,!0})),i.find((function(t){return t.value===e[0]}))["children"]=s,t.options=i,a.next=43;break;case 14:if(2!==e.length){a.next=27;break}return t.floor_id=e[1],a.next=18,t.getLayerList(e[1]);case 18:o=a.sent,l=Object(n["a"])(t.options),d=[],o.map((function(e){return d.push({label:e.name,value:e.id,isLeaf:!1}),!0})),c=l.find((function(t){return t.value===e[0]})),c.children.find((function(t){return t.value===e[1]}))["children"]=d,t.options=l,a.next=43;break;case 27:if(3!==e.length){a.next=42;break}return t.layer_id=e[2],a.next=31,t.getVacancyList(e[2]);case 31:m=a.sent,h=Object(n["a"])(t.options),_=[],m.map((function(e){return _.push({label:e.name,value:e.id,isLeaf:!0}),!0})),u=h.find((function(t){return t.value===e[0]})),p=u.children.find((function(t){return t.value===e[1]})),p.children.find((function(t){return t.value===e[2]}))["children"]=_,t.options=h,console.log("_this.options",t.options),a.next=43;break;case 42:4===e.length&&(t.room_id=e[3],t.getLastMeter());case 43:case"end":return a.stop()}}),a)})))()}}},h=m,_=a("2877"),u=Object(_["a"])(h,i,r,!1,null,"e299fae4",null);t["default"]=u.exports}}]);