(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-729d3770"],{"41d2":function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"mt-10 mb-20 pt-20 pl-20 pr-20 pb-20 bg-ff br-10"},[o("a-row",{staticClass:"title",attrs:{type:"flex"}},[o("a-col",[o("span",{staticClass:"mr-20"},[t._v(t._s(t.L("集点返券")))])]),o("a-col",[t._v(t._s(t.L("通过优惠券吸引客户多下单")))])],1),o("a-row",{staticClass:"mb-10",attrs:{type:"flex"}},[o("a-button",{attrs:{type:"primary"},on:{click:t.addPreferential}},[t._v(t._s(t.L("新建优惠")))])],1),t.trip?o("a-row",{staticClass:"mb-10",attrs:{type:"flex"}},[o("div",{staticClass:"card"},[o("p",[t._v(" "+t._s(t.L("1. 活动状态分为进行中、已过期（过了活动时间）、未开始（未到开始时间）、未使用（符合活动时间但是没有设置为使用状态）、已失效（手动设置为失效）。"))+" ")]),o("p",[t._v(t._s(t.L("2. 一个店铺只允许有一个活动进行中")))]),o("div",{staticClass:"end",on:{click:t.closeTrip}},[o("a-icon",{attrs:{type:"close"}})],1)])]):t._e(),o("a-table",{attrs:{columns:t.columns,rowKey:"id","data-source":t.dataList,pagination:t.pagination},scopedSlots:t._u([{key:"status",fn:function(e,s){return o("span",{},[o("span",[t._v(t._s(s.status_txt))])])}},{key:"goods_name",fn:function(e,s){return o("span",{},t._l(s.goods_name.split(","),(function(e,s){return o("a-tag",{key:s,attrs:{color:"blue"}},[t._v(" "+t._s(e)+" ")])})),1)}},{key:"action",fn:function(e,s){return o("span",{},[o("a-popconfirm",{attrs:{title:"确定操作吗?","ok-text":"是","cancel-text":"否"},on:{confirm:function(e){return t.setLose(s)}}},[o("a",{staticClass:"inline-block",staticStyle:{"margin-right":"10px"}},[t._v(t._s(1==s.status?t.L("设为失效"):t.L("设为使用")))])]),o("a",{staticClass:"inline-block",staticStyle:{"margin-right":"10px"},on:{click:function(e){return t.editTicket(s)}}},[t._v(t._s(t.L("编辑")))]),0==s.status?o("a-popconfirm",{attrs:{title:"确定删除吗?","ok-text":"是","cancel-text":"否"},on:{confirm:function(e){return t.deleltTicket(s)}}},[o("a",{staticClass:"inline-block",staticStyle:{color:"red","margin-right":"10px"}},[t._v(t._s(t.L("删除")))])]):t._e()],1)}}])}),o("a-modal",{attrs:{title:t.titles,destroyOnClose:"",width:"50%",centered:!0},on:{ok:t.handleOk},model:{value:t.addVisible,callback:function(e){t.addVisible=e},expression:"addVisible"}},[o("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[o("a-form-model-item",{attrs:{label:"活动名称",prop:"name"}},[o("a-input",{attrs:{placeholder:"请输入活动名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),o("a-form-model-item",{attrs:{label:"活动时间",required:!0,"label-col":t.labelCol,"wrapper-col":{span:15}}},[o("a-date-picker",{attrs:{"disabled-date":t.disabledStartDate,"show-time":"",format:t.dateFormat,placeholder:"开始时间",disabled:"edit"==t.modelType},on:{openChange:t.handleStartOpenChange},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}}),o("a-date-picker",{attrs:{"disabled-date":t.disabledEndDate,"show-time":"",format:t.dateFormat,placeholder:"结束时间",open:t.endOpen,disabled:"edit"==t.modelType},on:{openChange:t.handleEndOpenChange},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}}),o("span",{staticClass:"ml-20 color-1"},[t._v(t._s(t.L("开始时间最早当天")))])],1),o("a-form-model-item",{attrs:{label:"购买后多少天重置集点"}},[o("a-input-number",{attrs:{min:0,disabled:"edit"==t.modelType},model:{value:t.form.reset_day,callback:function(e){t.$set(t.form,"reset_day",e)},expression:"form.reset_day"}}),o("span",{staticClass:"ml-20 color-1"},[t._v(t._s(t.L("输入0不重置")))])],1),o("a-form-model-item",{attrs:{label:"集满多少单获得优惠券"}},[o("a-input-number",{attrs:{min:1,max:10},model:{value:t.form.total_order,callback:function(e){t.$set(t.form,"total_order",e)},expression:"form.total_order"}}),o("span",{staticClass:"ml-20 color-1"},[t._v(t._s(t.L("最多不能超过10单")))])],1),o("a-form-model-item",{attrs:{label:"选择优惠券",prop:"coupon_id"}},[o("a-select",{model:{value:t.form.coupon_id,callback:function(e){t.$set(t.form,"coupon_id",e)},expression:"form.coupon_id"}},t._l(t.couponList,(function(e){return o("a-select-option",{key:e.coupon_id,attrs:{value:e.coupon_id}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),o("a-form-model-item",{attrs:{label:"规则",prop:"note"}},[o("a-textarea",{attrs:{placeholder:"请输入","auto-size":{minRows:3,maxRows:6}},model:{value:t.form.note,callback:function(e){t.$set(t.form,"note",e)},expression:"form.note"}})],1),o("a-form-model-item",{attrs:{label:"活动商品",required:""}},[o("a-button",{attrs:{type:"primary"},on:{click:t.addCommodity}},[t._v(t._s(t.L("添加换购商品")))])],1)],1),o("a-table",{attrs:{columns:t.commodityColumns,rowKey:"goods_id","data-source":t.commodityList},scopedSlots:t._u([{key:"action",fn:function(e,s){return o("span",{},[o("a",{staticClass:"inline-block",staticStyle:{color:"red"},on:{click:function(e){return t.deleltCommodity(s)}}},[t._v(t._s(t.L("删除")))])])}}])})],1),o("a-modal",{attrs:{title:"换购商品",destroyOnClose:"",width:"60%",centered:!0},on:{ok:t.commodityOk},model:{value:t.addCommodityVisible,callback:function(e){t.addCommodityVisible=e},expression:"addCommodityVisible"}},[o("a-row",{attrs:{type:"flex"}},[o("a-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入商品名称"},model:{value:t.goodQueryParams.keywords,callback:function(e){t.$set(t.goodQueryParams,"keywords",e)},expression:"goodQueryParams.keywords"}}),o("a-button",{staticClass:"ml-20",attrs:{type:"primary"},on:{click:function(e){return t.search("shop")}}},[t._v(t._s(t.L("搜索")))])],1),o("a-table",{staticClass:"commodity",attrs:{columns:t.addCommodityColumns,rowKey:"goods_id","data-source":t.addCommodityList,pagination:t.addCommodityPagination,rowSelection:{hideDefaultSelections:!0,selectedRowKeys:t.selectedRowKeys,onChange:t.onAddCommodityChange,onSelect:t.onAddCommoditySelect}},scopedSlots:t._u([{key:"is_sku",fn:function(e,s){return o("span",{},[o("span",[t._v(t._s(0==s.is_sku?t.L("单规格"):t.L("多规格")))])])}}])})],1)],1)},a=[],i=o("5530"),n=(o("d81d"),o("4de4"),o("d3b7"),{getRebateList:"/shop/merchant.Rebate/getList",changeRebateStatus:"/shop/merchant.Rebate/changeStatus",rebateShowDetail:"/shop/merchant.Rebate/showDetail",addRebate:"/shop/merchant.Rebate/add",editRebate:"/shop/merchant.Rebate/edit",getGoodsList:"/shop/merchant.Rebate/getGoodsList",deleteRebate:"/shop/merchant.Rebate/delete",getRebateCouponList:"/shop/merchant.Rebate/getCouponList"}),d=n,r=o("c1df"),l=o.n(r),m={data:function(){return{dateFormat:"YYYY-MM-DD HH:mm:ss",columns:[{title:this.L("编号"),dataIndex:"id"},{title:this.L("活动名称"),dataIndex:"name"},{title:this.L("活动时间"),dataIndex:"activy_time"},{title:this.L("活动商品"),dataIndex:"goods_name",scopedSlots:{customRender:"goods_name"}},{title:this.L("状态"),dataIndex:"status",scopedSlots:{customRender:"status"}},{title:this.L("操作"),scopedSlots:{customRender:"action"}}],commodityColumns:[{title:this.L("换购商品"),dataIndex:"name"},{title:this.L("原价"),dataIndex:"old_price"},{title:this.L("原库存"),dataIndex:"stock_num",scopedSlots:{customRender:"stock_num"}},{title:this.L("操作"),width:150,scopedSlots:{customRender:"action"}}],addCommodityColumns:[{title:this.L("商品名称"),dataIndex:"name"},{title:this.L("售价"),dataIndex:"old_price"},{title:this.L("库存"),dataIndex:"stock_num",scopedSlots:{customRender:"stock_num"}},{title:this.L("是否是多规格商品"),dataIndex:"is_sku",scopedSlots:{customRender:"is_sku"}}],queryParams:{page:0,pageSize:10,store_id:0},pagination:{current:1,total:0,pageSize:10,onChange:this.onPageChange},goodQueryParams:{page:0,pageSize:10,store_id:0,keywords:""},addCommodityPagination:{current:1,total:0,pageSize:10,onChange:this.onAddCommodityPageChange},dataList:[],commodityList:[],addCommodityList:[],selectedRowKeys:[],titles:"新建",addVisible:!1,addCommodityVisible:!1,form:{name:"",start_time:null,end_time:null,note:"",coupon_id:"",goods_ids:[],total_order:1,reset_day:0},rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],coupon_id:[{required:!0,message:"请选择优惠券",trigger:"blur"}],note:[{required:!0,message:"请填写规则",trigger:"blur"}]},labelCol:{span:5},wrapperCol:{span:13},itemData:null,modelType:"add",couponList:[],goodsList:[],endOpen:!1,trip:!0}},created:function(){this.queryParams.store_id=this.$route.query.store_id,this.goodQueryParams.store_id=this.$route.query.store_id,this.getDataList(),this.getCouponList()},methods:{moment:l.a,getDataList:function(){var t=this;this.queryParams.page=this.pagination.current,this.queryParams.pageSize=this.pagination.pageSize,this.request(d.getRebateList,this.queryParams).then((function(e){t.dataList=e.data,t.$set(t.pagination,"total",e.total)}))},getCouponList:function(){var t=this;this.request(d.getRebateCouponList,{store_id:this.queryParams.store_id}).then((function(e){t.couponList=e}))},getDataListDetail:function(){var t=this,e={store_id:this.queryParams.store_id,id:this.itemData?this.itemData.id:""};this.request(d.rebateShowDetail,e).then((function(e){t.form=e,t.commodityList=e.ready_goods_list,t.goodsList=e.ready_goods_list,t.selectedRowKeys=e.goods_ids.map((function(t){return parseInt(t)})),t.addVisible=!0}))},getGoodsList:function(){var t=this;this.goodQueryParams.page=this.addCommodityPagination.current,this.goodQueryParams.pageSize=this.addCommodityPagination.pageSize,this.request(d.getGoodsList,this.goodQueryParams).then((function(e){t.addCommodityList=e.data,t.$set(t.addCommodityPagination,"total",e.total)}))},search:function(t){"shop"==t&&this.getGoodsList()},addPreferential:function(){this.modelType="add",this.titles="新建",this.addVisible=!0,this.itemData=null,this.commodityList=[],this.goodsList=[],this.selectedRowKeys=[],this.form={name:"",start_time:null,end_time:null,note:"",coupon_id:"",goods_ids:[],total_order:1,reset_day:0,store_id:this.$route.query.store_id}},setLose:function(t){var e=this,o={store_id:this.queryParams.store_id,id:t.id,status:0==t.status?1:0};this.request(d.changeRebateStatus,o).then((function(t){e.$message.success("修改状态成功"),e.getDataList()}))},editTicket:function(t){this.itemData=t,this.modelType="edit",this.titles="编辑",this.commodityList=[],this.goodsList=[],this.selectedRowKeys=[],this.getDataListDetail()},deleltTicket:function(t){var e=this;this.itemData=t;var o={store_id:this.queryParams.store_id,id:t.id};this.request(d.deleteRebate,o).then((function(t){e.$message.success("删除成功"),e.getDataList()}))},deleltCommodity:function(t){this.commodityList=this.commodityList.filter((function(e){return e.goods_id!=t.goods_id})),this.goodsList=this.goodsList.filter((function(e){return e.goods_id!=t.goods_id})),this.selectedRowKeys=this.selectedRowKeys.filter((function(e){return e!=t.goods_id}))},handleOk:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return!1;if(null!=t.form.start_time&&null!=t.form.end_time)if(t.form.goods_ids=t.selectedRowKeys,t.form.start_time=t.moment(t.form.start_time).format(t.dateFormat),t.form.end_time=t.moment(t.form.end_time).format(t.dateFormat),"add"==t.modelType)t.form.store_id=t.$route.query.store_id,t.request(d.addRebate,t.form).then((function(e){t.$message.success("添加成功"),t.addVisible=!1,t.getDataList()}));else{var o=Object(i["a"])({id:t.itemData.id,store_id:t.$route.query.store_id},t.form);t.request(d.editRebate,o).then((function(e){t.$message.success("编辑成功"),t.addVisible=!1,t.getDataList()}))}else t.$message.warning("请选择活动时间")}))},commodityOk:function(){this.form.goods_ids=this.selectedRowKeys,this.commodityList=this.goodsList,this.addCommodityVisible=!1},addCommodity:function(){this.addCommodityVisible=!0,this.addCommodityPagination.current=1,this.goodQueryParams.keywords="",this.getGoodsList()},onAddCommodityChange:function(t){this.selectedRowKeys=t},onAddCommoditySelect:function(t,e,o){e?this.goodsList.push(t):this.goodsList=this.goodsList.filter((function(e){return e.goods_id!=t.goods_id}))},onPageChange:function(t,e){this.$set(this.pagination,"current",t),this.getDataList()},onAddCommodityPageChange:function(t,e){this.$set(this.addCommodityPagination,"current",t),this.getGoodsList()},disabledStartDate:function(t){return t<l()().subtract(1,"day")},disabledEndDate:function(t){return t<l()().subtract(1,"day")},handleStartOpenChange:function(t){t||(this.endOpen=!0)},handleEndOpenChange:function(t){this.endOpen=t},closeTrip:function(){this.trip=!1}}},c=m,u=(o("c6a7"),o("0c7c")),h=Object(u["a"])(c,s,a,!1,null,"acf145d2",null);e["default"]=h.exports},c6a7:function(t,e,o){"use strict";o("f75c")},f75c:function(t,e,o){}}]);