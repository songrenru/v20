(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f4f9bf8a"],{"2de5":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mt-10 mb-20 mh-full"},[a("a-form-model",t._b({ref:"form",attrs:{model:t.formData,rules:t.rules}},"a-form-model",{labelCol:{span:4},wrapperCol:{span:10}},!1),[a("a-card",{staticStyle:{"margin-top":"10px"},attrs:{title:"优惠信息",bordered:!1}},[a("a-form-model-item",{attrs:{label:"配送周期",prop:"periodic_type"}},[a("a-radio-group",{on:{change:t.periodicTypeChange},model:{value:t.formData.periodic_type,callback:function(e){t.$set(t.formData,"periodic_type",e)},expression:"formData.periodic_type"}},[a("a-radio",{attrs:{value:1}},[t._v(" 每日一期 ")]),a("a-radio",{attrs:{value:2}},[t._v(" 每周一期 ")]),a("a-radio",{attrs:{value:3}},[t._v(" 每月一期 ")])],1)],1),1!=t.formData.periodic_type?a("a-form-model-item",{attrs:{label:"送达日期",prop:"periodic_date"}},[2==t.formData.periodic_type?a("div",[a("a-checkbox-group",{model:{value:t.formData.periodic_date,callback:function(e){t.$set(t.formData,"periodic_date",e)},expression:"formData.periodic_date"}},[a("a-checkbox",{attrs:{value:"1"}},[t._v(" 每周一 ")]),a("a-checkbox",{attrs:{value:"2"}},[t._v(" 每周二 ")]),a("a-checkbox",{attrs:{value:"3"}},[t._v(" 每周三 ")]),a("a-checkbox",{attrs:{value:"4"}},[t._v(" 每周四 ")]),a("a-checkbox",{attrs:{value:"5"}},[t._v(" 每周五 ")]),a("a-checkbox",{attrs:{value:"6"}},[t._v(" 每周六 ")]),a("a-checkbox",{attrs:{value:"0"}},[t._v(" 每周日 ")])],1)],1):t._e(),3==t.formData.periodic_type?a("div",[a("a-form-model-item",{attrs:{help:"请填写1-30之间正整数"}},[a("span",{staticClass:"ml-10"},[t._v("每月")]),a("a-input-number",{attrs:{min:1,max:30},model:{value:t.formData.periodic_date,callback:function(e){t.$set(t.formData,"periodic_date",e)},expression:"formData.periodic_date"}}),a("span",{staticClass:"ml-10"},[t._v("号")])],1)],1):t._e()]):t._e(),a("a-form-model-item",{attrs:{label:"下单时间",prop:"forward_hour"}},[a("span",{staticClass:"mr-10"},[t._v("买家需提前")]),a("a-input-number",{attrs:{min:0},model:{value:t.formData.forward_day,callback:function(e){t.$set(t.formData,"forward_day",e)},expression:"formData.forward_day"}}),a("span",{staticClass:"ml-10"},[t._v(" 天 ")]),a("a-input-number",{attrs:{min:0},model:{value:t.formData.forward_hour,callback:function(e){t.$set(t.formData,"forward_hour",e)},expression:"formData.forward_hour"}}),a("span",{staticClass:"ml-10"},[t._v("时下单支付，才能在最近的配送周期时间送达")])],1),a("a-form-model-item",{attrs:{label:"延期期数",prop:"delay_limit"}},[a("a-input-number",{attrs:{min:0},model:{value:t.formData.delay_limit,callback:function(e){t.$set(t.formData,"delay_limit",e)},expression:"formData.delay_limit"}})],1),a("a-form-model-item",{attrs:{label:"限购",prop:"buy_limit",help:"0代表不限购，请输入0~999正整数"}},[a("span",{staticClass:"mr-10"},[t._v("每人最多可参与")]),a("a-input-number",{attrs:{min:0,max:999},model:{value:t.formData.buy_limit,callback:function(e){t.$set(t.formData,"buy_limit",e)},expression:"formData.buy_limit"}}),a("span",{staticClass:"ml-10"},[t._v("次")])],1),a("a-form-model-item",{attrs:{label:"优惠是否同享",prop:"is_discount_share"}},[a("a-radio-group",{model:{value:t.formData.is_discount_share,callback:function(e){t.$set(t.formData,"is_discount_share",e)},expression:"formData.is_discount_share"}},[a("a-radio",{attrs:{value:1}},[t._v(" 是 ")]),a("a-radio",{attrs:{value:2}},[t._v(" 否 ")])],1),1==t.formData.is_discount_share?a("div",[a("a-checkbox-group",{model:{value:t.formData.share_discount,callback:function(e){t.$set(t.formData,"share_discount",e)},expression:"formData.share_discount"}},[a("a-checkbox",{attrs:{value:"1"}},[t._v(" 商家会员卡 ")]),a("a-checkbox",{attrs:{value:"2"}},[t._v(" 商家优惠券 ")])],1)],1):t._e()],1),a("a-form-model-item",{attrs:{label:"配送期数",prop:"periodic_count",help:"请输入1~99正整数"}},[a("a-input-number",{attrs:{min:1,max:99},model:{value:t.formData.periodic_count,callback:function(e){t.$set(t.formData,"periodic_count",e)},expression:"formData.periodic_count"}})],1),a("a-form-model-item",{attrs:{label:"周期购是否包邮",prop:"freight_type"}},[a("a-radio-group",{model:{value:t.formData.freight_type,callback:function(e){t.$set(t.formData,"freight_type",e)},expression:"formData.freight_type"}},[a("a-radio",{attrs:{value:1}},[t._v(" 包邮 ")]),a("a-radio",{attrs:{value:2}},[t._v(" 不包邮 ")])],1)],1)],1),a("a-card",{staticStyle:{"margin-top":"10px"},attrs:{title:"商品信息",bordered:!1}},[a("a-form-model-item",{attrs:{"wrapper-col":{span:20,offset:4}}},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.addProduct()}}},[t._v(" 添加商品 ")]),a("a-table",{directives:[{name:"show",rawName:"v-show",value:t.goodsList.length,expression:"goodsList.length"}],staticClass:"mt-20",attrs:{columns:t.columns,"data-source":t.goodsList,rowKey:"goods_id",scroll:{x:!1}},scopedSlots:t._u([{key:"name",fn:function(e,o){return a("span",{},[a("div",{staticClass:"product-info"},[a("div",[a("img",{attrs:{src:o.image}})]),a("div",[t._v(t._s(e))])])])}},{key:"price",fn:function(e,o){return a("span",{staticClass:"cr-red"},[a("span",[t._v("￥"+t._s(o.min_price)+" ~ ￥"+t._s(o.max_price))])])}},{key:"action",fn:function(e){return a("span",{},[a("a",{staticClass:"ml-10 inline-block",on:{click:function(a){return t.removeGoods(e)}}},[t._v("删除")])])}}])})],1)],1),2!=t.formData.status?a("a-form-model-item",{attrs:{"wrapper-col":{span:16,offset:2}}},[a("div",{staticClass:"mt-20 mb-20"},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.saveData()}}},[t._v(" 保存 ")])],1)]):t._e()],1),a("select-goods",{ref:"selectGoods",attrs:{type:"radio",storeId:t.store_id,source:"periodic",selectedList:t.goodsList},on:{submit:t.selecrGoodsSubmit}})],1)},r=[],i=(a("a434"),a("d3b7"),a("159b"),a("b0c0"),a("25f0"),a("4031")),s=a("c1df"),d=a.n(s),c=a("37fd"),n=a("ac0d"),l={name:"PeriodicEdit",mixins:[n["d"]],components:{SelectGoods:c["default"]},data:function(){return{store_id:"",id:"",addGoodsModalVisible:!1,formData:{periodic_type:1,periodic_date:"",buy_limit:0,periodic_count:"",forward_day:"",forward_hour:"",is_discount_share:1,freight_type:2,delay_limit:"",share_discount:["1","2"]},rules:{periodic_type:[{required:!0,message:"请选择配送周期",trigger:"blur"}],periodic_date:[{required:!0,message:"请选择送达日期",trigger:"blur"}],forward_hour:[{required:!0,message:"请选择下单时间",trigger:"blur"}],buy_limit:[{required:!0,message:"请选择限购数量",trigger:"blur"}],periodic_count:[{required:!0,message:"请选择配送期数",trigger:"blur"}],delay_limit:[{required:!0,message:"请选择延期数",trigger:"blur"}],is_discount_share:[{required:!0,message:"请选择优惠是否同享",trigger:"blur"}],freight_type:[{required:!0,message:"请选择周期购是否包邮",trigger:"blur"}]},columns:[{title:"商品信息",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"价格",dataIndex:"price",scopedSlots:{customRender:"price"},width:"200px"},{title:"当前库存",dataIndex:"stock_num"},{title:"操作",dataIndex:"goods_id",width:"100px",scopedSlots:{customRender:"action"}}],goodsList:[],selectedRowKeys:[]}},watch:{"$route.query.store_id":function(t){t&&(this.store_id=t,this.resetForm())},"$route.query.id":function(t){var e=this;this.$nextTick((function(){e.activatedFlag&&t?(e.id=t,e.resetForm(),e.getFormData()):(e.id="",e.resetForm())}))}},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,type:"checkbox",onChange:this.onSelectChange,getCheckboxProps:function(t){return{props:{}}}}}},created:function(){this.store_id=this.$route.query.store_id,this.resetForm(),this.$route.query.id&&(this.id=this.$route.query.id,this.getFormData())},methods:{moment:d.a,getFormData:function(){var t=this;this.request(i["a"].getPeriodicInfo,{id:this.id}).then((function(e){console.log(e),1==e.is_discount_share&&(e.share_discount=[],1==e.discount_card&&e.share_discount.push("1"),1==e.discount_coupon&&e.share_discount.push("2")),2==e.periodic_type&&(e.periodic_date=e.periodic_date.split(",")),t.$set(t,"formData",e),0==e.forward_day&&t.$set(t.formData,"forward_day",""),t.goodsList=e.goods_info}))},addProduct:function(){this.$refs.selectGoods.openDialog()},selecrGoodsSubmit:function(t){console.log(t),this.goodsList=t.goods},onSelectChange:function(t){console.log("selectedRowKeys changed: ",t),this.selectedRowKeys=t},removeGoods:function(t){for(var e=0;e<this.goodsList.length;e++)this.goodsList[e].goods_id===t&&this.goodsList.splice(e,1)},resetForm:function(){this.$set(this,"formData",{periodic_type:1,periodic_date:"",buy_limit:0,periodic_count:"",forward_day:"",forward_hour:"",is_discount_share:1,freight_type:2,delay_limit:"",share_discount:["1","2"]}),this.goodsList=[],this.$forceUpdate()},periodicTypeChange:function(){1==this.formData.periodic_type?this.$set(this.formData,"periodic_date",""):2==this.formData.periodic_type?this.$set(this.formData,"periodic_date",[]):3==this.formData.periodic_type&&this.$set(this.formData,"periodic_date","")},saveData:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return console.log("error submit!!",t.formData),!1;var a={};for(var o in t.formData)a[o]=t.formData[o];1!=a.is_discount_share||0!=a.share_discount.length?0!=t.goodsList.length?(1==a.is_discount_share&&(a.discount_card=0,a.discount_coupon=0,a.share_discount.forEach((function(t){1==t?a.discount_card=1:2==t&&(a.discount_coupon=1)}))),a.store_id=t.store_id,t.id&&(a.id=t.id),t.goodsList.length&&(a.goods_id=t.goodsList[0].goods_id,a.goods_name=t.goodsList[0].name),2==a.periodic_type&&(a.periodic_date=a.periodic_date.toString()),delete a.share_discount,t.request(i["a"].updatePeriodic,a).then((function(e){t.resetForm(),t.id&&t.getFormData(),t.$message.success("提交成功！"),t.$router.push({path:"/merchant/merchant.mall/periodicList",query:{store_id:t.store_id}}),sessionStorage.setItem("periodicEdit",1)}))):t.$message.error("请选择活动商品"):t.$message.error("请选择优惠同享类型")}))}}},u=l,m=(a("6e1a"),a("0c7c")),p=Object(m["a"])(u,o,r,!1,null,"1b7bf6ce",null);e["default"]=p.exports},"469b":function(t,e,a){},"6e1a":function(t,e,a){"use strict";a("469b")}}]);