(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e2005f58"],{"2d09":function(e,t,a){e.exports=a.p+"img/meal_big.ddc948bf.png"},"3ca2":function(e,t,a){"use strict";a("640e")},"4cff":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mt-20 ml-10 mr-10 mb-20"},[a("a-card",{attrs:{bordered:!1,bodyStyle:{background:"#F7F7F7"}}},[a("div",{staticClass:"fw-bold fs-20",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.title))]),a("a-row",{attrs:{type:"flex"}},[a("a-col",{staticClass:"flex",staticStyle:{display:"flex","flex-direction":"column"},attrs:{span:16}},[a("a-card",{class:"mr-20 "+("meal"==e.type&&e.detail.remark?"":"flex-1"),attrs:{bordered:!1}},[a("a-row",{attrs:{type:"flex"}},[a("a-col",{staticClass:"mr-20"},[a("a-avatar",{attrs:{shape:"square",size:150,src:e.icon}})],1),a("a-col",{staticStyle:{width:"calc(100% - 170px)"}},[a("a-row",[a("a-col",{staticClass:"fs-24 cr-33 fw-bold"},[e._v(e._s(e.detail.name))])],1),"meal"==e.type?a("div",{staticClass:"mt-20 fs-18 cr-66 store-detail"},[a("span",[e._v("套餐内容：")]),e._l(e.detail.store_detail,(function(t,i){return a("span",{key:i,staticClass:"type-name cr-00"},[a("span",{staticClass:"cr-primary"},[e._v(e._s(t.num)+"个")]),a("span",[e._v(e._s(t.type_name)+"店铺")]),a("span",{staticClass:"plus"},[e._v("+")])])}))],2):e._e(),a("div",{staticClass:"mt-20 flex align-center"},[a("span",{staticClass:"fs-18 cr-66"},[e._v("价格：")]),a("span",{staticClass:"cr-primary fs-30"},[e._v(e._s(e.currency+e.detail.year_price)+"/年")])]),a("a-row",[a("a-col",{staticClass:"flex"},[a("span",{staticClass:"mt-20 fs-18 cr-66 flex-shink"},[e._v("服务周期：")]),a("a-radio-group",{model:{value:e.year,callback:function(t){e.year=t},expression:"year"}},e._l(e.detail.service_cycle,(function(t){return a("a-radio-button",{key:t.years,staticClass:"relative mr-30 mt-20 year",attrs:{value:t.years}},[e._v(e._s(t.label)),t.discount?a("span",{staticClass:"discount-icon"},[e._v(e._s(t.discount))]):e._e()])})),1)],1)],1)],1)],1)],1),"meal"==e.type&&e.detail.remark?a("a-card",{staticClass:"mt-20 mr-20 flex-1",attrs:{bordered:!1}},[a("div",{staticClass:"flex fs-18"},[a("span",{staticClass:"cr-66 flex-shink"},[e._v("详情描述：")]),a("span",[e._v(e._s(e.detail.remark))])])]):e._e()],1),a("a-col",{attrs:{span:8}},[a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"fs-20 cr-33 fw-bold"},[e._v(e._s(e.selectTitle))]),a("div",{staticClass:"flex align-center mt-20"},[a("a-icon",{class:"fs-30 cr-99 mr-10 "+(e.num>1?"cr-primary":""),attrs:{type:"minus-circle"},on:{click:function(t){e.num>1&&(e.num=e.num-1)}}}),a("a-button",{staticClass:"inputNumber"},[e._v(e._s(e.num))]),a("a-icon",{staticClass:"fs-30 ml-10 cr-primary",attrs:{type:"plus-circle"},on:{click:function(t){e.num=e.num+1}}})],1),a("a-divider"),a("div",{staticClass:"fs-20 cr-33 fw-bold"},[e._v("店铺总数量")]),a("div",{staticClass:"fs-30 cr-primary fw-bold mt-20"},[e._v(e._s(e.store_num)+"个")]),a("a-divider"),a("div",{staticClass:"fs-20 cr-33 fw-bold mb-10"},[e._v("支付方式")]),a("div",[a("a-radio-group",{model:{value:e.pay_check,callback:function(t){e.pay_check=t},expression:"pay_check"}},e._l(e.payTypeList,(function(t,i){return a("a-radio",{key:t.value,style:e.radioStyle,attrs:{value:i}},[e._v(" "+e._s(t.label)+" "),a("span",{directives:[{name:"show",rawName:"v-show",value:"balance"==t.value,expression:"item.value == 'balance'"}]},[a("span",{staticClass:"cr-red"},[e._v(e._s(e.currency+e.merchantMoney))]),a("span",{directives:[{name:"show",rawName:"v-show",value:!e.can_balance_pay,expression:"!can_balance_pay"}],staticClass:"cr-99"},[e._v(" (余额不足）")])])])})),1)],1),a("a-divider"),a("div",{staticClass:"fs-20 cr-primary text-right"},[e._v("已优惠"+e._s(e.currency+e.discount_money))]),a("div",{staticClass:"fs-40 cr-33 text-right fw-bold"},[e._v(e._s(e.currency+e.pay_money))]),a("div",[a("a-button",{staticClass:"buy-btn",attrs:{type:"primary"},on:{click:e.goPay}},[e._v("立即购买")])],1)],1)],1)],1)],1),a("a-modal",{staticClass:"modal",staticStyle:{"text-aligin":"center"},attrs:{title:e.pay_type,width:700,centered:"",destroyOnClose:"",cancelText:"关闭",okText:"支付已完成"},on:{ok:e.handleOK,cancel:e.handleCancel},model:{value:e.wxPayModalVisible,callback:function(t){e.wxPayModalVisible=t},expression:"wxPayModalVisible"}},[a("div",{staticClass:"tips"},[e._v(e._s(e.pay_tip))]),a("div",{staticClass:"qrcode text-center"},[a("a-avatar",{attrs:{shape:"square",size:400,src:e.payCode}})],1)])],1)},s=[],r=a("5051"),n=a("2d09"),c=a("7a81"),l={data:function(){return{radioStyle:{display:"block",height:"40px",lineHeight:"40px",fontSize:"18px"},title:"店铺分类详情",type:"classify",icon:c,year:1,num:1,pay_check:0,wxPayModalVisible:!1,id:"",detail:{},currency:"¥",merchantMoney:0,discount_money:0,pay_money:0,payTypeList:[],payCode:"",pay_type:"",pay_tip:"",payTimer:"",selectTitle:""}},watch:{$route:{handler:function(e){console.log("监听路由",e)}},"$route.query.id":{immediate:!0,handler:function(e,t){void 0!=e&&this.init()}},year:function(e){this.getPrice()},num:function(e){this.getPrice()},pay_check:function(e){var t=this.payTypeList[this.pay_check];switch(this.pay_type=t.label,t.value){case"weixin":this.pay_tip="请使用微信扫描二维码进行支付";break;case"alipay":this.pay_tip="请使用支付宝扫描二维码进行支付";break}}},computed:{store_num:function(){var e=this.num;return"meal"==this.type&&(e=this.num*this.detail.all_num),e},can_balance_pay:function(){var e=this.merchantMoney,t=this.pay_money;return!(e<t)}},beforeRouteLeave:function(e,t,a){console.log("路由守卫 leave"),clearInterval(this.payTimer),a()},methods:{init:function(){this.year=1,this.num=1,console.log("初始化页面",this.data),this.id=this.$route.query.id,this.type=this.$route.query.type,"meal"==this.type?(this.title="套餐详情",this.icon=n,this.getDetail("getMealDetail"),this.selectTitle="选择套餐数量"):(this.title="店铺分类详情",this.icon=c,this.getDetail("getClassifyDetail"),this.selectTitle="选择店铺数量")},goPay:function(){var e=this,t=this.pay_check,a=this.payTypeList;"balance"==a[t].value?this.can_balance_pay?this.$confirm({title:"确定使用商家余额支付吗?",content:"",onOk:function(){e.checkOrder()},onCancel:function(){console.log("Cancel")}}):this.$message.error("商家余额不足，请使用其他支付方式！",1):this.checkOrder()},handleCancel:function(){clearInterval(this.payTimer),this.wxPayModalVisible=!1},handleOK:function(){var e=this;clearInterval(this.payTimer),this.$multiTab.closeCurrentPage(),this.wxPayModalVisible=!1,setTimeout((function(){e.$router.push({path:"/new_marketing/merchant/storeUseDetail"})}),200)},getDetail:function(e){var t=this;this.request(r["a"][e],{id:this.id}).then((function(e){console.log("详情",e),t.currency=e.currency,t.detail=e.data,t.merchantMoney=1*e.money,t.getPrice(),t.getPayType()}))},getPrice:function(){var e=this,t=this.id,a=this.year,i=this.num,s=this.type,n={id:t,year:a,num:i,type:"meal"==s?1:2};this.request(r["a"].getPrice,n).then((function(t){e.discount_money=1*t.discount,e.pay_money=1*t.pay}))},getPayType:function(){var e=this;this.request(r["a"].getPayType).then((function(t){e.payTypeList=t}))},checkOrder:function(){var e=this,t=this.pay_check,a=this.type,i=this.id,s=this.pay_money,n=this.discount_money,c=this.year,l=this.store_num,o=this.num,y={pay_check:t,type:a,id:i,pay_money:s,discount_money:n,year:c,store_num:l,num:o};y.pay_check=this.payTypeList[t].value,y.type="meal"==a?1:2,this.request(r["a"].checkOrder,y).then((function(t){return console.log("支付详情",t),1==t.pay_ok?(e.$multiTab.closeCurrentPage(),void e.$router.push({path:"/new_marketing/merchant/storeUseDetail"})):(e.checkPayOk(t.orderid,t.pay_ok),2==t.pay_ok?(e.payCode=t.info,void(e.wxPayModalVisible=!0)):3==t.pay_ok?(e.$confirm({title:"支付状态确认",content:"",okText:"支付已完成",cancelText:"关闭",onOk:function(){e.handleOK()},onCancel:function(){clearInterval(e.payTimer)}}),void window.open(t.info)):void 0)}))},checkPayOk:function(e,t){var a=this;this.payTimer=setInterval((function(){a.request(r["a"].checkOrderPayOk,{orderid:e}).then((function(e){1==e.paid&&(clearInterval(a.payTimer),a.handleOK())}))}),1e3)}}},o=l,y=(a("3ca2"),a("0c7c")),d=Object(y["a"])(o,i,s,!1,null,"73f1552d",null);t["default"]=d.exports},5051:function(e,t,a){"use strict";var i={getCatList:"/new_marketing/merchant.MarketingPackage/getCatList",getCatStoreList:"/new_marketing/merchant.MarketingPackage/getCatSearchList",getMealList:"/new_marketing/merchant.MarketingPackage/getSearchList",getClassifyDetail:"/new_marketing/merchant.MarketingPackage/getCatDetail",getMealDetail:"/new_marketing/merchant.MarketingPackage/getpackageDetail",getPrice:"/new_marketing/merchant.MarketingPackage/getDiscountPayPrice",getPayType:"/new_marketing/merchant.Order/pay_check",checkOrder:"/new_marketing/merchant.Order/pay",checkOrderPayOk:"/new_marketing/merchant.Order/searchPayStatus",getOrderList:"/new_marketing/merchant.order/getOrderList",getStoreUserdDetail:"/new_marketing/merchant.store/getStoreUserdDetail",getOrderDetail:"/new_marketing/merchant.order/getOrderDetail",getCategoryStoreDetail:"/new_marketing/merchant.store/getCategoryStoreDetail",getCategoryStoreList:"/new_marketing/merchant.store/getCategoryStoreList",getRenewPayInfo:"/new_marketing/merchant.order/getPayInfo",savePayInfo:"/new_marketing/merchant.order/savePayInfo",goPay:"/merchant/merchant.pay/goPay"};t["a"]=i},"640e":function(e,t,a){},"7a81":function(e,t,a){e.exports=a.p+"img/classify_big.c4e270a5.png"}}]);