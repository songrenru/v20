(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4bc83b8c","chunk-2d0c20dc","chunk-2d0bacf3","chunk-2d0bacf3"],{2537:function(e,t,a){"use strict";a.r(t);a("b0c0");var l=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("a-modal",{attrs:{title:"欠费账单导入向导",width:1e3,visible:e.visible,maskClosable:!1,footer:e.isImporting||2==e.currentKey?null:void 0},on:{cancel:e.handleCancel}},[t("a-tabs",{attrs:{"default-active-key":1},on:{change:e.tabChange}},[t("a-tab-pane",{key:1,attrs:{tab:"导入操作"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.firstStep&&!e.isImporting,expression:"firstStep && !isImporting"}],staticClass:"step_one"},[t("h4",[e._v("步骤一：选择需要上传【欠费账单】所属【收费项目】")]),t("h5",[t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("注意：")]),e._v("1. 仅支持"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【收费模式：一次性费用】")]),e._v("的"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【收费项目】")]),e._v("。")]),t("div",[t("span",{staticClass:"label_col",staticStyle:{color:"rgba(0, 0, 0, 0.85)"}},[e._v("收费科目：")]),t("a-select",{staticStyle:{width:"282px","margin-left":"20px"},attrs:{"show-search":""},on:{change:e.handleChargeNumberChange},model:{value:e.subjectId,callback:function(t){e.subjectId=t},expression:"subjectId"}},e._l(e.chargeNumber,(function(a,l){return t("a-select-option",{key:l,attrs:{value:a.id}},[e._v(e._s(a.name))])})),1)],1),t("div",{staticStyle:{"padding-top":"10px"}},[t("span",{staticClass:"label_col",staticStyle:{color:"rgba(0, 0, 0, 0.85)"}},[e._v("收费项目：")]),t("a-select",{staticStyle:{width:"282px","margin-left":"20px"},attrs:{"show-search":""},on:{change:e.handleChargeProjectChange},model:{value:e.projectId,callback:function(t){e.projectId=t},expression:"projectId"}},e._l(e.chargeProject,(function(a,l){return t("a-select-option",{key:l,attrs:{value:a.id}},[e._v(e._s(a.name))])})),1)],1),e.projectId?t("div",[t("h4",[e._v("步骤二：上传 Excel 文件")]),t("h5",[t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("注意：")]),e._v("1. 导入的欠费会归属到所选"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【收费项目】")]),e._v("下，以导入表中"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("[欠缴费用名称]")]),e._v("为名称的"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【计费模式：固定费用】")]),e._v("的"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【收费标准】")]),e._v("中。")]),t("h5",{staticStyle:{"padding-left":"35px"}},[e._v("2. 表中相同"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("[欠缴费用名称]")]),e._v("不同"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("[欠缴金额]")]),e._v("会生成不同的"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【收费标准】")]),e._v("。")]),t("p",[e._v("您要从何处导入数据，请选择导入的 Excel 文件")]),t("div",{staticStyle:{display:"flex",width:"80%"}},[t("div",{staticClass:"label",staticStyle:{width:"82px","text-align":"left"}},[e._v("Excel文件")]),t("a-upload-dragger",{staticStyle:{height:"100px",width:"calc(100% - 82px)","margin-left":"10px"},attrs:{name:"file",multiple:!0,action:e.uploadUrl,beforeUpload:e.beforeUploadExcel,showUploadList:!1,headers:e.headers,data:{upload_dir:"billExcel",system_type:"village",type:"billExcel"}},on:{change:e.handleUploadChange}},[t("a-icon",{attrs:{type:e.uploadLoading?"loading":"upload"}}),e._v(" "+e._s(e.uploadFileName?e.uploadFileName:"拖拽或点击上传 Excel 文件")+" ")],1)],1),e.fileList.length>0?t("div",{staticClass:"select_list",staticStyle:{display:"flex","align-items":"center",height:"50px"}},[t("div",{staticClass:"label",staticStyle:{width:"82px","text-align":"left"}},[e._v("选择Sheet表")]),t("a-select",{staticStyle:{width:"120px","margin-left":"10px"},attrs:{"default-value":0},on:{change:e.handleSelectChange}},e._l(e.fileList,(function(a,l){return t("a-select-option",{key:l,attrs:{value:l}},[e._v(" "+e._s(a.worksheetName)+" ")])})),1),t("div",{staticStyle:{color:"red","margin-left":"10px"}},[e._v("总数据量："+e._s(e.selectObj.totalRows?e.selectObj.totalRows-1:0)+" 条")])],1):e._e(),t("h5",[e._v("导入步骤：")]),t("h5",[t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("注意：")]),e._v(" 1. "),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【楼栋】")]),e._v("、 "),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【单元】")]),e._v("、 "),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【楼层】")]),e._v("、 "),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("【房间号】")]),e._v(" 是和对应名称或编号"),t("span",{staticStyle:{color:"#ff4d4f"}},[e._v("全匹配[就是名称或者编号需要完全一致]")]),e._v("定位对应房间的。")]),t("p",[e._v(" 第一步：上传存储有的资料 Excel 文件；【您可以直接上传 Excel 文件或者下载模板："),t("a-button",{attrs:{type:"link"},on:{click:e.downloadExcel}},[e._v(" 模板下载")]),e._v("】 ")],1),t("p",[e._v(" 第二步：设置 Excel 里的列与系统中的列的对应关系")]),t("p",[e._v(" 第三步：开始导入")])]):e._e()])]),t("a-tab-pane",{key:2,attrs:{tab:"导入日志"}},[2==e.currentKey?t("importRecord",{attrs:{type:e.uploadType}}):e._e()],1)],1),e.isImporting?e._e():t("template",{slot:"footer"},[t("div",{staticClass:"footer_con",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},[e.firstStep?t("div",{staticClass:"left"}):e._e(),t("div",{staticClass:"right"},[t("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.startImport}},[e._v("开始导入")]),t("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"default"},on:{click:e.handleCancel}},[e._v("取消")])],1)])]),e.isImporting&&2!=e.currentKey?t("div",{staticClass:"progress_content",staticStyle:{width:"100%",height:"450px",display:"flex","align-items":"center","justify-content":"center","flex-direction":"column"}},[t("a-progress",{attrs:{type:"circle","stroke-color":{"0%":"#108ee9","100%":"#87d068"},percent:e.percentVal}}),t("div",{staticClass:"importing",staticStyle:{"margin-top":"15px"}},[e._v(" 总行数 "),t("span",{staticStyle:{"font-size":"larger"}},[e._v(e._s(e.readRowTotal))]),e._v("，正在导入，剩余"),t("span",{staticStyle:{"font-size":"larger"}},[e._v(e._s(e.readRowTotal-(e.successInsterTotal+e.errorTotal))+" ")]),e._v(" 条记录待导入，成功"),t("span",{staticStyle:{color:"#68C472","font-size":"larger"}},[e._v(e._s(e.successInsterTotal))]),e._v("条,失败"),t("span",{staticStyle:{color:"red","font-size":"larger"}},[e._v(" "+e._s(e.errorTotal)+" ")]),e._v("条 ")]),t("div",{staticClass:"desc",staticStyle:{"margin-top":"15px",color:"#999999","font-size":"14px"}},[100!=e.percentVal?t("span",[e._v("提示：正在等待导入，如果关闭本窗口，导入不会中断")]):t("span",[e._v("导入完成")]),100==e.percentVal?t("a-button",{attrs:{type:"link"},on:{click:e.goBack}},[e._v("重新导入")]):e._e()],1)],1):e._e()],2)},n=[],i=(a("ac1f"),a("1276"),a("8bbf")),o=a.n(i),r=(a("5880"),a("ca00")),c=(a("3990"),a("4956")),s=Object(i["defineComponent"])({props:{visible:{type:Boolean,default:!1},uploadType:{type:String,default:"billExcel"}},components:{importRecord:c["default"]},setup:function(e,t){var a=Object(i["ref"])(0),l=Object(i["ref"])(null),n=Object(i["ref"])(!1),c=Object(i["ref"])(0),s=Object(i["ref"])("/v20/public/index.php/community/common.BillExcel/billUploadFile"),u=Object(i["ref"])([]),p=Object(i["ref"])(!1),d=Object(i["ref"])(!0),v=Object(i["ref"])(0),f=Object(i["ref"])(""),m=Object(i["ref"])([]),g=Object(i["ref"])(null),y=Object(i["ref"])([]),_=Object(i["ref"])(null),h=function(){o.a.prototype.request("/community/common.BillExcel/getChargeSubject",{tokenName:X.value}).then((function(e){m.value=e,console.log("getChargeNumber",e)})).catch((function(e){console.log("getChargeNumber",e)}))},b=function(e){o.a.prototype.request("/community/common.BillExcel/getChargeProject",{subject_id:e,tokenName:X.value}).then((function(e){y.value=e,console.log("chargeProject",e)})).catch((function(e){console.log("chargeProject",e)}))},x=function(e){console.log("handleChargeNumberChange",e),g.value=e,_.value=null,b(e)},I=function(e){console.log("handleChargeProjectChange",e),_.value=e},R=function(e){var t=e.name.split(".").pop();if("xlsx"!=t&&"xls"!=t)return p.value=!1,o.a.prototype.$message.warn("上传文件格式非 Excel"),!1},S=function(){q(),t.emit("exit",!1)},w=function(){d.value=!0},j=function(){g.value?_.value?L.totalRows&&0==L.totalRows?o.a.prototype.$message.warn("请完善上传信息"):B.value&&O.value?o.a.prototype.request("/community/common.BillExcel/startImport",{tokenName:X.value,subjectId:g.value,projectId:_.value,inputFileName:O.value,worksheetName:B.value,selectWorkSheetIndex:v.value}).then((function(e){o.a.prototype.$message.success("提交成功，准备导入，调整画面为进度条画面！"),n.value=!0,l.value=setInterval((function(){$()}),1e3)})).catch((function(e){n.value=!1,q()})):o.a.prototype.$message.warn("请先上传Excel文件"):o.a.prototype.$message.warn("请选择收费项目"):o.a.prototype.$message.warn("请选择收费科目")},k=Object(r["k"])("/community/village_api.Building/villageUploadFile"),U=o.a.ls.get(k),C=Object(i["reactive"])({authorization:"authorization-text",ticket:U}),O=Object(i["ref"])(""),B=Object(i["ref"])(""),E=function(e){p.value=!0,"uploading"!==e.file.status&&(p.value=!0),"done"===e.file.status?(console.log("info.file.response.data.path",e.file.response.data.path),O.value=e.file.response.data.path,p.value=!1,1e3==e.file.response.status?(f.value=e.file.response.data.file_name,F(O.value)):o.a.prototype.$message.error(e.file.response.msg)):"error"===e.file.status&&(p.value=!1,o.a.prototype.$message.error("".concat(e.file.name," file upload failed.")))},L=Object(i["ref"])({}),N=function(e){L.value=u.value[e],B.value=u.value[e].worksheetName,v.value=e,Object(i["getCurrentInstance"])()},F=function(e){o.a.prototype.request("/community/common.BillExcel/importForExcel",{inputFileName:e,tokenName:X.value}).then((function(e){u.value=e.worksheet,L.value=e.worksheet[0],B.value=e.worksheet[0].worksheetName,console.log("importForExcel ------\x3e",e),Object(i["getCurrentInstance"])()})).catch((function(e){}))},P=Object(i["ref"])(0),T=Object(i["ref"])(0),z=Object(i["ref"])(0),V=Object(i["ref"])(0),$=function(){o.a.prototype.request("/community/common.BillExcel/refreshProcess",{type:"billExcel",tokenName:X.value}).then((function(e){e.process&&(P.value=e.process,T.value=e.processInfo.readRowTotal,z.value=e.processInfo.successInsterTotal,V.value=e.processInfo.errorTotal,100==e.process&&(o.a.prototype.$message.warn("导入执行完毕！"),q()))})).catch((function(e){q()}))},q=function(){clearInterval(l.value),l.value=null,O.value="",B.value="",f.value="",u.value=[]},D=function(){o.a.prototype.request("/community/common.BillExcel/getImportTemplateUrl",{tokenName:X.value}).then((function(e){console.log("downloadExcel",e.url),window.open(e.url)})).catch((function(e){console.log("downloadExcel",e)}))},K=function(){u.value=[],d.value=!0,n.value=!1,P.value=0,T.value=0,T.value=0,z.value=0,V.value=0,f.value="",O.value="",B.value="",clearInterval(l.value),l.value=null},W=Object(i["ref"])(1),J=function(e){W.value=e},M=Object(i["ref"])(null),X=Object(i["ref"])(null);return Object(i["watch"])((function(){return e.visible}),(function(e){M.value=Object(r["i"])(location.hash),M.value?X.value=M.value+"_access_token":M.value="village",m.value=[],y.value=[],g.value=null,_.value=null,console.log("val",e),console.log("tokenNameSys",X.value),console.log("tokenName",k),console.log("token",U),h()}),{deep:!0}),{handleCancel:S,headers:C,handleUploadChange:E,currentIndex:c,uploadUrl:s,uploadExcelFile:F,downloadExcel:D,fileList:u,uploadLoading:p,selectObj:L,handleSelectChange:N,firstStep:d,preStep:w,startImport:j,pathUrl:O,beforeUploadExcel:R,interval:l,refreshProgress:$,isImporting:n,percentVal:P,clearTimer:q,isSkip:a,readRowTotal:T,successInsterTotal:z,errorTotal:V,uploadFileName:f,goBack:K,tabChange:J,currentKey:W,getChargeNumber:h,handleChargeNumberChange:x,handleChargeProjectChange:I,chargeNumber:m,chargeProject:y,subjectId:g,projectId:_,sysName:M}}}),u=s,p=(a("bb2b"),a("2877")),d=Object(p["a"])(u,l,n,!1,null,"399cdb8a",null);t["default"]=d.exports},3990:function(e,t,a){"use strict";var l={villageInfo:"/community/village_api.VillageConfig/getVillageInfo",baseConfig:"/community/village_api.VillageConfig/baseConfig",buildingIndex:"/community/village_api.Building/index",roomIndex:"/community/village_api.Room/index",ownerIndex:"/community/village_api.Owner/index",ownerReview:"/community/village_api.Owner/review",ownerUnbid:"/community/village_api.Owner/unbind",familyIndex:"/community/village_api.FamilyMember/index",enantIndex:"/community/village_api.Enant/index",buildingList:"/community/village_api.Building/index",deleteBuilding:"/community/village_api.Building/deleteBuilding",buildingInfo:"/community/village_api.Building/buildingInfo",updateBuildingStatus:"/community/village_api.Building/updateBuildingStatus",saveBuildingButler:"/community/village_api.Building/saveBuildingButler",getBuildingButler:"community/village_api.Building/getBuildingButler",updateBuildingInfoByID:"community/village_api.Building/updateBuildingInfoByID",buildingUnitFloor:"community/village_api.Building/unitFloor",buildingFloorLayerRooms:"community/village_api.Building/floorLayerRooms",unitRentalList:"/community/village_api.UnitRental/index",deleteUnitRental:"/community/village_api.UnitRental/deleteUnitRental",unitRentalInfo:"/community/village_api.UnitRental/unitRentalInfo",updateUnitRentalStatus:"/community/village_api.UnitRental/updateUnitRentalStatus",saveUnitRentalButler:"/community/village_api.UnitRental/saveUnitRentalButler",getUnitRentalButler:"community/village_api.UnitRental/getUnitRentalButler",updateUnitRentalInfoByID:"community/village_api.UnitRental/updateUnitRentalInfoByID",unitRentalFloorList:"community/village_api.UnitRental/unitRentalFloorList",updateUnitRentalFloorStatus:"community/village_api.UnitRental/updateUnitRentalFloorStatus",deleteUnitRentalFloor:"community/village_api.UnitRental/deleteUnitRentalFloor",unitRentalFloorInfo:"community/village_api.UnitRental/unitRentalFloorInfo",saveUnitRentalFloorInfo:"community/village_api.UnitRental/saveUnitRentalFloorInfo",unitRentalLayerList:"community/village_api.UnitRental/unitRentalLayerList",unitRentalLayerInfo:"community/village_api.UnitRental/unitRentalLayerInfo",saveUnitRentalLayerInfo:"community/village_api.UnitRental/saveUnitRentalLayerInfo",updateUnitRentalLayerStatus:"community/village_api.UnitRental/updateUnitRentalLayerStatus",deleteUnitRentalLayer:"community/village_api.UnitRental/deleteUnitRentalLayer",thirdVillageUploadFile:"community/village_api.third.Room/villageUploadFile",thirdStartRoomImport:"community/village_api.third.Room/startRoomImport",thirdStartUserImport:"community/village_api.third.Room/startUserImport",thirdStartChargeImport:"community/village_api.third.Room/startChargeImport",thirdRefreshProcess:"community/village_api.third.Room/refreshProcess",ownerList:"/community/village_api.People.Owner/index",servicesImgPreview:"/community/village_api.WorkWeiXin/servicesImgPreview"};t["a"]=l},4956:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"charging_standard"},[t("a-table",{attrs:{"row-key":function(e){return e.add_time},pagination:e.pageInfo,columns:e.chargeColumns,loading:e.tableLoading,"data-source":e.tableList},on:{change:e.tableChange},scopedSlots:e._u([{key:"file_url",fn:function(a,l){return t("span",{},[0==l.status?t("a",{on:{click:function(t){return e.goUrl(l.file_url)}}},[e._v("点击查看")]):t("span",[e._v("--")])])}},{key:"duration",fn:function(a,l){return t("span",{},[e._v(" "+e._s(l.duration)+"s ")])}},{key:"status",fn:function(a,l){return t("span",{},[t("span",{style:{color:0==l.status?"red":"green"}},[e._v(e._s(0==l.status?"存在导入失败的数据":"导入成功"))])])}}])})],1)},n=[],i=a("8bbf"),o=a.n(i),r=Object(i["defineComponent"])({props:{type:{type:String,default:""}},setup:function(e,t){var a=Object(i["ref"])([]),l=Object(i["ref"])({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40","50","60","70","80","90","100"],showSizeChanger:!0}),n=Object(i["ref"])([]),r=Object(i["ref"])(!1);Object(i["onMounted"])((function(){s()}));var c=function(e){var t=e.pageSize,a=e.current;l.value.current=a,l.value.pageSize=t,s()},s=function(){r.value=!0,o.a.prototype.request("/community/common.BillExcel/getVillageImportRecord",{tokenName:"village_access_token",type:e.type,page:l.value.current,limit:l.value.pageSize}).then((function(e){n.value=e.list,l.value.total=e.count,r.value=!1})).catch((function(e){r.value=!1}))};a.value=[{title:"文件名称",dataIndex:"file_name",key:"file_name"},{title:"详情",dataIndex:"file_url",key:"file_url",scopedSlots:{customRender:"file_url"}},{title:"时长",dataIndex:"duration",key:"duration",scopedSlots:{customRender:"duration"}},{title:"结果",dataIndex:"import_msg",key:"import_msg"},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"时间",dataIndex:"add_time",key:"add_time"}];var u=function(e){window.open(e)};return{chargeColumns:a,pageInfo:l,tableList:n,tableLoading:r,getRecordList:s,tableChange:c,goUrl:u}}}),c=r,s=a("2877"),u=Object(s["a"])(c,l,n,!1,null,"8f0ee14e",null);t["default"]=u.exports},"51de":function(e,t,a){},bb2b:function(e,t,a){"use strict";a("51de")}}]);