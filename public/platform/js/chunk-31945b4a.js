(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-31945b4a","chunk-7cd6f5a8"],{"05cf":function(t,e,a){"use strict";a.r(e);a("aa48"),a("8f7e");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cloudintercom"},[e("div",{staticClass:"search-box"},[e("a-row",{attrs:{type:"flex"}},[e("a-col",{attrs:{span:15}},[e("a-input-group",{attrs:{compact:""}},[e("p",{staticStyle:{"margin-top":"5px"}},[t._v("姓名：")]),e("a-input",{staticClass:"select_position",attrs:{placeholder:"请输入姓名"},model:{value:t.search.keyword,callback:function(e){t.$set(t.search,"keyword",e)},expression:"search.keyword"}}),e("p",{staticStyle:{"margin-top":"5px"}},[t._v("非机动车卡：")]),e("a-input",{staticClass:"select_position",attrs:{placeholder:"请输入非机动车卡"},model:{value:t.search.nmvCard,callback:function(e){t.$set(t.search,"nmvCard",e)},expression:"search.nmvCard"}}),e("p",{staticStyle:{"margin-top":"5px"}},[t._v("剩余天数：")]),e("a-input",{staticClass:"select_position",attrs:{placeholder:"请输入剩余天数"},model:{value:t.search.surplusDays,callback:function(e){t.$set(t.search,"surplusDays",e)},expression:"search.surplusDays"}}),e("p",{staticStyle:{"margin-top":"5px"}},[t._v("状态：")]),e("a-select",{staticClass:"select_position",model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}},[e("a-select-option",{attrs:{value:0}},[t._v("请选择状态")]),e("a-select-option",{attrs:{value:1}},[t._v("已到期")]),e("a-select-option",{attrs:{value:2}},[t._v("未到期")]),e("a-select-option",{attrs:{value:3}},[t._v("未缴费")])],1)],1)],1),e("a-col",{staticStyle:{"margin-right":"10px"},attrs:{span:1}},[e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.getNmvCardList(1)}}},[t._v("查询")])],1),e("a-col",{attrs:{span:1}},[e("a-button",{on:{click:function(e){return t.resetList()}}},[t._v("重置")])],1)],1)],1),e("div",{staticClass:"add-box"},[e("a-row",[e("a-col",{attrs:{span:2}},[e("a-popconfirm",{staticClass:"ant-dropdown-link",staticStyle:{"margin-left":"10px"},attrs:{title:"确认通知?","ok-text":"是","cancel-text":"否"},on:{confirm:function(e){return t.payNotice(0,"batch")}}},[e("a-button",{attrs:{type:"primary"}},[t._v("批量通知")])],1)],1),e("a-col",[e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.$refs.nonMotorVehiclePay.addpay()}}},[t._v("电动车缴费")])],1)],1)],1),e("a-table",{staticClass:"components-table-demo-nested",attrs:{columns:t.columns,"data-source":t.data,rowKey:"id","row-selection":t.rowSelection,pagination:t.pagination,loading:t.loading},on:{change:t.table_change},scopedSlots:t._u([{key:"action",fn:function(a,i){return e("span",{},[e("a",{on:{click:function(e){return t.paymentRecordPage(i.id)}}},[t._v("缴费记录")]),e("a-divider",{attrs:{type:"vertical"}}),e("a-popconfirm",{staticClass:"ant-dropdown-link",staticStyle:{"margin-left":"10px"},attrs:{title:"确认通知?","ok-text":"是","cancel-text":"否"},on:{confirm:function(e){return t.payNotice(i.id,"single")}}},[e("a",[t._v("一键通知")])])],1)}}])}),t.visible?e("a-modal",{attrs:{title:"缴费记录",width:1e3,visible:t.visible,footer:null,maskClosable:!1},on:{cancel:t.handleCancel}},[e("a-table",{staticClass:"components-table-demo-nested",attrs:{columns:t.columnsOrder,"data-source":t.dataOrder,rowKey:"order_id",pagination:t.paginationOrder,loading:t.loadingOrder},on:{change:t.table_changeOrder}})],1):t._e(),e("non-motor-vehicle-pay",{ref:"nonMotorVehiclePay",on:{ok:t.bindOk}})],1)},s=[],r=a("a0e0"),n=a("65bd"),o=[{title:"姓名",dataIndex:"name",key:"name"},{title:"非机动车卡",dataIndex:"nmv_card",key:"nmv_card"},{title:"到期时间",dataIndex:"expiration_time",key:"expiration_time"},{title:"剩余天数",dataIndex:"surplus_days",key:"surplus_days"},{title:"状态",dataIndex:"status",key:"status"},{title:"操作",dataIndex:"operation",key:"operation",scopedSlots:{customRender:"action"}}],l=[{title:"支付类型",dataIndex:"type_name",key:"type_name"},{title:"缴费周期",dataIndex:"cycle_num",key:"cycle_num"},{title:"支付金额",dataIndex:"pay_money",key:"pay_money"},{title:"支付时间",dataIndex:"pay_time",key:"pay_time"},{title:"支付方式",dataIndex:"pay_type",key:"pay_type"},{title:"支付状态",dataIndex:"is_paid",key:"is_paid"}],c=[],d=[],h={name:"paymentRecord",components:{nonMotorVehiclePay:n["default"]},data:function(){return{labelCol:{span:4},wrapperCol:{span:14},pagination:{current:1,pageSize:10,total:10},paginationOrder:{current:1,pageSize:10,total:10},search:{keyword:"",nmvCard:"",page:1,surplusDays:"",status:0},loading:!1,card_id:0,loadingOrder:!1,columns:o,columnsOrder:l,data:c,dataOrder:d,villageId:"",visible:!1,selectedSendUser:[]}},mounted:function(){this.getNmvCardList()},computed:{rowSelection:function(){var t=this;return{onChange:function(e,a){t.selectedSendUser=e}}}},methods:{getNmvCardList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.loading=!0,1===e&&this.$set(this.pagination,"current",1),this.search["page"]=this.pagination.current,this.request(r["a"].getNmvCardList,this.search).then((function(e){console.log(e),t.pagination.total=e.count?e.count:0,t.pagination.pageSize=e.total_limit?e.total_limit:10,t.data=e.list,t.loading=!1}))},paymentRecordPage:function(t){this.card_id=t,this.getNmvChargeOrderList(0,t),this.visible=!0},bindOk:function(){this.getNmvCardList()},getNmvChargeOrderList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0;this.loadingOrder=!0;var i={id:a};1===e&&this.$set(this.paginationOrder,"current",1),i["page"]=this.paginationOrder.current,this.request(r["a"].getNmvChargeOrderList,i).then((function(e){t.paginationOrder.total=e.count?e.count:0,t.paginationOrder.pageSize=e.total_limit?e.total_limit:10,t.dataOrder=e.list,t.loadingOrder=!1}))},resetList:function(){this.$set(this.pagination,"current",1),this.search={keyword:"",nmvCard:"",page:1,surplusDays:"",status:0},this.getNmvCardList()},table_change:function(t){var e=this;t.current&&t.current>0&&(e.$set(e.pagination,"current",t.current),e.getNmvCardList())},table_changeOrder:function(t){var e=this;t.current&&t.current>0&&(e.$set(e.paginationOrder,"current",t.current),e.getNmvChargeOrderList(0,this.card_id))},handleCancel:function(){this.visible=!1,this.$set(this.paginationOrder,"current",1),this.getNmvCardList()},payNotice:function(t,e){var a=this;if("single"===e)this.selectedSendUser=[t];else if(this.selectedSendUser.length<1)return this.$message.error("请先选择需要通知的用户"),!1;var i={send:this.selectedSendUser};this.request(r["a"].sendNmvMessage,i).then((function(t){a.$message.success("操作成功"),a.getNmvCardList()}))}}},u=h,p=(a("0c82"),a("0b56")),m=Object(p["a"])(u,i,s,!1,null,null,null);e["default"]=m.exports},"0c82":function(t,e,a){"use strict";a("8efb")},"37f0":function(t,e,a){},"65bd":function(t,e,a){"use strict";a.r(e);a("7023"),a("54f8");var i=function(){var t=this,e=t._self._c;return e("a-drawer",{attrs:{title:"电动车缴费",width:850,visible:t.visible,maskClosable:!1,placement:"right"},on:{close:t.handleCancel}},[e("a-card",[e("a-form",{attrs:{form:t.form}},[e("a-form-item",{attrs:{label:"用户姓名搜索",labelCol:t.labelCol,required:!0,extra:"从搜到的下拉框中选择一条数据"}},[e("a-select",{staticStyle:{width:"300px"},attrs:{"show-search":"",placeholder:"请输入要搜索的姓名",autocomplete:"off","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null,"auto-focus":!1},on:{search:t.handleSearch,change:t.searchOptionChange,blur:t.handleSearchBlur,focus:t.handleSearchFocus},model:{value:t.search_keyword,callback:function(e){t.search_keyword="string"===typeof e?e.trim():e},expression:"search_keyword"}},t._l(t.search_data,(function(a,i){return e("a-select-option",{key:i},[t._v(" "+t._s(a.name)+" ")])})),1)],1),e("a-form-item",{attrs:{label:"非机动车卡",labelCol:t.labelCol,required:!0,extra:"先通过用户姓名搜索到数据,再来选择卡号"}},[e("a-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择卡号"},on:{change:t.calculationNmvCost},model:{value:t.post.card_no,callback:function(e){t.$set(t.post,"card_no",e)},expression:"post.card_no"}},t._l(t.card_list,(function(a){return e("a-select-option",{key:a.nmv_card,attrs:{label:a.nmv_card}},[t._v(" "+t._s(a.nmv_card)+" ")])})),1)],1),e("a-form-item",{attrs:{label:"当前到期时间",labelCol:t.labelCol}},[e("div",[t._v(" "+t._s(t.expiration_time)+" ")])]),e("a-form-item",{attrs:{label:"电动车收费规则",labelCol:t.labelCol,required:!0,extra:"请选择一种收费规则"}},[e("a-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择收费规则"},on:{change:t.calculationNmvCost},model:{value:t.post.rule_id,callback:function(e){t.$set(t.post,"rule_id",e)},expression:"post.rule_id"}},t._l(t.charge_rule,(function(a){return e("a-select-option",{key:a.rule_id,attrs:{label:a.type_text}},[t._v(" "+t._s(a.type_text)+" ")])})),1)],1),e("a-form-item",{attrs:{label:"收费周期",labelCol:t.labelCol,extra:"(不填默认1)"}},[e("a-input-number",{staticStyle:{width:"300px"},attrs:{maxLength:20,placeholder:"请输入收费周期",autocomplete:"off",min:1},on:{change:t.calculationNmvCost},model:{value:t.post.cycle_num,callback:function(e){t.$set(t.post,"cycle_num",e)},expression:"post.cycle_num"}})],1),e("a-form-item",{attrs:{label:"线下支付方式",labelCol:t.labelCol,required:!0,extra:"请选择一种线下支付方式"}},[e("a-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择标支付方式"},on:{change:t.calculationNmvCost},model:{value:t.post.offline_pay_type,callback:function(e){t.$set(t.post,"offline_pay_type",e)},expression:"post.offline_pay_type"}},t._l(t.offline_pay,(function(a){return e("a-select-option",{key:a.id,attrs:{label:a.name}},[t._v(" "+t._s(a.name)+" ")])})),1)],1),e("a-form-item",{attrs:{label:"支付金额",labelCol:t.labelCol}},[e("div",[t._v(" "+t._s(t.pay_momey)+"   元")])])],1)],1),e("a-card",{staticStyle:{"text-align":"center"},attrs:{bordered:!1}},[e("a-button",{staticStyle:{"margin-top":"20px"},attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.handleSubmit()}}},[t._v("确认支付 ")])],1)],1)},s=[],r=(a("c5cb"),a("08c7"),a("1376"),a("a0e0")),n={name:"nonMotorVehiclePay",filters:{},data:function(){return{labelCol:{xs:{span:10},sm:{span:4}},form:this.$form.createForm(this),visible:!1,loading:!1,post:{rule_id:"",card_no:"",cycle_num:1,offline_pay_type:""},offline_pay:[],charge_rule:[],card_list:[],search_data:[],search_keyword:"",searched_arr:{},expiration_time:"",pay_momey:""}},activated:function(){},methods:{addpay:function(){this.search_keyword="",this.search_data=[],this.expiration_time="",this.card_list=[],this.searched_arr={},this.post.card_no="",this.post.cycle_num=1,this.pay_momey="",this.offline_pay_type="",this.getNmvChargePayInfo(),this.visible=!0},getNmvChargePayInfo:function(){var t=this;this.request(r["a"].getNmvChargePayInfo).then((function(e){console.log(e),t.charge_rule=e.charge_rule,t.offline_pay=e.offline_pay})).catch((function(t){}))},handleSearch:function(t){var e=this;if(""===t)return this.search_data=[],this.search_keyword="",!1;console.log("handleSearch",t),this.search_keyword=t;var a={keyword:t,cfromtype:"search"};this.request(r["a"].getNmvCardList,a).then((function(t){console.log(t),t.list.length>0&&(e.search_data=t.list)}))},handleSearchBlur:function(t){console.log("handleSearchBlur",t)},handleSearchFocus:function(){console.log("handleSearchFocus","====="),this.search_keyword="",this.search_data=[],this.expiration_time="",this.card_list=[],this.searched_arr={},this.post.card_no="",this.pay_momey=""},searchOptionChange:function(t,e){console.log("change_value",t),this.expiration_time=this.search_data[t].expiration_time,this.searched_arr=this.search_data[t],this.card_list=this.search_data[t].card_list,this.post.card_no="",this.pay_momey=""},calculationNmvCost:function(){if(this.post.card_no.length>0&&void 0!=this.searched_arr.pigcms_id&&this.searched_arr.pigcms_id>0&&1*this.post.rule_id>0){var t=1;this.post.cycle_num&&1*this.post.cycle_num>0&&(t=this.post.cycle_num);var e=0,a=1*this.post.rule_id;this.charge_rule.forEach((function(t,i){t.rule_id==a&&(e=1*t.price)}));var i=t*e;return this.pay_momey=i>0?i.toFixed(2):"",!0}return this.pay_momey="",!1},handleSubmit:function(){var t=this,e=this.calculationNmvCost();if(!e)return this.$message.error("支付数据错误，请重新操作！"),!1;var a=this.post;if(a.pigcms_id=this.searched_arr.pigcms_id,a.searched_arr=this.searched_arr,a.pay_momey=this.pay_momey,a.search_keyword=this.search_keyword,!(this.post.offline_pay_type&&1*this.post.offline_pay_type>0))return this.$message.error("请选一种线下支付方式！"),!1;this.loading=!0,this.request(r["a"].nmvPcOfflinePay,a).then((function(e){t.$message.success("支付成功!"),setTimeout((function(){t.form=t.$form.createForm(t),t.handleCancel(),t.$emit("ok")}),1500),t.loading=!1})).catch((function(e){t.loading=!1}))},handleCancel:function(){this.search_keyword="",this.search_data=[],this.expiration_time="",this.card_list=[],this.searched_arr={},this.post.card_no="",this.post.cycle_num=1,this.pay_momey="",this.offline_pay_type="",this.visible=!1}}},o=n,l=(a("e146"),a("0b56")),c=Object(l["a"])(o,i,s,!1,null,"433847f8",null);e["default"]=c.exports},"8efb":function(t,e,a){},e146:function(t,e,a){"use strict";a("37f0")}}]);