(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d7e4c15","chunk-3f139030"],{"0eca":function(e,t,a){},1733:function(e,t,a){"use strict";a("b92a")},1969:function(e,t,a){},"265e":function(e,t,a){},3438:function(e,t,a){"use strict";a("fde4")},"3c11":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"build_index"},[a("a-row"),a("div",{staticClass:"table-operations top-box-padding",staticStyle:{width:"40%"}},[a("a-steps",{staticStyle:{cursor:"pointer"},attrs:{size:"small",status:"process"}},[a("a-step",{attrs:{status:"finish",title:"导入楼栋"},on:{click:function(t){return e.uploadExcelFile()}}},[a("a-icon",{attrs:{slot:"icon",type:"cloud-upload"},slot:"icon"})],1),a("a-step",{attrs:{status:"finish",title:"导入单元"}},[a("a-icon",{attrs:{slot:"icon",type:"right"},slot:"icon"}),a("a-icon",{attrs:{slot:"icon",type:"cloud-upload"},slot:"icon"})],1),a("a-step",{attrs:{status:"finish",title:"导入楼层"}},[a("a-icon",{attrs:{slot:"icon",type:"right"},slot:"icon"}),a("a-icon",{attrs:{slot:"icon",type:"cloud-upload"},slot:"icon"})],1),a("a-step",{attrs:{status:"finish",title:"导入房间"}},[a("a-icon",{attrs:{slot:"icon",type:"right"},slot:"icon"}),a("a-icon",{attrs:{slot:"icon",type:"cloud-upload"},slot:"icon"})],1)],1)],1),a("a-table",{attrs:{columns:e.columns,"row-key":function(e){return e.id},"data-source":e.buildingList,pagination:!1,loading:e.loading},scopedSlots:e._u([{key:"status",fn:function(t,l){return[l.allowChangeStatus?a("a-switch",{attrs:{"checked-children":"开启","un-checked-children":"关闭",checked:1==t},on:{change:function(t){return e.switchChange(t,l)}}}):a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v(e._s(l.allowChangeStatusTip))])]),a("a-switch",{attrs:{disabled:!0,"checked-children":"开启","un-checked-children":"关闭",checked:1==t}})],2)]}},{key:"floorPath",fn:function(t,l){return[a("a",{on:{click:function(t){return e.showSingleView(l,1)}}},[e._v("管理")])]}},{key:"action",fn:function(t,l){return a("span",{},[l.allowEditHousekeeper?a("a",{on:{click:function(t){return e.editBuild(l,1)}}},[e._v("楼栋管家")]):e._e(),l.allowEdit?a("a-divider",{attrs:{type:"vertical"}}):e._e(),l.allowEdit?a("a",{on:{click:function(t){return e.editBuild(l,2)}}},[e._v("编辑")]):e._e(),l.allowDelete?a("a-divider",{attrs:{type:"vertical"}}):e._e(),l.allowDelete?a("a-popconfirm",{attrs:{title:"确定要删除该项吗?","ok-text":"是","cancel-text":"否"},on:{confirm:function(t){return e.delConfirm(l)},cancel:e.delCancel}},[a("a",{staticStyle:{color:"red"}},[e._v("删除")])]):e._e()],1)}}])}),a("div",{staticClass:"total_number"},[e._v(" 总楼栋数："),a("span",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(e.total))]),e._v("栋 ")]),a("building-edit",{attrs:{visible:e.buildVisible,single_id:e.single_id},on:{closeDrawer:e.closeDrawer}}),a("buildingHousekeeper",{attrs:{visible:e.manageVisible,single_id:e.single_id},on:{closeDrawer:e.closeDrawer}}),a("uploadModal",{attrs:{visible:e.uploadVisbile},on:{exit:e.closeUploadModal}}),a("singleView",{attrs:{visible:e.singleViewVisible,single_name:e.single_name,single_id:e.single_id},on:{closeSingleView:e.closeDrawer}})],1)},i=[],n=(a("4e82"),a("8bbf")),o=a.n(n),r=a("e18f"),s=a("8803"),u=a("f07f"),c=a("f4f3"),d=a("ed09"),p=a("3990"),m=Object(d["c"])({components:{buildingEdit:r["default"],buildingHousekeeper:s["default"],uploadModal:u["default"],singleView:c["default"]},setup:function(e,t){var a=Object(d["g"])([{title:"楼栋名称",dataIndex:"single_name"},{title:"楼栋编号",dataIndex:"single_number"},{title:"楼栋面积(m²)",dataIndex:"measure_area"},{title:"单元列表",dataIndex:"floorPath",scopedSlots:{customRender:"floorPath"}},{title:"合同开始时间",dataIndex:"contract_time_start"},{title:"合同结束时间",dataIndex:"contract_time_end"},{title:"排序",dataIndex:"sort",sorter:function(e,t){return e.sort-t.sort}},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}]),l=Object(d["h"])(3),i=Object(d["h"])(""),n=Object(d["h"])(""),r=Object(d["h"])(!1),s=Object(d["h"])(!1),u=Object(d["h"])(!1),c=Object(d["h"])([]),m=Object(d["h"])(!1),v=Object(d["h"])(!1),f=Object(d["h"])(0),g=function(){o.a.prototype.request(p["a"].buildingList,{}).then((function(e){c.value=e.building,f.value=e.count,m.value=e.allowImport,v.value=e.allowRoomImport,u.value=!1})).catch((function(e){u.value=!1}))},b=function(){},h=function(){},_=Object(d["h"])(!0),y=function(e,t){if(_.value){var a=e?1:0;x(t.id,a)}else o.a.prototype.$message.warn("请求频繁！")},x=function(e,t){_.value=!1,o.a.prototype.request(p["a"].updateBuildingStatus,{single_id:e,status:t}).then((function(e){_.value=!0,g(),o.a.prototype.$message.success("修改成功！")})).catch((function(e){g(),_.value=!0}))},w=function(e){o.a.prototype.request(p["a"].deleteBuilding,{single_id:e}).then((function(e){u.value=!0,g(),o.a.prototype.$message.success("删除成功！")})).catch((function(e){}))},k=function(e){w(e.id)},S=function(e,t){1==t&&(s.value=!0),2==t&&(r.value=!0),i.value=e.id},j=Object(d["h"])(!1),O=function(e){console.log("record===>",e),j.value=!0,i.value=e.id,n.value=e.single_name+" 可视化"},C=function(e){r.value=!1,s.value=!1,j.value=!1,i.value=0,e&&(u.value=!0,g(),Object(d["d"])())},F=Object(d["h"])(!1),B=function(){F.value=!0},M=function(){F.value=!1};return Object(d["f"])((function(){u.value=!0,g()})),{columns:a,buildingList:c,allowImport:m,allowRoomImport:v,loading:u,getBuildingList:g,total:f,delCancel:b,delConfirm:k,deleteBiuld:w,editBuild:S,buildVisible:r,single_id:i,single_name:n,closeDrawer:C,manageVisible:s,switchChange:y,changeSingleStatus:x,changeStatus:_,uploadExcelFile:B,uploadVisbile:F,closeUploadModal:M,singleViewVisible:j,showSingleView:O,onChangeSetp:h,currentSet:l}}}),v=m,f=(a("9393"),a("0c7c")),g=Object(f["a"])(v,l,i,!1,null,"5151e9f1",null);t["default"]=g.exports},8803:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-drawer",{attrs:{title:"楼栋管家",visible:e.visible,width:750,"body-style":{paddingBottom:"80px"}},on:{close:e.resetForm}},[a("a-form-model",{ref:"ruleForm",attrs:{model:e.buildForm,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-form-model-item",{attrs:{label:"绑定员工",prop:"yuangong",extra:"多选，不限制数量，绑定员工后，业主加好友时随机从其中选择"}},[a("a-select",{staticStyle:{width:"240px"},attrs:{mode:"multiple",placeholder:"请选择员工",value:e.selectedItems},on:{change:function(t){return e.handleSelectChange(t,"yuangong")}}},e._l(e.filteredOptions,(function(t,l){return a("a-select-option",{attrs:{value:t.name,index:l}},[e._v(" "+e._s(t.name))])})),1)],1),a("a-form-model-item",{attrs:{label:"绑定楼栋",prop:"is_kefu",extra:"选择“是”选项，添加客服时只能选择楼栋下的业主；选择“否”选项，添加客服时能选择楼栋所有的业主"}},[a("a-radio-group",{attrs:{name:"radioGroup"},model:{value:e.buildForm.is_kefu,callback:function(t){e.$set(e.buildForm,"is_kefu",t)},expression:"buildForm.is_kefu"}},[a("a-radio",{attrs:{value:1}},[e._v("是")]),a("a-radio",{attrs:{value:0}},[e._v("否")])],1)],1),a("a-form-model-item",{attrs:{label:"欢迎语",prop:"welcome_tip",extra:"变量填写规则（可对应复制到填写内容）：{姓名} {手机号}"}},[a("a-textarea",{staticStyle:{padding:"5px width:200px",height:"100px",resize:"none"},attrs:{placeholder:"请输入欢迎语"},model:{value:e.buildForm.welcome_tip,callback:function(t){e.$set(e.buildForm,"welcome_tip",t)},expression:"buildForm.welcome_tip"}})],1),a("a-form-model-item",{attrs:{label:"企业微信服务群二维码"}},[a("a-upload",{attrs:{name:"reply_pic",multiple:!1,action:e.uploadUrl,data:e.uploadParams,"before-upload":e.beforeUpload,showUploadList:!1,headers:e.headers},on:{change:function(t){return e.handleUploadChange(t,"qycode")}}},[a("a-button",{attrs:{loading:e.qyimgLoading}},[e._v("上传二维码")]),e.ercodeUrl?a("a-button",{attrs:{type:"link"},on:{click:function(t){return t.stopPropagation(),e.lookCode()}}},[e._v("查看二维码")]):e._e(),a("a-button",{attrs:{type:"link"},on:{click:function(t){return t.stopPropagation(),e.lookHelp.apply(null,arguments)}}},[e._v("点击可查看使用帮助")])],1)],1),a("a-form-model-item",{attrs:{label:"装修",prop:"zhuangxiu"}},[a("template",{slot:"extra"},[e._v(" 1、无需装修：将直接使用二维码自带的模板样式"),a("br"),e._v(" 2、系统默认模板：将直接使用我们提供的模板样式，可选择查看样式"),a("br"),e._v(" 3、上传模板：需要自行设计好模板后上传，尺寸：750*1334；注意：模板左下角需距离页面边缘间距20像素预留100*100像素的空白位置，用于放置群二维码 ")]),a("a-select",{staticStyle:{width:"240px"},attrs:{placeholder:"请选择装修",value:e.buildForm.template_type},on:{change:function(t){return e.handleSelectChange(t,"zhuangxiu")}}},e._l(e.repaireList,(function(t,l){return a("a-select-option",{attrs:{value:t.id,index:l}},[e._v(e._s(t.name))])})),1)],2),2==e.buildForm.template_type?a("a-form-model-item",{attrs:{label:"上传模板",prop:"template_url",extra:"尺寸：750*1334；注意：模板左下角需距离页面边缘间距20像素预留100*100像素的空白位置，用于放置群二维码"}},[a("a-upload",{attrs:{name:"reply_pic",multiple:!1,action:e.uploadUrl,data:e.uploadParams,"before-upload":e.beforeUpload,showUploadList:!1,headers:e.headers},on:{change:function(t){return e.handleUploadChange(t,"template")}}},[a("a-button",{attrs:{loading:e.temimgLoading}},[e._v("上传模板")]),e.imageUrl?a("a-button",{attrs:{type:"link"},on:{click:function(t){return t.stopPropagation(),e.previewImage()}}},[e._v("查看图片")]):e._e()],1)],1):e._e()],1),a("a-modal",{attrs:{title:"查看二维码",width:350,visible:e.erCodeVisible,footer:null},on:{cancel:e.handleCodeCancel}},[a("div",{staticStyle:{width:"100%",display:"flex","justify-content":"center","align-items":"center"}},[a("img",{staticStyle:{width:"150px"},attrs:{preview:"1",src:e.ercodeUrl}})])]),a("a-modal",{attrs:{title:"预览图片",width:350,visible:e.previewVisible,footer:null},on:{cancel:e.handlePreviewCancel}},[a("div",{staticStyle:{width:"100%",display:"flex","justify-content":"center","align-items":"center"}},[a("img",{staticStyle:{width:"150px"},attrs:{preview:"2",src:e.imageUrl}})])]),a("div",{style:{position:"absolute",bottom:0,width:"100%",borderTop:"1px solid #e8e8e8",padding:"10px 16px",textAlign:"right",left:0,background:"#fff",borderRadius:"0 0 4px 4px"}},[a("a-button",{staticStyle:{marginRight:"8px"},on:{click:e.resetForm}},[e._v(" 关闭 ")]),a("a-button",{attrs:{loading:e.confirmLoading,type:"primary"},on:{click:e.onSubmit}},[e._v(" 保存 ")])],1)],1)},i=[],n=(a("a9e3"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("d81d"),a("b0c0"),a("ac1f"),a("1276"),a("8bbf")),o=a.n(n),r=a("ed09"),s=a("3990"),u=Object(r["c"])({props:{visible:{type:Boolean,default:!1},single_id:{type:[String,Number],default:0}},setup:function(e,t){var a=function(){n.value=!1},l=function(){n.value=!0},i=Object(r["h"])(""),n=Object(r["h"])(!1),u=Object(r["h"])(""),c=Object(r["g"])({authorization:"authorization-text"}),d=Object(r["h"])("/v20/public/index.php/common/common.UploadFile/uploadImg"),p=Object(r["g"])({upload_dir:"village"}),m=Object(r["h"])(!1),v=function(){m.value=!1},f=Object(r["h"])(""),g=Object(r["h"])(!1),b=Object(r["h"])(!1),h=function(e,t){if("uploading"!==e.file.status)return"error"===e.file.status?(o.a.prototype.$message.error("上传失败!"),void("qycode"==t?g.value=!0:b.value=!0)):void("done"===e.file.status&&("qycode"==t?(i.value=e.file.response.data.full_url,C.value.qy_qrcode=e.file.response.data.image,g.value=!1):(f.value=e.file.response.data.full_url,C.value.template_url=e.file.response.data.image,b.value=!1)));"qycode"==t?g.value=!0:b.value=!0},_=function(e,t){var a="image/jpeg"===e.type||"image/png"===e.type;a||o.a.prototype.$message.error("You can only upload JPG file!");var l=e.size/1024/1024<2;return l||o.a.prototype.$message.error("Image must smaller than 2MB!"),a&&l},y=function(e){m.value=!0},x=Object(r["h"])([]),w=Object(r["h"])([]),k=Object(r["a"])({get:function(){return x.value.filter((function(e){return!w.value.includes(e)}))}}),S=Object(r["h"])([{name:"无需装修",id:0},{name:"系统默认模板",id:1},{name:"上传模板",id:2}]),j=function(){window.open(u.value)},O=Object(r["h"])(!1),C=Object(r["h"])({}),F=Object(r["g"])({is_kefu:[{required:!0,message:"请选择是否绑定楼栋",trigger:"blur"}],welcome_tip:[{required:!0,message:"请输入欢迎语",trigger:"blur"}]}),B=Object(r["h"])(),M=Object(r["h"])({span:6}),I=Object(r["h"])({span:16}),q=function(){B.value.validate((function(e){if(e){if(0==w.length)return void o.a.prototype.$message.warn("请选择绑定员工！");E()}}))},L=function(){t.emit("closeDrawer"),C.value={},f.value="",i.value="",B.value.resetFields()},E=function(){O.value=!0,o.a.prototype.request(s["a"].saveBuildingButler,C.value).then((function(e){O.value=!1,L(),o.a.prototype.$message.success("保存成功！")})).catch((function(e){O.value=!1}))},D=function(e){o.a.prototype.request(s["a"].getBuildingButler,{single_id:e}).then((function(e){e.buldingButler&&(C.value=e.buldingButler,x.value=e.buldingButlerList,w.value=e.buldingButlerBindList.map((function(e){return e.name})),i.value=e.buldingButler.qy_qrcode,C.value.template_url=e.buldingButler.template_url,f.value=e.buldingButler.template_url,C.value.work_arr=e.buldingButler.work_arr.split(",")),u.value=e.qyhelp_url}))},$=function(e,t){if("yuangong"==t){w.value=e;var a=[];x.value.map((function(t){e.map((function(e){e==t.name&&a.push(t.wid)}))})),C.value.work_arr=a}"zhuangxiu"==t&&(C.value.template_type=e)};return Object(r["i"])((function(){return e.visible}),(function(t){t&&D(e.single_id)}),{deep:!0}),{confirmLoading:O,onSubmit:q,resetForm:L,buildForm:C,labelCol:M,wrapperCol:I,rules:F,saveForm:E,ruleForm:B,userList:x,repaireList:S,handleSelectChange:$,filteredOptions:k,selectedItems:w,lookHelp:j,lookCode:l,handleCodeCancel:a,ercodeUrl:i,erCodeVisible:n,getBuildInfo:D,qyhelpUrl:u,headers:c,uploadUrl:d,uploadParams:p,imageUrl:f,qyimgLoading:g,temimgLoading:b,beforeUpload:_,handleUploadChange:h,previewImage:y,previewVisible:m,handlePreviewCancel:v}}}),c=u,d=(a("3438"),a("0c7c")),p=Object(d["a"])(c,l,i,!1,null,"3468d95a",null);t["default"]=p.exports},9393:function(e,t,a){"use strict";a("0eca")},b92a:function(e,t,a){},b976:function(e,t,a){"use strict";a("265e")},cc33:function(e,t,a){"use strict";a("1969")},e18f:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-drawer",{attrs:{title:"楼栋编辑",visible:e.visible,width:1200,"body-style":{paddingBottom:"80px"}},on:{close:function(t){return e.resetForm(!1)}}},[a("a-form-model",{ref:"ruleForm",attrs:{model:e.buildForm,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("div",{staticStyle:{display:"flex"}},[a("a-card",{staticStyle:{width:"600px"},attrs:{title:"基本信息"}},[a("a-form-model-item",{attrs:{label:"楼栋名称",prop:"single_name"}},[a("a-input",{staticClass:"input_style_240",model:{value:e.buildForm.single_name,callback:function(t){e.$set(e.buildForm,"single_name",t)},expression:"buildForm.single_name"}})],1),a("a-form-model-item",{attrs:{label:"楼栋编号",prop:"single_number"}},[a("a-input-number",{staticClass:"input_style_240",attrs:{max:99,min:1},model:{value:e.buildForm.single_number,callback:function(t){e.$set(e.buildForm,"single_number",t)},expression:"buildForm.single_number"}})],1),a("a-form-model-item",{attrs:{label:"楼栋地址",prop:"long_lat"}},[a("a-input",{staticStyle:{width:"200px"},attrs:{disabled:!0},model:{value:e.buildForm.long_lat,callback:function(t){e.$set(e.buildForm,"long_lat",t)},expression:"buildForm.long_lat"}}),a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(t){return e.openMap()}}},[e._v("点击获取经纬度")])],1),a("a-form-model-item",{attrs:{label:"合同时间",extra:"设置楼栋时间范围，设置后物业只能收取合同时间内收费项目，未到合同开始时间或结束时间不能收费；未设置物业服务小区时间范围，则不影响。"}},[e.startTime&&e.dateFormat?a("a-range-picker",{attrs:{disabledDate:e.disabledDate,value:[e.moment(e.startTime,e.dateFormat),e.moment(e.endTime,e.dateFormat)]},on:{change:e.onDateChange}}):a("a-range-picker",{attrs:{disabledDate:e.disabledDate},on:{change:e.onDateChange}})],1),a("a-form-model-item",{attrs:{label:"排序",prop:"sort"}},[a("a-input-number",{staticClass:"input_style_240",attrs:{min:0},model:{value:e.buildForm.sort,callback:function(t){e.$set(e.buildForm,"sort",t)},expression:"buildForm.sort"}})],1),a("a-form-model-item",{attrs:{label:"状态",prop:"status"}},[a("a-switch",{attrs:{"checked-children":"开启","un-checked-children":"关闭","default-checked":""},model:{value:e.statusBool,callback:function(t){e.statusBool=t},expression:"statusBool"}})],1)],1),a("a-card",{staticStyle:{width:"600px"},attrs:{title:"楼栋资料"}},[a("a-form-model-item",{attrs:{label:"楼栋面积(m²)",prop:"measure_area"}},[a("a-input",{staticClass:"input_style_240",model:{value:e.buildForm.measure_area,callback:function(t){e.$set(e.buildForm,"measure_area",t)},expression:"buildForm.measure_area"}})],1),a("a-form-model-item",{attrs:{label:"所含单元数",prop:"floor_num"}},[a("a-input-number",{staticClass:"input_style_240",model:{value:e.buildForm.floor_num,callback:function(t){e.$set(e.buildForm,"floor_num",t)},expression:"buildForm.floor_num"}})],1),a("a-form-model-item",{attrs:{label:"所含房屋数",prop:"vacancy_num"}},[a("a-input-number",{staticClass:"input_style_240",model:{value:e.buildForm.vacancy_num,callback:function(t){e.$set(e.buildForm,"vacancy_num",t)},expression:"buildForm.vacancy_num"}})],1),a("a-form-model-item",{attrs:{label:"地面建筑层数",prop:"upper_layer_num"}},[a("a-input-number",{staticClass:"input_style_240",model:{value:e.buildForm.upper_layer_num,callback:function(t){e.$set(e.buildForm,"upper_layer_num",t)},expression:"buildForm.upper_layer_num"}})],1),a("a-form-model-item",{attrs:{label:"地下建筑层数",prop:"lower_layer_num"}},[a("a-input-number",{staticClass:"input_style_240",model:{value:e.buildForm.lower_layer_num,callback:function(t){e.$set(e.buildForm,"lower_layer_num",t)},expression:"buildForm.lower_layer_num"}})],1)],1)],1)]),a("div",{style:{position:"absolute",bottom:0,width:"100%",borderTop:"1px solid #e8e8e8",padding:"10px 16px",textAlign:"right",left:0,background:"#fff",borderRadius:"0 0 4px 4px"}},[a("a-button",{staticStyle:{marginRight:"8px"},on:{click:function(t){return e.resetForm(!1)}}},[e._v(" 关闭 ")]),a("a-button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.onSubmit}},[e._v(" 保存 ")])],1),e.mapVisible?a("a-modal",{attrs:{title:"百度地图拾取经纬度",visible:e.mapVisible,width:800},on:{ok:e.handleMapOk,cancel:e.handleMapCancel}},[a("a-input",{staticClass:"input_style",staticStyle:{width:"200px"},attrs:{type:"text",id:"suggestId",name:"address_detail",placeholder:"请输入城市名/地区名"},model:{value:e.address_detail,callback:function(t){e.address_detail=t},expression:"address_detail"}}),a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.searchMap}},[e._v("搜索")]),a("div",{staticStyle:{width:"100%",height:"500px","margin-top":"10px"},attrs:{id:"allmap"}})],1):e._e()],1)},i=[],n=(a("a9e3"),a("4e82"),a("8bbf")),o=a.n(n),r=a("c1df"),s=a.n(r),u=a("ed09"),c=a("3990"),d=Object(u["c"])({props:{visible:{type:Boolean,default:!1},single_id:{type:[String,Number],default:0}},setup:function(e,t){var a=function(e){var t=e.getFullYear(),a=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,l=e.getDate()<10?"0"+e.getDate():e.getDate(),i=t+"-"+a+"-"+l;return i},l=function(e){return e&&!(e>s()(v.value.village_contract_time_start)&&e<s()(v.value.village_contract_time_end))},i=Object(u["h"])(!1),n=Object(u["h"])(""),r=Object(u["h"])(""),d=Object(u["h"])("YYYY/MM/DD"),p=Object(u["h"])(!1),m=Object(u["h"])(!1),v=Object(u["h"])({}),f=Object(u["h"])({single_name:[{required:!0,message:"请输入楼栋名称",trigger:"blur"}],single_number:[{required:!0,message:"请输入楼栋编号",trigger:"blur"}],long_lat:[{required:!0,message:"请选择楼栋地址",trigger:"blur"}],contract_time:[{required:!0,message:"请选择合同时间",trigger:"blur"}],sort:[{required:!0,message:"请输入排序",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}],measure_area:[{required:!0,message:"请输入楼栋面积",trigger:"blur"}],floor_num:[{required:!0,message:"请输入所含单元数",trigger:"blur"}],vacancy_num:[{required:!0,message:"请输入所含房屋数",trigger:"blur"}],upper_layer_num:[{required:!0,message:"请输入地面建筑层数",trigger:"blur"}],lower_layer_num:[{required:!0,message:"请输入地下建筑层数",trigger:"blur"}]}),g=Object(u["h"])(),b=Object(u["h"])({span:6}),h=Object(u["h"])({span:16}),_=function(e){if(e[0]&&e[1])return n.value=e[0].format("YYYY-MM-DD"),r.value=e[1].format("YYYY-MM-DD"),v.value.contract_time_start=e[0].format("YYYY-MM-DD"),void(v.value.contract_time_end=e[1].format("YYYY-MM-DD"));n.value="",r.value="",v.value.contract_time_start="",v.value.contract_time_end=""},y=function(){g.value.validate((function(e){if(e){if(v.value.single_id=v.value.id,!v.value.contract_time_start||!v.value.contract_time_end)return void o.a.prototype.$message.warn("请选择合同时间");v.value.status=i.value?1:0,console.log("buildForm.value===>",v.value),m.value=!0,w()}}))},x=function(e){t.emit("closeDrawer",e),v.value={},g.value.resetFields()},w=function(){o.a.prototype.request(c["a"].updateBuildingInfoByID,v.value).then((function(e){m.value=!1,o.a.prototype.$message.success("编辑成功！"),x(!0)})).catch((function(e){m.value=!1}))},k=Object(u["h"])(!1),S=Object(u["h"])(""),j=Object(u["h"])(""),O=Object(u["h"])(""),C=function(){v.value.long_lat=j.value+","+S.value,v.value.long=j.value,v.value.lat=S.value,k.value=!1,p.value=!1},F=function(){k.value=!1,p.value=!1},B=function(){k.value=!0,I()},M=function(){O.value&&(p.value=!0,I())},I=function(){Object(u["e"])((function(){var e,t=new BMap.Map("allmap");if(v.value.lat&&v.value.long&&!p.value){t.clearOverlays(),e=new BMap.Point(v.value.long,v.value.lat);new BMap.Size(0,15);t.addOverlay(new BMap.Marker(e))}else e=O.value;t.centerAndZoom(e,15),t.enableScrollWheelZoom(),t.addEventListener("click",(function(e){t.clearOverlays(),t.addOverlay(new BMap.Marker(e.point)),j.value=e.point.lng,S.value=e.point.lat,console.log(e.point),(new BMap.Geocoder).getLocation(e.point,(function(e){O.value=e.address}))}))}))},q=function(e){o.a.prototype.request(c["a"].buildingInfo,{single_id:e}).then((function(e){v.value=e,v.value.sort=e.sort||0,v.value.long_lat=e.long+","+e.lat;var t=new BMap.Point(Number(e.long),Number(e.lat));(new BMap.Geocoder).getLocation(t,(function(e){O.value=e.address})),i.value=1==e.status,n.value=e.contract_time_start,r.value=e.contract_time_end}))};return Object(u["i"])((function(){return e.visible}),(function(t){t&&q(e.single_id)}),{deep:!0}),{confirmLoading:m,onSubmit:y,resetForm:x,buildForm:v,labelCol:b,wrapperCol:h,rules:f,saveForm:w,openMap:B,mapVisible:k,userLat:S,userLng:j,address_detail:O,handleMapOk:C,searchMap:M,initMap:I,handleMapCancel:F,onDateChange:_,ruleForm:g,searchArea:p,dateFormat:d,formDate:a,startTime:n,endTime:r,moment:s.a,statusBool:i,disabledDate:l}}}),p=d,m=(a("1733"),a("0c7c")),v=Object(m["a"])(p,l,i,!1,null,"571c5513",null);t["default"]=v.exports},f07f:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"楼栋导入向导",width:1e3,visible:e.visible,maskClosable:!1,footer:e.isImporting?null:void 0},on:{cancel:e.handleCancel}},[a("a-tabs",{attrs:{"default-active-key":1}},[a("a-tab-pane",{key:1,attrs:{tab:"导入操作"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.firstStep&&!e.isImporting,expression:"firstStep && !isImporting"}],staticClass:"step_one"},[a("h4",[e._v("步骤一：上传 Excel 文件")]),a("p",[e._v("您要从何处导入数据，请选择导入的 Excel 文件")]),a("div",{staticStyle:{display:"flex",width:"80%"}},[a("div",{staticClass:"label",staticStyle:{width:"82px","text-align":"left"}},[e._v("Excel文件")]),a("a-upload-dragger",{staticStyle:{height:"100px",width:"calc(100% - 82px)","margin-left":"10px"},attrs:{name:"file",multiple:!0,action:e.uploadUrl,beforeUpload:e.beforeUploadExcel,showUploadList:!1,headers:e.headers,data:{upload_dir:"building",system_type:"village",type:"building"}},on:{change:e.handleUploadChange}},[a("a-icon",{attrs:{type:e.uploadLoading?"loading":"upload"}}),e._v(" 拖拽或点击上传 Excel 文件 ")],1)],1),e.fileList.length>0?a("div",{staticClass:"select_list",staticStyle:{display:"flex","align-items":"center",height:"50px"}},[a("div",{staticClass:"label",staticStyle:{width:"82px","text-align":"left"}},[e._v("选择Sheet表")]),a("a-select",{staticStyle:{width:"120px","margin-left":"10px"},attrs:{"default-value":0},on:{change:e.handleSelectChange}},e._l(e.fileList,(function(t,l){return a("a-select-option",{key:l,attrs:{value:l}},[e._v(" "+e._s(t.worksheetName)+" ")])})),1),a("div",{staticStyle:{color:"red","margin-left":"10px"}},[e._v("总数据量："+e._s(e.selectObj.totalRows?e.selectObj.totalRows-1:0)+" 条")])],1):e._e(),e.fileList.length>0?a("div",{staticClass:"select_list",staticStyle:{display:"flex","align-items":"center",height:"50px"}},[a("div",{staticClass:"label",staticStyle:{width:"90px","text-align":"left"}},[e._v("数据重复时")]),a("a-radio-group",{attrs:{name:"radioGroup"},model:{value:e.isSkip,callback:function(t){e.isSkip=t},expression:"isSkip"}},[a("a-radio",{attrs:{value:0}},[e._v("跳过")]),a("a-radio",{attrs:{value:1}},[e._v("覆盖")])],1),1==e.isSkip?a("div",{staticStyle:{"margin-left":"10px",display:"flex","align-items":"center"}},[a("div",[e._v("当")]),a("a-select",{staticStyle:{width:"120px",margin:"0 10px"},attrs:{value:e.selectreplaceFie},on:{change:e.handleReplaceChange}},e._l(e.replaceFieldSelect,(function(t,l){return a("a-select-option",{key:l,attrs:{value:t.option}},[e._v(e._s(t.title))])})),1),a("div",[e._v("重复时，覆盖现有客户数据")])],1):e._e()],1):e._e(),a("h5",[e._v("导入步骤：")]),a("p",[e._v(" 第一步：上传存储有楼栋的资料 Excel 文件；【您可以直接上传 Excel 文件或者下载模板："),a("a-button",{attrs:{type:"link"},on:{click:e.downloadExcel}},[e._v(" 模板下载")]),e._v("】 ")],1),a("p",[e._v(" 第二步：设置 Excel 里的列与系统中的列的对应关系")]),a("p",[e._v(" 第三步：开始导入")]),a("a-alert",{attrs:{message:"全新的楼栋导入功能，无需任何模板，系统自动匹配关系，数据内容直接导入，使用更加方便、快捷、智能",type:"info"}})],1),e.firstStep||e.isImporting?e._e():a("div",{staticClass:"step_two"},[a("div",{staticClass:"top_desc",staticStyle:{display:"flex","align-items":"center",height:"30px"}},[a("h4",[e._v("步骤二：【企业客户创建对应关系】建立系统列与Excel列的对应关系")]),a("p",{staticStyle:{"margin-left":"10px","margin-top":"7px"}},[e._v("建立系统列与Excel列的对应关系")])]),a("div",{staticClass:"line",staticStyle:{width:"100%",height:"1px",border:"0","background-color":"#999999",margin:"10px 0"}}),a("div",{staticClass:"list"},[a("div",{staticClass:"title"},[a("span",[e._v("楼层信息")]),a("span",{staticStyle:{"margin-left":"10px",color:"red"}},[e._v("*号为必填项")])]),a("div",{staticClass:"top_label",staticStyle:{width:"100%",height:"30px",display:"flex","justify-content":"space-between margin-top: 10px"}},[a("div",{staticClass:"left_label",staticStyle:{width:"50%",display:"flex","background-color":"#dddddd",border:"1px solid #999999"}},e._l(e.labelList,(function(t,l){return a("div",{key:l,staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"center"}},[e._v(e._s(t.name))])})),0),a("div",{staticClass:"right_label",staticStyle:{width:"50%",display:"flex","background-color":"#dddddd",border:"1px solid #999999"}},e._l(e.labelList,(function(t,l){return a("div",{key:l,staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"center"}},[e._v(e._s(t.name))])})),0)]),a("div",{staticClass:"select_con",staticStyle:{width:"100%",display:"flex","flex-wrap":"wrap"}},e._l(e.sourceMapFields,(function(t,l){return a("div",{key:l,staticClass:"select_list",staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"space-around"}},[a("div",{staticClass:"left_label",staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"center"}},[e._v(e._s(t.key)),t.val.isMust?a("span",{staticStyle:{color:"red","margin-left":"5px"}},[e._v("*")]):e._e(),e._v("：")]),a("div",{staticClass:"right_select",staticStyle:{width:"50%",display:"flex","align-items":"center","justify-content":"center"}},[e.refreshSelect?a("a-select",{staticStyle:{width:"200px","margin-left":"10px","margin-top":"10px"},attrs:{"default-value":t.selected?t.key:""},on:{change:function(a){return e.handleExcelChange(a,t.val.field)}}},e._l(e.excelCloumns,(function(t,l){return a("a-select-option",{key:l,staticStyle:{height:"32px"},attrs:{value:t.key}},[e._v(" "+e._s(t.val)+" ")])})),1):e._e()],1)])})),0)])])]),a("a-tab-pane",{key:2,attrs:{tab:"导入日志"}},[e._v(" 导入日志 ")])],1),e.isImporting?e._e():a("template",{slot:"footer"},[a("div",{staticClass:"footer_con",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},[e.firstStep?a("div",{staticClass:"left"}):e._e(),e.firstStep?e._e():a("div",{staticClass:"left"},[e._v(" 请注意系统列与Excel列的类型要匹配 ")]),a("div",{staticClass:"right"},[e.firstStep?e._e():a("a-button",{attrs:{type:"default"},on:{click:e.preStep}},[e._v("上一步")]),e.firstStep?a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.nextStep}},[e._v("下一步")]):e._e(),e.firstStep?e._e():a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.startImport}},[e._v("开始导入")]),a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"default"},on:{click:e.handleCancel}},[e._v("取消")])],1)])]),e.isImporting?a("div",{staticClass:"progress_content",staticStyle:{width:"100%",height:"450px",display:"flex","align-items":"center","justify-content":"center","flex-direction":"column"}},[a("a-progress",{attrs:{type:"circle","stroke-color":{"0%":"#108ee9","100%":"#87d068"},percent:e.percentVal}}),a("div",{staticClass:"importing",staticStyle:{"margin-top":"15px"}},[e._v(" 正在导入，剩余"+e._s(100-e.percentVal)+"条记录待导入，成功"),a("span",{staticStyle:{color:"#68C472"}},[e._v(e._s(e.percentVal))]),e._v("条。。。 ")]),a("div",{staticClass:"desc",staticStyle:{"margin-top":"15px",color:"#999999","font-size":"14px"}},[e._v(" 正在等待导入，你可以关闭本窗口，稍后再来查看 ")])],1):e._e()],2)},i=[],n=(a("a9e3"),a("ac1f"),a("1276"),a("b0c0"),a("d81d"),a("a434"),a("4de4"),a("d3b7"),a("8bbf")),o=a.n(n),r=(a("5880"),a("ca00")),s=a("ed09"),u=(a("3990"),Object(s["c"])({props:{visible:{type:Boolean,default:!1},upload_type:{type:[String,Number],default:0}},setup:function(e,t){var a=Object(s["h"])(0),l=Object(s["h"])(""),i=Object(s["h"])(null),n=Object(s["h"])(!1),u=Object(s["h"])(0),c=[{name:"系统列"},{name:"Excel列"}],d=Object(s["h"])("/v20/public/index.php/community/village_api.Building/villageUploadFile"),p=Object(s["h"])([]),m=Object(s["h"])(!1),v=Object(s["h"])(!0),f=Object(s["h"])(!1),g=function(e){var t=e.name.split(".").pop();if("xlsx"!=t&&"xls"!=t)return m.value=!1,o.a.prototype.$message.warn("上传文件格式非Excel"),!1},b=function(){Y(),t.emit("exit",!1)},h=function(){v.value=!0},_=Object(s["h"])([]),y=function(e,t){if("root"!=e){var a=!0;_.value.map((function(l,i){l.key==t&&(l.value=e,a=!1)})),a&&_.value.push({key:t,value:e})}else _.value.map((function(e,a){e.key==t&&_.value.splice(a,1)}))},x=function(){M.totalRows&&0==M.totalRows?o.a.prototype.$message.warn("请完善上传信息"):F.value&&C.value?(v.value=!1,E()):o.a.prototype.$message.warn("请先上传Excel文件")},w=function(e){l.value=e,Object(s["d"])()},k=function(){var e=L.value.filter((function(e){return e.val.isMust})).length,t=0;L.value.map((function(e){_.value.map((function(a){e.val.isMust&&a.key==e.val.field&&t++}))})),t==e?o.a.prototype.request("/community/village_api.Building/startImport ",{relationship:_.value,inputFileName:C.value,worksheetName:F.value,isRepeated:a.value,replaceField:l.value}).then((function(e){o.a.prototype.$message.success("提交成功，准备导入，调整画面为进度条画面！"),n.value=!0,i.value=setInterval((function(){V()}),1e3)})).catch((function(e){n.value=!1,Y()})):o.a.prototype.$message.warn("有必填项未选")},S=Object(r["k"])("/community/village_api.Building/villageUploadFile"),j=o.a.ls.get(S),O=Object(s["g"])({authorization:"authorization-text",ticket:j}),C=Object(s["h"])(""),F=Object(s["h"])(""),B=function(e){m.value=!0,"uploading"!==e.file.status&&(m.value=!0),"done"===e.file.status?(C.value=e.file.response.data,m.value=!1,1e3==e.file.response.status?$(C.value):o.a.prototype.$message.error(e.file.response.msg)):"error"===e.file.status&&(m.value=!1,o.a.prototype.$message.error("".concat(e.file.name," file upload failed.")))},M=Object(s["h"])({}),I=function(e){M.value=p.value[e],F.value=p.value[e].worksheetName,Object(s["d"])()},q=Object(s["h"])([]),L=Object(s["h"])([]),E=function(){o.a.prototype.request("/community/village_api.Building/startBindExcelCol",{inputFileName:C.value,worksheetName:F.value}).then((function(e){q.value=e.excelCloumns,q.value.unshift({key:"root",val:""}),L.value=e.sourceMapFields,_.value=[],e.sourceMapFields.map((function(t){if(t.selected){var a=e.excelCloumns.filter((function(e){return e.val==t.key}))[0].key;_.value.push({key:t.val.field,value:a})}})),f.value=!1,Object(s["e"])((function(){f.value=!0})),Object(s["d"])()})).catch((function(e){}))},D=Object(s["h"])([]),$=function(e){o.a.prototype.request("/community/village_api.Building/importForExcel",{inputFileName:e}).then((function(e){p.value=e.worksheet,M.value=e.worksheet[0],F.value=e.worksheet[0].worksheetName,D.value=e.replaceFieldSelect,l.value=e.replaceFieldSelect[0].option,console.log("===>",D.value,l.value),Object(s["d"])()})).catch((function(e){}))},U=Object(s["h"])(0),V=function(){o.a.prototype.request("/community/village_api.Building/refreshProcess",{type:"building"}).then((function(e){U.value=e.process})).catch((function(e){Y()}))},Y=function(){n.value=!1,clearInterval(i.value),i.value=null},P=function(){};return Object(s["i"])((function(){return e.visible}),(function(e){}),{deep:!0}),{handleCancel:b,headers:O,handleUploadChange:B,currentIndex:u,uploadUrl:d,uploadExcelFile:$,downloadExcel:P,fileList:p,uploadLoading:m,selectObj:M,handleSelectChange:I,nextStep:x,firstStep:v,preStep:h,startImport:k,labelList:c,getSelectList:E,pathUrl:C,excelCloumns:q,sourceMapFields:L,handleExcelChange:y,relationship:_,beforeUploadExcel:g,refreshSelect:f,interval:i,refreshProgress:V,isImporting:n,percentVal:U,clearTimer:Y,replaceFieldSelect:D,selectreplaceFie:l,isSkip:a,handleReplaceChange:w}}})),c=u,d=(a("cc33"),a("0c7c")),p=Object(d["a"])(c,l,i,!1,null,"451d4622",null);t["default"]=p.exports},f4f3:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-drawer",{attrs:{title:e.single_name,width:"1700",closable:!1,visible:e.visible},on:{close:e.onClose}},[a("singleVisualization",{attrs:{singleId:e.singleId}})],1)},i=[],n=(a("a9e3"),a("8bbf"),a("ed09")),o=a("7759"),r=(a("3990"),Object(n["c"])({components:{singleVisualization:o["default"]},props:{single_id:{type:[String,Number],default:0},single_name:{type:String,default:"楼栋可视化"},visible:{type:Boolean,default:!1}},setup:function(e,t){var a=function(){t.emit("closeSingleView")},l=Object(n["h"])(0);return Object(n["i"])((function(){return e.visible}),(function(t){t&&(l.value=e.single_id,console.log("single_id===>",e.single_id),console.log("single_name===>",e.single_name))}),{deep:!0}),Object(n["f"])((function(){})),{onClose:a,singleId:l}}})),s=r,u=(a("b976"),a("0c7c")),c=Object(u["a"])(s,l,i,!1,null,"5e7e088a",null);t["default"]=c.exports},fde4:function(e,t,a){}}]);