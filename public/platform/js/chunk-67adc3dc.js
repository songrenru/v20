(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67adc3dc","chunk-1a2173e5","chunk-2d0b3786","chunk-2d0d6b05"],{"1d03":function(t,e,a){"use strict";a.r(e);var i,o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pt-20 pl-20 pr-20 pb-20 br-10"},[a("a-spin",{attrs:{spinning:t.confirmLoading}},[a("a-card",{attrs:{bordered:!1}},[a("a-form-model",{ref:"ruleForm",attrs:{model:t.formData,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[a("a-form-model-item",{attrs:{label:t.toolsNameType,colon:!1}},[t._v(" "+t._s(t.toolsName)+" ")]),a("a-form-model-item",{attrs:{label:"门票名称",colon:!1,prop:"title",rules:[{required:!0,message:"门票名称不能为空",trigger:["blur"]}]}},[a("a-input",{staticStyle:{width:"300px"},attrs:{disabled:t.disabled,maxLength:100,placeholder:"请输入门票名称"},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),"scenic"==t.type?a("a-form-model-item",{attrs:{label:"门票类型",colon:!1,placeholder:"请选择",prop:"scenic_ticket_type"}},[a("a-select",{staticStyle:{width:"300px"},attrs:{disabled:t.disabled,options:t.scenicTicketTypeOptions},model:{value:t.formData.scenic_ticket_type,callback:function(e){t.$set(t.formData,"scenic_ticket_type",e)},expression:"formData.scenic_ticket_type"}})],1):t._e(),t.type&&"scenic"!=t.type?a("a-form-model-item",{staticStyle:{"font-size":"18px"},attrs:{label:"是否为多规格",prop:"is_sku"}},[a("a-radio-group",{attrs:{disabled:t.has_bind_sports,options:t.plainOptions},on:{change:t.onChangeSwitch},model:{value:t.formData.is_sku,callback:function(e){t.$set(t.formData,"is_sku",e)},expression:"formData.is_sku"}}),t.has_bind_sports?a("span",{staticStyle:{"font-size":"12px",color:"red"}},[t._v("正在参与“体育秒杀”或“体育约战”，需要关闭体育秒杀与体育约战才能开启多规格。")]):t._e()],1):t._e(),t.disabledBtn?[a("a-form-model-item",{attrs:{label:"原价",colon:!1,wrapperCol:{span:6},prop:"old_price",rules:{required:!0,message:"请输入门票原价",trigger:["blur"]}}},[a("a-input-number",{staticStyle:{width:"300px"},attrs:{disabled:t.disabled,precision:2,placeholder:"请输入门票原价"},model:{value:t.formData.old_price,callback:function(e){t.$set(t.formData,"old_price",e)},expression:"formData.old_price"}})],1),a("a-form-model-item",{attrs:{label:"现价",colon:!1,wrapperCol:{span:6},prop:"price",rules:{required:!0,message:"请输入门票现价",trigger:["blur"]}}},[a("a-input-number",{staticStyle:{width:"300px"},attrs:{disabled:t.disabled,precision:2,placeholder:"请输入门票现价"},model:{value:t.formData.price,callback:function(e){t.$set(t.formData,"price",e)},expression:"formData.price"}}),"course"!=t.type&&1==t.formData.scenic_ticket_type?a("blockquote",[a("a-button",{attrs:{type:"link",disabled:t.calendarDisable(t.formData)||t.disabled},on:{click:function(e){return t.setPriceCalendar(t.formData)}}},[t._v(" 价格日历 ")]),"course"!=t.type?a("div",{staticClass:"help"},[t._v(" 填写现价以后，每天的价格都是现价，想要设置节假日特殊价格，可以使用价格日历单独修改，3个月内的日期价格 ")]):t._e()],1):t._e()],1),"scenic"==t.type&&0==t.formData.scenic_ticket_type?a("a-form-model-item",{attrs:{prop:"date_ticket_start",label:"使用日期",rules:{required:!0,message:"请选择使用日期",trigger:["blur","change"]},colon:!1}},[a("a-range-picker",{staticStyle:{width:"300px"},attrs:{"disabled-date":t.disabledDate,value:t.formData.date_ticket_start&&t.formData.date_ticket_end?[t.moment(t.formData.date_ticket_start,"YYYY-MM-DD"),t.moment(t.formData.date_ticket_end,"YYYY-MM-DD")]:[]},on:{change:t.selectDateChange}})],1):t._e(),a("a-form-model-item",{attrs:{label:"course"==t.type?"数量":"scenic"==t.type&&0==t.formData.scenic_ticket_type?"库存":"每日库存",colon:!1,wrapperCol:{span:6},prop:"price",rules:{required:!0,message:"请输入门票数量",trigger:["blur"]}}},[a("a-input-number",{staticStyle:{width:"300px"},attrs:{precision:0,min:0,placeholder:"请输入门票数量"},model:{value:t.formData.stock_num,callback:function(e){t.$set(t.formData,"stock_num",e)},expression:"formData.stock_num"}})],1)]:t._e(),t.disabledBtn?t._e():[a("a-row",[a("a-col",{attrs:{span:6}}),a("a-col",{attrs:{span:14}},[a("div",{staticClass:"goods-spec"},[1==t.formData.is_sku?a("a-button",{staticClass:"goods-spec-add",attrs:{type:"primary"},on:{click:t.addPrivateSpec}},[t._v("添加规格")]):t._e()],1),t._l(t.privateGoodsItem,(function(e,i){return a("div",{key:i,staticClass:"goods-container"},[a("div",{staticClass:"goods-content"},[a("div",{staticClass:"goods-content-box"},[a("div",{staticClass:"goods-content-left"},[a("a-form",{staticStyle:{width:"400px"},attrs:{"label-width":"80px"}},[a("a-form-item",{attrs:{label:"规格名"}},[a("a-input",{attrs:{placeholder:1==t.formData.is_sku?"请输入规格名":0==i?"请输入时间段":"请输入场馆编号"},model:{value:e.privateSpecName,callback:function(a){t.$set(e,"privateSpecName",a)},expression:"attr.privateSpecName"}})],1),a("a-form-item",{attrs:{label:"规格值"}},[t._l(e.dynamicTags,(function(i){return a("a-tag",{key:i,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){return t.handleClose(i,e)}}},[t._v(" "+t._s(i)+" ")])})),e.inputVisible?a("a-input",{ref:"saveTagInput"+i,refInFor:!0,staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(a){return t.handleInputConfirm(e.inputValue,e)}},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.handleInputConfirm(e.inputValue,e)}},model:{value:e.inputValue,callback:function(a){t.$set(e,"inputValue",a)},expression:"attr.inputValue"}}):a("a-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(a){return t.showInput(e,i)}}},[t._v("+ 添加")])],2)],1)],1),1==t.formData.is_sku?a("div",{staticClass:"goods-content-right"},[a("a-button",{attrs:{type:"danger"},on:{click:function(e){return t.delPrivateSpec(i)}}},[t._v("删除规格")])],1):t._e()])])])})),a("div",[a("a-button",{attrs:{type:"primary"},on:{click:t.onEstablish}},[t._v("创建门票规格表")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showTable,expression:"showTable"}],staticStyle:{"margin-top":"20px"}},[a("p",{staticStyle:{"font-size":"20px","margin-top":"20px"}},[t._v("规格关系列表")]),t.isModification?a("a-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"1%"},attrs:{"data-source":t.tableColumnList.tableBodyList,stripe:"","tooltip-effect":"dark",border:""}},[t._l(t.tableColumnList.tableHeaderList,(function(e){return a("a-table-column",{key:e.prop,attrs:{title:e.propName,align:"center",width:"15px"},scopedSlots:t._u([{key:"default",fn:function(i,o){return[a("span",[t._v(t._s(o[e.prop].name))])]}}],null,!0)})})),a("a-table-column",{key:"price",attrs:{title:"价格",align:"center",width:"50px","data-index":"price"},scopedSlots:t._u([{key:"default",fn:function(e,i,o){return[a("a-input",{attrs:{clearable:"",placeholder:"保留两位小数点"},on:{change:t.goodsPrice,click:function(e){return t.onGetIndex(o)}},model:{value:i.price,callback:function(e){t.$set(i,"price",e)},expression:"record.price"}})]}}],null,!1,2173987189)}),a("a-table-column",{key:"stock",attrs:{title:"stadium"==t.type?"每日库存":"总库存",align:"center",width:"50px","data-index":"stock"},scopedSlots:t._u([{key:"default",fn:function(e,i,o){return[a("a-input",{attrs:{type:"number",placeholder:"请输入整数"},on:{change:t.goodsStock,click:function(e){return t.onGetIndex(o)}},model:{value:i.stock,callback:function(e){t.$set(i,"stock",e)},expression:"record.stock"}})]}}],null,!1,4143962259)}),a("a-table-column",{key:"price_calendar",attrs:{align:"center",width:"50px","data-index":"price_calendar"},scopedSlots:t._u([{key:"default",fn:function(e,i){return["course"!=t.type?a("a-button",{attrs:{type:"primary",disabled:t.calendarDisable(i)},on:{click:function(e){return t.setPriceCalendar(i)}}},[t._v(" 价格日历 ")]):t._e()]}}],null,!1,1889170722)})],2):t._e(),t.isModification?t._e():a("a-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"1%"},attrs:{"data-source":t.editDataSource,stripe:"","tooltip-effect":"dark",border:"",rowKey:"sku_id"}},[t._l(t.editColumns,(function(e){return a("a-table-column",{key:e.prop,attrs:{title:e.name,align:"center",width:"15px"},scopedSlots:t._u([{key:"default",fn:function(i,o){return[a("span",[t._v(t._s(o[e.spec_id]))])]}}],null,!0)})})),a("a-table-column",{key:"price",attrs:{title:"价格",align:"center",width:"50px","data-index":"price"},scopedSlots:t._u([{key:"default",fn:function(e,i,o){return[a("a-input",{attrs:{disabled:t.disabled,clearable:"",placeholder:"保留两位小数点"},on:{change:t.goodsPrice,click:function(e){return t.onGetIndex(o)}},model:{value:i.price,callback:function(e){t.$set(i,"price",e)},expression:"record.price"}})]}}],null,!1,1553582819)}),a("a-table-column",{key:"stock_num",attrs:{title:"stadium"==t.type?"每日库存":"总库存",align:"center",width:"50px","data-index":"stock_num"},scopedSlots:t._u([{key:"default",fn:function(e,i,o){return[a("a-input",{attrs:{disabled:t.disabled,type:"number",placeholder:"请输入整数"},on:{change:t.goodsStock,click:function(e){return t.onGetIndex(o)}},model:{value:i.stock_num,callback:function(e){t.$set(i,"stock_num",e)},expression:"record.stock_num"}})]}}],null,!1,781802540)}),a("a-table-column",{key:"price_calendar",attrs:{align:"center",width:"50px","data-index":"price_calendar"},scopedSlots:t._u([{key:"default",fn:function(e,i){return["course"!=t.type?a("a-button",{attrs:{type:"primary",disabled:t.calendarDisable(i)||t.disabled},on:{click:function(e){return t.setPriceCalendar(i)}}},[t._v(" 价格日历 ")]):t._e()]}}],null,!1,1941842290)})],2)],1)],2)],1)],a("br"),"course"!=t.type?a("a-form-model-item",{attrs:{label:"核销开始时间",colon:!1,prop:"start_time",rules:{required:!0,message:"请选择核销开始时间",trigger:["blur","change"]}}},[a("a-time-picker",{staticStyle:{width:"300px"},attrs:{disabled:t.disabled,placeholder:"请选择核销开始时间",format:t.dateFormat,value:t.date_moment(t.formData.start_time,t.dateFormat),allowClear:!0,getCalendarContainer:function(t){return t.parentNode}},on:{change:t.beginTimeChange}})],1):t._e(),"course"!=t.type?a("a-form-model-item",{attrs:{label:"核销结束时间",colon:!1,prop:"end_time",rules:{required:!0,message:"请选择核销结束时间",trigger:["blur","change"]}}},[a("a-time-picker",{staticStyle:{width:"300px"},attrs:{disabled:t.disabled,placeholder:"请选择核销结束时间",format:t.dateFormat,value:t.date_moment(t.formData.end_time,t.dateFormat),allowClear:!0,getCalendarContainer:function(t){return t.parentNode}},on:{change:t.endTimeChange}})],1):t._e(),"course"==t.type?a("a-form-model-item",{attrs:{label:"结束时间",colon:!1,prop:"course_end_time",rules:{required:!0,message:"结束时间",trigger:["blur","change"]}}},[a("a-date-picker",{staticStyle:{width:"280px"},attrs:{disabled:t.disabled,"show-time":"",placeholder:"请选择时间",format:t.dateTimeFormat,value:t.date_moment(t.formData.course_end_time,t.dateTimeFormat),allowClear:!0},on:{change:t.courseEndTimeChange}})],1):t._e(),a("a-form-model-item",{attrs:{label:"购买须知",colon:!1}},[a("a-textarea",{attrs:{disabled:t.disabled,placeholder:"请输入购买须知","auto-size":{minRows:3,maxRows:5}},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1),a("a-form-model-item",{attrs:{label:"提前取消设置",colon:!1}},[a("a-radio-group",{attrs:{disabled:t.disabled,defaultValue:t.formData.is_refund},model:{value:t.formData.is_refund,callback:function(e){t.$set(t.formData,"is_refund",e)},expression:"formData.is_refund"}},[a("a-radio",{attrs:{value:0}},[t._v(" 不可取消 ")]),a("a-radio",{attrs:{value:1}},[a("span",[t._v("随时取消")])])],1)],1),a("a-form-model-item",{attrs:{label:"标签:",colon:!1}},[t._l(t.label.tags,(function(e,i){return[a("a-tooltip",{key:i,attrs:{title:e}},[a("a-tag",{key:e,attrs:{closable:!t.disabled},on:{close:function(){return t.handleClose1(e)}}},[t._v(" "+t._s(e)+" ")])],1)]})),t.label.inputVisible?a("a-input",{ref:"input",style:{width:"78px"},attrs:{disabled:t.disabled,type:"text",size:"small",value:t.label.inputValue},on:{change:t.handleInputChange,blur:t.handleInputConfirm1,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm1.apply(null,arguments)}}}):a("a-tag",{staticStyle:{background:"#fff",borderstyle:"dashed"},on:{click:t.showAddTagInput}},[a("a-icon",{attrs:{type:"plus"}}),t._v("添加标签 ")],1)],2),"course"==t.type?a("a-form-model-item",{attrs:{label:"是否需要用户填写报名信息：",colon:!1}},[a("a-radio-group",{attrs:{disabled:t.disabled,"default-value":t.open_custom_form},model:{value:t.open_custom_form,callback:function(e){t.open_custom_form=e},expression:"open_custom_form"}},[a("a-radio",{attrs:{value:0}},[t._v("不需要")]),a("a-radio",{attrs:{value:1}},[t._v("需要")])],1)],1):t._e(),1!=t.open_custom_form||"course"!=t.type&&"stadium"!=t.type?t._e():a("a-form-model-item",{attrs:{"wrapper-col":{span:14,offset:6}}},[a("a-button",{attrs:{type:"primary"},on:{click:t.onAddInput}},[t._v(" 添加 ")])],1),1==t.open_custom_form&&"course"==t.type?a("a-row",[a("a-col",{attrs:{span:6}}),a("a-col",{attrs:{span:14}},t._l(t.formInput,(function(e,i){return a("div",{key:i,staticClass:"goods-container"},[a("div",{staticClass:"goods-content"},[a("div",{staticClass:"goods-content-box"},[a("div",{staticClass:"goods-content-left"},[a("a-form",{attrs:{"label-col":{span:5},"wrapper-col":{span:12}}},[a("a-form-item",{attrs:{label:"标题名称："}},[a("a-input",{attrs:{placeholder:"请输入标题名称"},model:{value:e.title,callback:function(a){t.$set(e,"title",a)},expression:"item.title"}})],1),a("a-form-item",{attrs:{label:"排序值："}},[a("a-input",{attrs:{placeholder:"请输入排序值"},model:{value:e.sort,callback:function(a){t.$set(e,"sort",a)},expression:"item.sort"}})],1),a("a-form-item",{attrs:{label:"选择表单控件："}},[a("a-select",{attrs:{placeholder:"请选择表单控件",options:t.custformOptions},model:{value:e.type,callback:function(a){t.$set(e,"type",a)},expression:"item.type"}})],1),"select"==e.type?a("a-form-item",{attrs:{label:"枚举值："}},[a("a-input",{attrs:{placeholder:"选项值之间请用英文 “,” 隔开"},model:{value:e.content,callback:function(a){t.$set(e,"content",a)},expression:"item.content"}})],1):t._e(),a("a-form-item",{attrs:{label:"是否为必填项："}},[a("a-switch",{attrs:{"checked-children":"是","un-checked-children":"否"},model:{value:e.is_must,callback:function(a){t.$set(e,"is_must",a)},expression:"item.is_must"}})],1),a("a-form-item",{attrs:{label:"状态："}},[a("a-switch",{attrs:{"checked-children":"开","un-checked-children":"关"},model:{value:e.is_status,callback:function(a){t.$set(e,"is_status",a)},expression:"item.is_status"}})],1)],1)],1),a("div",{staticClass:"goods-content-right"},[a("a-button",{attrs:{type:"danger"},on:{click:function(e){return t.delInputItem(i)}}},[t._v("删除控件")])],1)])])])})),0)],1):t._e(),1==t.formData.scenic_ticket_type?a("blockquote",["course"!=t.type?a("a-form-model-item",{attrs:{label:"是否可预订当天的门票",colon:!1}},[a("a-radio-group",{attrs:{disabled:t.disabled,defaultValue:t.formData.can_book_today},model:{value:t.formData.can_book_today,callback:function(e){t.$set(t.formData,"can_book_today",e)},expression:"formData.can_book_today"}},[a("a-radio",{attrs:{value:0}},[t._v(" 否 ")]),a("a-radio",{attrs:{value:1}},[a("span",[t._v("是")])])],1)],1):t._e(),"course"!=t.type&&1==t.formData.can_book_today?a("a-form-model-item",{attrs:{label:" 预定当天门票截止时间",colon:!1,prop:"book_today_time",rules:{required:!0,message:"请选择结束时间",trigger:["blur","change"]}}},[a("a-time-picker",{staticStyle:{width:"280px"},attrs:{disabled:t.disabled,placeholder:"请选择结束时间",format:t.dateFormat,value:t.date_moment(t.formData.book_today_time,t.dateFormat),allowClear:!0,getCalendarContainer:function(t){return t.parentNode}},on:{change:t.bookTimeChange}})],1):t._e()],1):t._e(),a("a-form-model-item",{attrs:{label:"绑定核销店员",colon:!1,help:"不选代表全部店员都可以核销，选择之后只有指定店员可核销此门票"}},[a("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",placeholder:"请选择店员","option-label-prop":"label",filterOption:t.filterOption},model:{value:t.formData.staff_ids,callback:function(e){t.$set(t.formData,"staff_ids",e)},expression:"formData.staff_ids"}},t._l(t.staffList,(function(e){return a("a-select-option",{key:e.id,attrs:{value:e.id,label:e.name}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),a("a-form-model-item",{attrs:{label:"状态",colon:!1}},[a("a-radio-group",{attrs:{disabled:t.disabled,defaultValue:t.formData.status},model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},t._l(t.statusList,(function(e){return a("a-radio",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1),t.disabled?a("a-form-item",{attrs:{label:"审核："}},[a("a-radio-group",{model:{value:t.auditValue,callback:function(e){t.auditValue=e},expression:"auditValue"}},[a("a-radio",{attrs:{value:"1"}},[t._v(" 成功 ")]),a("a-radio",{attrs:{value:"2"}},[t._v(" 失败 ")])],1)],1):t._e(),t.disabled?a("a-form-item",{attrs:{label:"备注："}},[a("a-textarea",{attrs:{placeholder:"请输入备注","allow-clear":""},model:{value:t.audit_msg,callback:function(e){t.audit_msg=e},expression:"audit_msg"}})],1):t._e(),t.disabled?a("a-form-item",{attrs:{"wrapper-col":{span:12,offset:5}}},[a("a-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(" 提交审核 ")])],1):t._e()],2)],1),t.disabled?t._e():a("div",{staticClass:"page-header"},[a("a-button",{staticClass:"ml-20 mt-20 mb-20",attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit()}}},[t._v(" 保存 ")])],1)],1),a("price-calendar",{ref:"priceCalendar",on:{getPriceList:t.getPriceList}})],1)},s=[],r=a("ade3"),l=a("53ca"),n=a("5530"),c=a("2909"),d=(a("d3b7"),a("159b"),a("d81d"),a("b64b"),a("a434"),a("6062"),a("3ca3"),a("ddb0"),a("99af"),a("4de4"),a("b0c0"),a("4d95")),u=a("6ec16"),p=a("c1df"),f=a.n(p),m=a("f9cd"),h=a("742d"),_={components:{RichText:u["a"],PriceCalendar:m["default"]},data:function(){return{has_bind_sports:!1,disabled:!1,auditValue:0,audit_msg:"",filterOption:function(t,e){return e.componentOptions.propsData.label.indexOf(t)>-1},title:this.L("新建门票"),labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:14}},calendarKey:"",disabledBtn:!1,showTable:!1,isTure:!1,editData:{},editGoodsItem:{},comparisonArr:{},editDataSource:{},editColumns:{},type:"",toolsNameType:"",toolsName:"",visible:!1,confirmLoading:!1,canSave:!0,form:this.$form.createForm(this),label:{tags:[],inputVisible:!1,inputValue:""},formData:{is_sku:0,ticket_id:0,tools_id:0,title:"",description:"",label:"",old_price:"0",price:"0",start_time:"",end_time:"",stock_type:2,stock_num:0,sort:0,is_appoint:1,is_refund:1,status:1,price_calendar:[],course_end_time:null,book_today_time:null,can_book_today:0,staff_ids:[],scenic_ticket_type:1,date_ticket_start:"",date_ticket_end:""},staffList:[],formInput:[{title:"",sort:"",type:"",content:"",is_must:!1,is_status:!1}],open_custom_form:0,ticket_id:0,tools_id:0,dateFormat:"HH:mm:ss",dateTimeFormat:"YYYY-MM-DD HH:mm:ss",appointTypeList:[{value:0,label:"否"},{value:1,label:"是"}],statusList:[{value:0,label:"关闭"},{value:1,label:"开启"}],tableColumnList:{tableHeaderList:[],tableBodyList:[]},privateGoodsItem:[{privateSpecName:"",dynamicTags:[],inputVisible:!1,inputValue:""}],scenicTicketTypeOptions:[{value:0,label:"期票"},{value:1,label:"预约票"}],custformOptions:[{value:"text",label:"输入框"},{value:"select",label:"单选框"},{value:"area",label:"地址选择器"}],plainOptions:[{label:"单规格",value:0},{label:"多规格",value:1},{label:"场馆分布图",value:2}]}},created:function(){var t=this;h["default"].$on("onClear",(function(e){"success"===e&&(t.$refs.ruleForm.resetFields(),t.tableColumnList={tableHeaderList:[],tableBodyList:[]},t.privateGoodsItem=[{privateSpecName:"",dynamicTags:[],inputVisible:!1,inputValue:""}])})),this.$route.query.disabled?this.disabled=!0:this.disabled=!1},computed:{calculateAttribute:function(){var t={};return this.privateGoodsItem.forEach((function(e,a){if(e.privateSpecName){var i=[];e.dynamicTags.forEach((function(t,e){i.push({id:e,name:t})})),t[e.privateSpecName]=i}})),t},isModification:function(){var t=JSON.stringify(this.comparisonArr),e=JSON.stringify(this.privateGoodsItem);return t!==e}},watch:{editData:{handler:function(t){if("{}"===JSON.stringify(t)||this.isTure)return!1;t.spec_list.length&&(this.privateGoodsItem=this.editGoodsItem),this.isTure=!0},immediate:!0,deep:!0},"form.is_sku":{handler:function(t,e){this.disabledBtn=1!=t},immediate:!0},"$route.query.tools_id":function(t){var e=this.$route&&this.$route.path?this.$route.path:"";"/merchant/merchant.life_tools/ScenicTicketEdit"!=e&&"/merchant/merchant.life_tools/TicketEdit"!=e||t&&(this.formData.tools_id=t,this.tools_id=t,this.getEditInfo())},"$route.query.id":function(t){var e=this.$route&&this.$route.path?this.$route.path:"";"/merchant/merchant.life_tools/ScenicTicketEdit"!=e&&"/merchant/merchant.life_tools/TicketEdit"!=e||(this.ticket_id=t||0,this.ticket_id?this.getDetail():this.getEditInfo())},calculateAttribute:function(t){var e=JSON.parse(JSON.stringify(t)),a=[],i=[];for(var o in e)a.push(o),i.push(e[o]);var s=this.cartesianProductOf.apply(this,i),r={tableBodyList:[],tableHeaderList:[]};r.tableBodyList=s.map((function(t,e){for(var i={price:0,stock:0,price_calendar:[],num:"",key:e},o=0;o<t.length;o++)i[a[o]]=t[o];return i})),this.tableColumnList.tableBodyList=r.tableBodyList;var l=Object.keys(t);r.tableHeaderList=l.map((function(t){return{prop:t,propName:t}})),this.tableColumnList.tableHeaderList=r.tableHeaderList}},mounted:function(){this.formData.tools_id=this.$route.query.tools_id,this.tools_id=this.$route.query.tools_id,this.ticket_id=this.$route.query.id,this.form=this.$form.createForm(this),this.ticket_id?this.getDetail():this.getEditInfo(),this.getStaffList()},beforeRouteLeave:function(t,e,a){this.$destroy(),a()},activated:function(){this.formData.tools_id=this.$route.query.tools_id,this.tools_id=this.$route.query.tools_id,this.ticket_id=this.$route.query.id,this.form=this.$form.createForm(this),this.ticket_id?this.getDetail():this.getEditInfo(),this.getStaffList()},methods:(i={moment:f.a,onAddInput:function(){this.formInput.push({title:"",sort:"",type:"",content:"",is_must:!1,is_status:!1})},goodsPrice:function(t){this.isModification},onGetIndex:function(t){this.imgUrlIndex=t},goodsStock:function(t){this.isModification},getStaffList:function(){var t=this;this.request(d["a"].getStaffList,{pageSize:999999}).then((function(e){t.staffList=e.list}))},addPrivateSpec:function(t){this.privateGoodsItem.push({privateSpecName:"",dynamicTags:[],inputVisible:!1,inputValue:""})},delPrivateSpec:function(t){this.privateGoodsItem.splice(t,1)},delInputItem:function(t){this.formInput.splice(t,1)},handleInputConfirm:function(t,e){t&&e.dynamicTags.push(t),e.dynamicTags.length&&new Set(e.dynamicTags).size!==e.dynamicTags.length&&this.$message.error("请勿重复输入相同规格值"),e.inputVisible=!1,e.inputValue=""},handleClose:function(t,e){e.dynamicTags.splice(e.dynamicTags.indexOf(t),1)},showInput:function(t,e){var a=this;t.inputVisible=!0,this.$nextTick((function(t){a.$refs["saveTagInput".concat(e)][0].$refs.input.focus()}))},cartesianProductOf:function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];return e.reduce((function(t,e){var a=[];return t.forEach((function(t){e.forEach((function(e){a.push(t.concat([e]))}))})),a}),[[]])},onChangeSwitch:function(t){if(this.privateGoodsItem=[],2==t.target.value)for(var e=0;e<2;e++)this.privateGoodsItem.push({privateSpecName:"",dynamicTags:[],inputVisible:!1,inputValue:""});0!=t.target.value?(this.disabledBtn=!1,1==t.target.value&&this.privateGoodsItem.push({privateSpecName:"",dynamicTags:[],inputVisible:!1,inputValue:""})):this.disabledBtn=!0},onEstablish:function(){this.showTable=!this.showTable},handleClose1:function(t){var e=this.label.tags.filter((function(e){return e!==t}));this.label.tags=e},handleInputChange:function(t){this.label.inputValue=t.target.value},handleInputConfirm1:function(){var t=this.label.inputValue,e=this.label.tags;t&&-1===e.indexOf(t)&&(e=[].concat(Object(c["a"])(e),[t])),this.label.tags=e,this.label.inputVisible=!1,this.label.inputValue=""},showAddTagInput:function(){var t=this;this.label.inputVisible=!0,this.$nextTick((function(){t.$refs.input.focus()}))},calendarDisable:function(t){return!1},setPriceCalendar:function(t){this.ticket_id&&this.editDataSource.length>0?this.calendarKey=t.sku_id:this.formData.is_sku&&!this.ticket_id&&(this.calendarKey=t.key),this.$refs.priceCalendar.openModal({rule:t})},getPriceList:function(t){var e=this,a=t.priceList,i=[];for(var o in a)i.push(a[o]);console.log(this.editDataSource),this.$set(this.formData,"price_calendar",i),this.$nextTick((function(){e.ticket_id&&e.editDataSource.length>0?e.editDataSource.map((function(t){if(t.sku_id==e.calendarKey)return e.$set(t,"price_calendar",i)})):!e.ticket_id&&e.formData.is_sku&&e.tableColumnList.tableBodyList.map((function(t){if(t.key==e.calendarKey)return e.$set(t,"price_calendar",i)}))}))},handleSubmit:function(){var t=this;2==this.formData.is_sku&&(this.tableColumnList.tableBodyList.length<=0&&this.tableColumnList.tableHeaderList.length<=1||this.tableColumnList.tableBodyList.length<=1&&this.tableColumnList.tableHeaderList.length<=1||this.tableColumnList.tableBodyList.length<=0&&this.tableColumnList.tableHeaderList.length<=2)?this.$message.warning("规格关系列表请至少填一项数据"):this.$refs.ruleForm.validate((function(e){if(!e)return!1;t.confirmLoading=!0;var a={};for(var i in t.formData)a[i]="content"==i?t.formData.content:"ratio_list"==i?t.formData.ratio_list.filter((function(t){return t.id})):t.formData[i];a.tools_id||(a.tools_id=t.tools_id),a.label=t.label.tags;var o=[],s=[];if(a.is_sku)if(t.isModification)t.privateGoodsItem.map((function(t,e){o.push({id:0,name:t.privateSpecName,list:{}}),t.dynamicTags.map((function(t,a){o[e].list[a]={id:0,name:t}}))})),t.tableColumnList.tableBodyList.map((function(e,a){var i="";t.tableColumnList.tableHeaderList.map((function(t,a){i=i+"_"+e[t.prop].id})),s.push({index:i.substr(1),price:e.price,stock_num:e.stock,price_calendar:e.price_calendar})}));else{var r={},l=t.editData.spec_list.reduce((function(t,e){return!r[e.id]&&(r[e.id]=t.push(e)),t}),[]);l.map((function(t,e){o.push({id:t.id,name:t.name,list:{}}),t.list.map((function(t,a){o[e].list[t.id]={id:t.id,name:t.name}}))})),t.editDataSource.map((function(t){s.push({index:t.spec_val_id,price:t.price,stock_num:t.stock_num,price_calendar:t.price_calendar})})),console.log(t.editDataSource,"规格表数据")}a.sku_list=s,a.spec_list=o,a.open_custom_form=t.open_custom_form,1==t.open_custom_form?a.custom_form=t.formInput:a.custom_form=[],0!=a.scenic_ticket_type&&(a.date_ticket_start="",a.date_ticket_end=""),t.request(d["a"].TicketEdit,a).then((function(e){t.$message.success(e.msg),setTimeout((function(){t.$message.destroy(),t.confirmLoading=!1,t.formInput=[{title:"",sort:"",type:"",content:"",is_must:!1,is_status:!1}],"scenic"==t.type?t.$router.push({path:"/merchant/merchant.life_tools/ScenicTicketList",query:{tools_id:t.tools_id}}):t.$router.push({path:"/merchant/merchant.life_tools/TicketList",query:{tools_id:t.tools_id}})}),1500)})).catch((function(e){t.confirmLoading=!1}))}))},date_moment:function(t,e){return t?f()(t,e):null},handleCancel:function(){var t=this;this.visible=!1,setTimeout((function(){t.ticket_id="0",t.form=t.$form.createForm(t)}),500)},getEditInfo:function(){var t=this;if(!this.ticket_id){this.label=Object(n["a"])(Object(n["a"])({},this.label),{},{tags:[]});var e=this.$options.data.call(this)["formData"]||null;this.formData=e?JSON.parse(JSON.stringify(e)):null,this.formInput=[{title:"",sort:"",type:"",content:"",is_must:!1,is_status:!1}],this.open_custom_form=0}this.disabledBtn=!0,this.tableColumnList={tableHeaderList:[],tableBodyList:[]},this.privateGoodsItem=[{privateSpecName:"",dynamicTags:[],inputVisible:!1,inputValue:""}],this.tools_id&&this.request(d["a"].getEditInfo,{tools_id:this.tools_id}).then((function(e){t.type=e.type,"course"==t.type?t.plainOptions=[{label:"单规格",value:0},{label:"多规格",value:1}]:t.plainOptions=[{label:"单规格",value:0},{label:"多规格",value:1},{label:"场馆分布图",value:2}],t.toolsNameType=e.type_name,t.toolsName=e.title}))},getDetail:function(){var t=this;this.request(d["a"].getTicketDetail,{ticket_id:this.ticket_id}).then((function(e){t.formData=e,e&&e.tools_id&&(t.tools_id=e.tools_id),t.$set(t.formData,"is_sku",e.is_sku),console.log(t.formData.is_sku,656565656),t.has_bind_sports=e.has_bind_sports,t.label.tags=e.label_arr,t.open_custom_form=e.open_custom_form,t.formInput=e.custom_form,"object"===Object(l["a"])(e)&&(t.formData=e),t.getEditInfo(),0===e.spec_list.length?t.disabledBtn=!0:t.disabledBtn=!1,e.spec_list.length&&(t.privateGoodsItem=t.editGoodsItem);var a=e;if(t.editData=e,a.spec_list.length){t.showTable=!0,t.editGoodsItem=[],t.comparisonArr=[];var i={},o=[],s=a.spec_list.reduce((function(t,e){return!i[e.id]&&(i[e.id]=t.push(e)),t}),[]);s.map((function(e,a){o.push({name:e.name,spec_id:"specid:"+e.id}),t.editGoodsItem.push({privateSpecName:e.name,dynamicTags:[],inputVisible:!1,inputValue:""}),t.comparisonArr.push({privateSpecName:e.name,dynamicTags:[],inputVisible:!1,inputValue:""}),e.list.map((function(e,i){t.editGoodsItem[a].dynamicTags.push(e.name),t.comparisonArr[a].dynamicTags.push(e.name)}))})),t.editColumns=o,t.editDataSource=a.sku_list}}))},beginTimeChange:function(t,e){this.formData.start_time=e},courseEndTimeChange:function(t,e){this.formData.course_end_time=e},endTimeChange:function(t,e){var a=f()(this.formData.start_time).valueOf(),i=f()(e).valueOf();i<a?this.$message.error("核销结束时间必须大于开始时间！"):this.formData.end_time=e},bookTimeChange:function(t,e){this.formData.book_today_time=e},disabledDate:function(t){return t&&t<f()().subtract(1,"days")},selectDateChange:function(t,e){this.$set(this.formData,"date_ticket_start",t.length?f()(t[0]).format("YYYY-MM-DD"):""),this.$set(this.formData,"date_ticket_end",t.length?f()(t[1]).format("YYYY-MM-DD"):"")}},Object(r["a"])(i,"bookTimeChange",(function(t,e){this.formData.book_today_time=e})),Object(r["a"])(i,"onSubmit",(function(){var t=this;if(!this.auditValue)return this.$message.warning("请选择审核成功或失败"),!1;if(2==this.auditValue&&!this.audit_msg)return this.$message.error("请填写审核失败备注"),!1;var e=[this.formData.ticket_id];this.request(d["a"].auditTicket,{ticket_ids:e,audit_status:this.auditValue,audit_msg:this.audit_msg}).then((function(e){var a=t;t.$message.success({duration:2,content:"审核成功",onClose:function(){var t="";t="scenic"===a.$route.query.tools_type?"/life_tools/platform.scenic/audit/type=scenic":"/life_tools/platform.LifeToolsSports/PlatPublicList/type=sports",a.$router.push({path:t})}})}))})),i)},g=_,b=(a("da06"),a("2877")),y=Object(b["a"])(g,o,s,!1,null,"df03b86c",null);e["default"]=y.exports},2909:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var i=a("6b75");function o(t){if(Array.isArray(t))return Object(i["a"])(t)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function s(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}var r=a("06c5");function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(t){return o(t)||s(t)||Object(r["a"])(t)||l()}},"4d95":function(t,e,a){"use strict";var i={getTicketList:"life_tools/merchant.LifeToolsTicket/getList",getTicketDetail:"life_tools/merchant.LifeToolsTicket/getDetail",ticketDel:"life_tools/merchant.LifeToolsTicket/del",TicketEdit:"life_tools/merchant.LifeToolsTicket/addOrEdit",getLifeToolsList:"life_tools/merchant.LifeTools/getInformationList",setLifeToolsAttrs:"life_tools/merchant.LifeTools/setLifeToolsAttrs",getSportsOrderList:"/life_tools/merchant.SportsOrder/getOrderList",exportToolsOrder:"/life_tools/merchant.SportsOrder/exportToolsOrder",getSportsOrderDetail:"/life_tools/merchant.SportsOrder/getOrderDetail",agreeSportsOrderRefund:"/life_tools/merchant.SportsOrder/agreeRefund",refuseSportsOrderRefund:"/life_tools/merchant.SportsOrder/refuseRefund",getEditInfo:"life_tools/merchant.LifeToolsTicket/getEditInfo",getCategoryList:"life_tools/merchant.LifeToolsCategory/getCategoryList",getMapConfig:"life_tools/merchant.LifeTools/getMapConfig",getAddressList:"life_tools/merchant.LifeTools/getAddressList",addEditLifeTools:"life_tools/merchant.LifeTools/addEditLifeTools",getLifeToolsDetail:"life_tools/merchant.LifeTools/getLifeToolsDetail",delLifeTools:"life_tools/merchant.LifeTools/delLifeTools",getReplyList:"/life_tools/merchant.LifeToolsReply/searchReply",isShowReply:"/life_tools/merchant.LifeToolsReply/isShowReply",getReplyDetails:"/life_tools/merchant.LifeToolsReply/getReplyDetails",delReply:"/life_tools/merchant.LifeToolsReply/delReply",subReply:"/life_tools/merchant.LifeToolsReply/subReply",getReplyContent:"/life_tools/merchant.LifeToolsReply/getReplyContent",getCardList:"/life_tools/merchant.EmployeeCard/getCardList",editCard:"/life_tools/merchant.EmployeeCard/editCard",saveCard:"/life_tools/merchant.EmployeeCard/saveCard",delCard:"/life_tools/merchant.EmployeeCard/delCard",getSportsVerifyList:"/life_tools/merchant.SportsOrder/getVerifyList",exportVerifyRecord:"/life_tools/merchant.SportsOrder/exportVerifyRecord",getLimitedList:"/life_tools/merchant.LifeScenicLimitedAct/getLimitedList",updateLimited:"/life_tools/merchant.LifeScenicLimitedAct/addLimited",limitedChangeState:"/life_tools/merchant.LifeScenicLimitedAct/changeState",removeLimited:"/life_tools/merchant.LifeScenicLimitedAct/del",getLimitedInfo:"/life_tools/merchant.LifeScenicLimitedAct/edit",getMerchantSort:"/life_tools/merchant.LifeToolsTicket/getMerchantSort",getLifeToolsTicket:"/life_tools/merchant.LifeToolsTicket/getLifeToolsTicket",getToolsCardList:"/life_tools/merchant.LifeTools/getToolsCardList",AddOrEditToolsCard:"/life_tools/merchant.LifeTools/AddOrEditToolsCard",getToolsCardEdit:"/life_tools/merchant.LifeTools/getToolsCardEdit",delToolsCard:"/life_tools/merchant.LifeTools/delToolsCard",getAllToolsList:"/life_tools/merchant.LifeTools/getAllToolsList",getToolsCardRecord:"/life_tools/merchant.LifeTools/getToolsCardRecord",getCardOrderList:"/life_tools/merchant.LifeTools/getCardOrderList",getCardOrderDetail:"/life_tools/merchant.LifeTools/getCardOrderDetail",agreeCardOrderRefund:"/life_tools/merchant.LifeTools/agreeCardOrderRefund",refuseCardOrderRefund:"/life_tools/merchant.LifeTools/refuseCardOrderRefund",getSportsActivityList:"/life_tools/merchant.LifeToolsSportsActivity/getSportsActivityList",updateSportsActivityStatus:"/life_tools/merchant.LifeToolsSportsActivity/updateSportsActivityStatus",getSportsActivityOrderList:"/life_tools/merchant.LifeToolsSportsActivity/getSportsActivityOrderList",addSportsActivity:"/life_tools/merchant.LifeToolsSportsActivity/addSportsActivity",editSportsActivity:"/life_tools/merchant.LifeToolsSportsActivity/editSportsActivity",getTravelList:"/life_tools/merchant.LifeToolsGroupTravelAgency/getTravelList",agencyAudit:"/life_tools/merchant.LifeToolsGroupTravelAgency/audit",getStaffList:"/life_tools/merchant.LifeToolsTicket/getStaffList",getAppointList:"life_tools/merchant.LifeToolsAppoint/getList",getAppointMsg:"life_tools/merchant.LifeToolsAppoint/getToolAppointMsg",saveAppoint:"life_tools/merchant.LifeToolsAppoint/saveToolAppoint",lookAppointUser:"life_tools/merchant.LifeToolsAppoint/lookAppointUser",closeAppoint:"life_tools/merchant.LifeToolsAppoint/closeAppoint",exportAppointUserOrder:"life_tools/merchant.LifeToolsAppoint/exportUserOrder",delAppoint:"life_tools/merchant.LifeToolsAppoint/delAppoint",getSeatMap:"/life_tools/merchant.LifeToolsAppoint/getSeatMap",getAppointOrderDetail:"life_tools/merchant.LifeToolsAppoint/getAppointOrderDetail",auditRefund:"life_tools/merchant.LifeToolsAppoint/auditRefund",suspend:"life_tools/merchant.LifeToolsAppoint/suspend",getSportsSecondsKillList:"/life_tools/merchant.LifeToolsSportsSecondsKill/getSecondsKillList",saveSportsSecondsKill:"/life_tools/merchant.LifeToolsSportsSecondsKill/saveSecondsKill",ChangeSportsSecondsKill:"/life_tools/merchant.LifeToolsSportsSecondsKill/ChangeSportsSecondsKill",delSportsSecondsKill:"/life_tools/merchant.LifeToolsSportsSecondsKill/delSecondsKill",getSportsSecondsKillDetail:"/life_tools/merchant.LifeToolsSportsSecondsKill/getSecondsKillDetail",getGroupTicketList:"life_tools/merchant.group/getGroupTicketList",getGroupLifeToolsTicket:"life_tools/merchant.LifeToolsTicket/getLifeToolsTicket",addGroupTicket:"life_tools/merchant.group/addGroupTicket",delGroupTicket:"life_tools/merchant.group/delGroupTicket",editSettingData:"life_tools/merchant.group/editSettingData",editGroupTicket:"life_tools/merchant.group/editGroupTicket",getSettingDataDetail:"life_tools/merchant.group/getSettingDataDetail",getStatisticsData:"life_tools/merchant.LifeToolsGroupOrder/getStatisticsData",getOrderList:"life_tools/merchant.LifeToolsGroupOrder/getOrderList",getOrderAuditList:"/life_tools/merchant.LifeToolsGroupOrder/getAuditGroupOrderList",orderAudit:"/life_tools/merchant.LifeToolsGroupOrder/audit",groupOrderRefand:"life_tools/merchant.LifeToolsGroupOrder/groupOrderRefand",editDistributionPrice:"life_tools/merchant.LifeToolsDistribution/editDistributionPrice",getDistributionSettingDataDetail:"/life_tools/merchant.LifeToolsDistribution/getSettingDataDetail",getDistributionSettingeditSetting:"/life_tools/merchant.LifeToolsDistribution/editSetting",getAtatisticsInfo:"/life_tools/merchant.LifeToolsDistribution/getAtatisticsInfo",getDistributorList:"/life_tools/merchant.LifeToolsDistribution/getDistributorList",getLowerLevel:"/life_tools/merchant.LifeToolsDistribution/getLowerLevel",audit:"/life_tools/merchant.LifeToolsDistribution/audit",getDistributionOrderList:"/life_tools/merchant.LifeToolsDistribution/getDistributionOrderList",editDistributionOrderNote:"/life_tools/merchant.LifeToolsDistribution/editDistributionOrderNote",delDistributor:"/life_tools/merchant.LifeToolsDistribution/delDistributor",addStatement:"/life_tools/merchant.LifeToolsDistribution/addStatement",getStatementList:"/life_tools/merchant.LifeToolsDistribution/getStatement",getStatementDetail:"/life_tools/merchant.LifeToolsDistribution/getStatementDetail",lifeToolsAudit:"/life_tools/platform.LifeTools/lifeToolsAudit",auditTicket:"/life_tools/platform.LifeToolsTicket/auditTicket",getMapCity:"/g=Index&c=Map&a=suggestion",getCarParkList:"/life_tools/merchant.LifeToolsCarPark/getCarParkList",addCarPark:"/life_tools/merchant.LifeToolsCarPark/addCarPark",showCarPark:"/life_tools/merchant.LifeToolsCarPark/showCarPark",getToolsList:"/life_tools/merchant.LifeToolsCarPark/getToolsList",deleteCarPark:"/life_tools/merchant.LifeToolsCarPark/deleteCarPark",statusCarPark:"/life_tools/merchant.LifeToolsCarPark/statusCarPark",wifiList:"life_tools/merchant.LifeToolsWifi/wifiList",wifiAdd:"life_tools/merchant.LifeToolsWifi/wifiAdd",wifiShow:"life_tools/merchant.LifeToolsWifi/wifiShow",wifiStatusChange:"life_tools/merchant.LifeToolsWifi/wifiStatusChange",wifiDelete:"life_tools/merchant.LifeToolsWifi/wifiDelete",scenicMapSave:"/life_tools/merchant.LifeToolsScenicMap/saveMap",scenicMapPlaceList:"/life_tools/merchant.LifeToolsScenicMap/mapPlaceList",scenicMapPlaceSave:"/life_tools/merchant.LifeToolsScenicMap/saveMapPlace",scenicMapPlaceDel:"/life_tools/merchant.LifeToolsScenicMap/mapPlaceDel",scenicMapLineList:"/life_tools/merchant.LifeToolsScenicMap/mapLineList",scenicMapLineSave:"/life_tools/merchant.LifeToolsScenicMap/saveMapLine",scenicMapLineDel:"/life_tools/merchant.LifeToolsScenicMap/mapLineDel",scenicMapScenicList:"/life_tools/merchant.LifeToolsScenicMap/scenicList",scenicMapPlaceCatList:"/life_tools/merchant.LifeToolsScenicMap/categoryList",scenicMapPlaceCategoryDel:"/life_tools/merchant.LifeToolsScenicMap/categoryDel",scenicMapPlaceCategorySave:"/life_tools/merchant.LifeToolsScenicMap/saveCategory",scenicMapList:"/life_tools/merchant.LifeToolsScenicMap/mapList",scenicMapDel:"/life_tools/merchant.LifeToolsScenicMap/mapDel",scenicMapStatusSave:"/life_tools/merchant.LifeToolsScenicMap/saveMapStatus",changeCloseStatus:"life_tools/merchant.LifeTools/changeCloseStatus",getAddEditCardMerchantInfo:"/life_tools/merchant.LifeTools/getAddEditCardMerchantInfo"};e["a"]=i},"742d":function(t,e,a){"use strict";a.r(e);var i=a("8bbf"),o=a.n(i);e["default"]=new o.a},"976d":function(t,e,a){"use strict";a("c494")},c494:function(t,e,a){},da06:function(t,e,a){"use strict";a("e702")},e702:function(t,e,a){},f9cd:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-modal",{attrs:{title:"价格日历",width:840,visible:t.visible,destroyOnClose:""},on:{ok:t.handleSubmit,cancel:t.handleCancel}},[a("div",{staticClass:"container"},[a("calendar",{attrs:{validRange:[t.moment(),t.moment().add(3,"month").subtract(1,"days")],headerRender:t.headerRender},scopedSlots:t._u([{key:"dateCellRender",fn:function(e){return[t.showPrice(e)?a("div",{staticClass:"date-cell"},[a("span",[t._v(t._s(t.priceList[t.moment(e.format("YYYY-MM-DD")).unix()].price))]),e.isAfter(t.moment().subtract(1,"days"))?a("a-icon",{staticClass:"edit",attrs:{type:"form"},on:{click:function(a){return a.stopPropagation(),t.editPrice(e)}}}):t._e()],1):t._e()]}}])})],1)]),a("a-modal",{attrs:{title:"编辑价格",width:650,visible:t.editVisiable,centered:"",destroyOnClose:""},on:{ok:t.handlePriceChange,cancel:t.handlePriceCancel}},[a("div",{staticClass:"edit-price"},[a("a-row",{attrs:{gutter:t.gutter}},[a("a-col",{attrs:{span:t.span.left}},[t._v(" 门票名称：")]),a("a-col",{attrs:{span:t.span.right}},[a("span",[t._v(t._s(t.ruleName))])])],1),a("a-row",{attrs:{gutter:t.gutter}},[a("a-col",{attrs:{span:t.span.left}},[t._v(" 生效时间：")]),a("a-col",{attrs:{span:t.span.right}},[t.dayPriceChange?a("span",[t._v(t._s(t.currentValue.day))]):a("a-range-picker",{staticStyle:{width:"300px"},attrs:{"disabled-date":t.disabledDate},model:{value:t.formData.day,callback:function(e){t.$set(t.formData,"day",e)},expression:"formData.day"}})],1)],1),a("a-row",{attrs:{gutter:t.gutter}},[a("a-col",{attrs:{span:t.span.left}},[t._v(" 售卖价格：")]),t.dayPriceChange?a("a-col",{attrs:{span:t.span.right}},[a("a-input-number",{staticStyle:{width:"300px"},attrs:{min:0,placeholder:"请输入价格"},model:{value:t.formData.price,callback:function(e){t.$set(t.formData,"price",e)},expression:"formData.price"}})],1):a("a-col",{attrs:{span:t.span.right}},[a("a-radio-group",{model:{value:t.formData.salePriceType,callback:function(e){t.$set(t.formData,"salePriceType",e)},expression:"formData.salePriceType"}},[a("a-radio",{attrs:{value:1}},[t._v(" 每天统一价格 ")]),a("a-radio",{attrs:{value:2}},[t._v(" 在周内设置不同价格 ")])],1),a("div",{staticClass:"mt-10"},[1==t.formData.salePriceType?a("a-input-number",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入价格",min:0},model:{value:t.formData.price,callback:function(e){t.$set(t.formData,"price",e)},expression:"formData.price"}}):a("div",[a("div",[a("a-input-number",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:"请输入价格",min:0},model:{value:t.formData.price1,callback:function(e){t.$set(t.formData,"price1",e)},expression:"formData.price1"}}),t._l(t.weekArr,(function(e,i){return a("a-checkable-tag",{key:e.key,on:{change:function(e){return t.weekCheckChange(e,"1",i)}},model:{value:e.check1,callback:function(a){t.$set(e,"check1",a)},expression:"item.check1"}},[t._v(" "+t._s(e.title)+" ")])}))],2),a("div",{staticClass:"mt-10"},[a("a-input-number",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{min:0,placeholder:"请输入价格"},model:{value:t.formData.price2,callback:function(e){t.$set(t.formData,"price2",e)},expression:"formData.price2"}}),t._l(t.weekArr,(function(e,i){return a("a-checkable-tag",{key:e.key,on:{change:function(e){return t.weekCheckChange(e,"2",i)}},model:{value:e.check2,callback:function(a){t.$set(e,"check2",a)},expression:"item.check2"}},[t._v(" "+t._s(e.title)+" ")])}))],2)])],1)],1)],1),a("a-row",{attrs:{gutter:t.gutter}},[a("a-col",{attrs:{span:t.span.left}},[t._v(" 是否售卖：")]),a("a-col",{attrs:{span:t.span.right}},[a("a-radio-group",{model:{value:t.formData.is_sale,callback:function(e){t.$set(t.formData,"is_sale",e)},expression:"formData.is_sale"}},[a("a-radio",{attrs:{value:1}},[t._v(" 售卖 ")]),a("a-radio",{attrs:{value:0}},[t._v(" 停售 ")])],1)],1)],1)],1)])],1)},o=[],s=(a("420d"),a("3d8c")),r=(a("d3b7"),a("159b"),a("caad"),a("c1df")),l=a.n(r),n={name:"GroupPriceCalendar",components:{Calendar:s["a"]},props:{},data:function(){return{gutter:[10,10],span:{left:4,right:20},visible:!1,rule:{},editVisiable:!1,priceList:{},weekArr:[{title:"周一",check1:!0,check2:!1,key:0},{title:"周二",check1:!0,check2:!1,key:1},{title:"周三",check1:!0,check2:!1,key:2},{title:"周四",check1:!0,check2:!1,key:3},{title:"周五",check1:!0,check2:!1,key:4},{title:"周六",check1:!0,check2:!1,key:5},{title:"周日",check1:!0,check2:!1,key:6}],dayPriceChange:!1,currentValue:{},currentValueKey:0,formData:{price:"",price1:"",price2:"",is_sale:1,day:[l()(),l()().add(3,"month").subtract(1,"days")],salePriceType:1}}},computed:{ruleName:function(){return this.rule.title}},methods:{moment:l.a,openModal:function(t){console.log(t);var e=t.rule;this.rule=e,this.getPriceList(),this.visible=!0},getPriceList:function(){var t=this;this.priceList={};var e=l()().subtract(1,"days"),a=l()().add(3,"month").subtract(1,"days"),i=a.diff(e,"days");if(this.rule.price_calendar&&this.rule.price_calendar.length){var o=this.rule.price_calendar.length;this.rule.price_calendar.forEach((function(e){var a=l()(e.day),i=a.unix();t.priceList[i]={price:e.price,is_sale:e.is_sale,day:e.day}}));for(var s=l()(this.rule.price_calendar[o-1].day),r=a.diff(s,"days"),n=0;n<r;n++){var c=l()().add(n,"day").format("YYYY-MM-DD");c=l()(c);var d=c.unix();this.priceList[d]||(this.priceList[d]={price:this.rule.price,is_sale:1,day:c.format("YYYY-MM-DD")})}}else for(var u=0;u<i;u++){var p=l()().add(u,"day"),f=p.format("YYYY-MM-DD"),m=l()(f).unix();this.priceList[m]={price:this.rule.price,is_sale:1,day:f}}},handleSubmit:function(){this.$emit("getPriceList",{priceList:this.priceList}),this.handleCancel()},handleCancel:function(){this.visible=!1},handlePriceCancel:function(){this.formData=this.$options.data().formData,this.editVisiable=!1},headerRender:function(t){for(var e=this,a=t.value,i=(t.type,t.onChange),o=(t.onTypeChange,this.$createElement),s=0,r=12,l=[],n=a.clone(),c=a.localeData(),d=[],u=0;u<12;u++)n.month(u),d.push(c.monthsShort(n));for(var p=s;p<r;p++)l.push(o("a-select-option",{class:"month-item",key:"".concat(p)},[d[p]]));for(var f=a.month(),m=a.year(),h=[],_=m-1;_<m+2;_+=1)h.push(o("a-select-option",{key:_,attrs:{value:_},class:"year-item"},[_]));var g=this.rule.title;return o("div",{style:{padding:"10px"}},[o("a-row",{attrs:{type:"flex",justify:"space-between"}},[o("a-col",[o("a-select",{attrs:{dropdownMatchSelectWidth:!1,value:String(m)},on:{change:function(t){var e=a.clone().year(t);i(e)}}},[h]),o("a-select",{style:{marginLeft:"10px"},attrs:{dropdownMatchSelectWidth:!1,value:String(f)},on:{change:function(t){var e=a.clone();e.month(parseInt(t,10)),i(e)}}},[l])]),o("a-col",[g]),o("a-col",[o("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.editPrice()}}},["批量设置"])])])])},disabledDate:function(t){return t.isBefore(l()().subtract(1,"days"))||t.isAfter(l()().add(3,"month").subtract(1,"days"))},showPrice:function(t){var e=l()(t.format("YYYY-MM-DD")).unix();return this.priceList&&this.priceList[e]},editPrice:function(t){t?(this.dayPriceChange=!0,this.currentValueKey=l()(t.format("YYYY-MM-DD")).unix(),this.currentValue=this.priceList[this.currentValueKey],this.formData.price=this.currentValue.price,this.formData.is_sale=this.currentValue.is_sale):this.dayPriceChange=!1,this.editVisiable=!0},handlePriceChange:function(){if(console.log(this.formData),!this.dayPriceChange&&(this.dayPriceChange||1!=this.formData.salePriceType)||""!==this.formData.price&&null!=this.formData.price){if(this.dayPriceChange)this.currentValue.price=this.formData.price,this.currentValue.is_sale=this.formData.is_sale,this.$set(this.priceList,this.currentValueKey,this.currentValue);else{if(2==this.formData.salePriceType&&(""===this.formData.price1||""===this.formData.price2))return void this.$message.error("请输入两个售卖价格");if(!this.formData.day.length)return void this.$message.error("请选择生效时间");var t=[],e=[];2==this.formData.salePriceType&&this.weekArr.forEach((function(a){a.check1?t.push(a.key):e.push(a.key)}));var a=this.formData.day[0].format("YYYY-MM-DD"),i=this.formData.day[1].format("YYYY-MM-DD");for(var o in this.priceList){var s=this.priceList[o];if(l()(s.day).isBetween(a,i,null,"[]")){if(1==this.formData.salePriceType)s.price=this.formData.price,s.is_sale=this.formData.is_sale;else{var r=l()(s.day).weekday();t.includes(r)?s.price=this.formData.price1:s.price=this.formData.price2,s.is_sale=this.formData.is_sale}this.$set(this.priceList,o,s)}}}this.handlePriceCancel()}else this.$message.error("请输入售卖价格")},weekCheckChange:function(t,e,a){var i=this.weekArr[a];1==e?i.check2=!t:i.check1=!t,this.$set(this.weekArr,a,i)}}},c=n,d=(a("976d"),a("2877")),u=Object(d["a"])(c,i,o,!1,null,"2ddb0357",null);e["default"]=u.exports}}]);