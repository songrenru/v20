(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2369fc52"],{"06d4":function(e,t,a){"use strict";a("b22d")},5051:function(e,t,a){"use strict";var s={getCatList:"/new_marketing/merchant.MarketingPackage/getCatList",getCatStoreList:"/new_marketing/merchant.MarketingPackage/getCatSearchList",getMealList:"/new_marketing/merchant.MarketingPackage/getSearchList",getClassifyDetail:"/new_marketing/merchant.MarketingPackage/getCatDetail",getMealDetail:"/new_marketing/merchant.MarketingPackage/getpackageDetail",getPrice:"/new_marketing/merchant.MarketingPackage/getDiscountPayPrice",getPayType:"/new_marketing/merchant.Order/pay_check",checkOrder:"/new_marketing/merchant.Order/pay",checkOrderPayOk:"/new_marketing/merchant.Order/searchPayStatus",getOrderList:"/new_marketing/merchant.order/getOrderList",getStoreUserdDetail:"/new_marketing/merchant.store/getStoreUserdDetail",getOrderDetail:"/new_marketing/merchant.order/getOrderDetail",getCategoryStoreDetail:"/new_marketing/merchant.store/getCategoryStoreDetail",getCategoryStoreList:"/new_marketing/merchant.store/getCategoryStoreList",getRenewPayInfo:"/new_marketing/merchant.order/getPayInfo",savePayInfo:"/new_marketing/merchant.order/savePayInfo",goPay:"/merchant/merchant.pay/goPay"};t["a"]=s},"6b61":function(e,t,a){"use strict";a.r(t);a("b0c0");var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"renewal-detail"},[t("div",{staticClass:"header-title"},[e._v("续费详情")]),t("div",{staticClass:"content"},[t("a-row",[t("a-col",{attrs:{span:16}},[t("div",{staticClass:"col left"},[t("img",{staticClass:"left-image",attrs:{src:e.shopDetail.image}}),t("div",{staticClass:"right-content"},[t("div",{staticClass:"content-title"},[e._v(e._s(e.shopDetail.name))]),t("div",{staticClass:"row"},[t("span",{staticClass:"title"},[e._v("价格：")]),t("span",{staticClass:"price"},[e._v(e._s(e.currency+e.price)+"/年")])]),t("div",{staticClass:"row"},[t("span",{staticClass:"title"},[e._v("服务周期：")]),t("div",{staticClass:"service"},e._l(e.yearList,(function(a){return t("div",{key:a.years,staticClass:"service-item",class:a.years==e.years?"active":"",on:{click:function(t){return e.seviceItemChange(a)}}},[t("span",{staticClass:"item"},[e._v(e._s(a.label))]),a.discount?t("span",{staticClass:"discount"},[e._v(e._s(a.discount))]):e._e()])})),0)])])])]),t("a-col",{attrs:{span:8}},[t("div",{staticClass:"col right"},[t("div",{staticClass:"content-title"},[e._v("支付方式")]),t("div",{staticClass:"right-cont"},[t("div",{staticClass:"top"},[t("a-radio-group",{model:{value:e.payType,callback:function(t){e.payType=t},expression:"payType"}},e._l(e.payTypes,(function(a){return t("a-radio",{key:a.value,style:e.radioStyle,attrs:{value:a.value}},[e._v(" "+e._s(a.label)+" "),"balance"==a.value?[t("span",{staticStyle:{color:"red"}},[2==e.merchantMoenyShowType?[e._v("-")]:e._e(),e._v(" "+e._s(e.currency+e.merchantMoenyShow)+" ")],2),e.payMoney>e.merchantMoeny?t("span",{staticStyle:{color:"#aaaaaa"}},[e._v("（余额不足）")]):e._e()]:e._e()],2)})),1)],1),t("div",{staticClass:"bottom"},[t("div",{staticClass:"discount"},[e._v("已优惠"+e._s(e.currency+e.discountMoney))]),t("div",{staticClass:"pay-money"},[e._v(e._s(e.currency+e.payMoney))]),t("div",{staticClass:"pay-btn",on:{click:e.goPay}},[e._v("立即购买")])])])])])],1)],1),t("a-modal",{staticClass:"modal",staticStyle:{"text-aligin":"center"},attrs:{title:"请使用微信扫码支付",width:700,centered:"",destroyOnClose:"",cancelText:"关闭",okText:"支付已完成"},on:{ok:e.handleOK},model:{value:e.wxPayModalVisible,callback:function(t){e.wxPayModalVisible=t},expression:"wxPayModalVisible"}},[t("div",{staticClass:"tips"},[e._v("请使用微信扫描二维码进行支付")]),t("div",{staticClass:"qrcode"},[t("img",{attrs:{src:e.qrCodeImg}})])])],1)},i=[],r=a("ade3"),n=(a("a9e3"),a("5051")),c=null,o=null,y={name:"MarketingRenewalDetail",data:function(){var e;return e={currency:"￥",payType:"1",radioStyle:{display:"block",height:"40px",lineHeight:"40px",fontSize:"16px",color:"#333"},wxPayModalVisible:!1,storeId:"",years:"",price:"",shopDetail:{},yearList:[],payTypes:[]},Object(r["a"])(e,"payType",""),Object(r["a"])(e,"payMoney",""),Object(r["a"])(e,"discountMoney",""),Object(r["a"])(e,"merchantMoeny",""),Object(r["a"])(e,"qrCodeImg",""),Object(r["a"])(e,"merchantMoenyShow",""),Object(r["a"])(e,"merchantMoenyShowType",1),Object(r["a"])(e,"orderid",""),e},watch:{"$route.query.store_id":function(e){e&&(Object.assign(this.$data,this.$options.data()),this.storeId=e,this.getData())}},mounted:function(){this.storeId=this.$route.query.store_id,this.getData()},methods:{goPay:function(){var e=this;console.log(this.payType),"balance"==this.payType&&Number(this.merchantMoeny)<Number(this.payMoney)?this.$message.warning("余额不足，请选择其他支付方式~"):this.request(n["a"].savePayInfo,{store_id:this.storeId,years:this.years,pay_type:this.payType}).then((function(t){t&&t.order_id&&e.request(n["a"].goPay,{order_id:t.order_id,order_type:t.order_type,pay_type:e.payType}).then((function(t){"weixin"==e.payType?(e.qrCodeImg=t.info,e.wxPayModalVisible=!0):"alipay"==e.payType?(window.open(t.info),e.orderid=t.orderid,o=e.$message.loading("正在支付...",0),c=setInterval((function(){e.getOrderDetail()}),1e3)):(e.$message.success("支付成功！"),setTimeout((function(){e.handleOK()}),1e3))}))}))},getOrderDetail:function(){var e=this;this.request(n["a"].checkOrderPayOk,{orderid:this.orderid}).then((function(t){1==t.paid&&(setTimeout(o,0),e.$message.success("支付成功！"),clearInterval(c),c=null,setTimeout((function(){e.handleOK()}),1e3))})).catch((function(t){setTimeout(o,0),e.$message.error("支付失败！"+t.msg),clearInterval(c),c=null}))},handleOK:function(){this.wxPayModalVisible=!1,this.$multiTab.closeCurrentPage(),this.$router.push("/new_marketing/merchant/storeUseDetail")},seviceItemChange:function(e){this.years=e.years,this.price=e.price,this.getData()},getData:function(){var e=this,t={store_id:this.storeId};this.years&&(t.years=this.years),this.request(n["a"].getRenewPayInfo,t).then((function(t){t&&(e.years||(e.years=t.price_detail.service_cycle[0].years,e.price=t.price_detail.service_cycle[0].price,e.$set(e,"shopDetail",t.store),t.price_detail&&t.price_detail.service_cycle&&e.$set(e,"yearList",t.price_detail.service_cycle)),t.pay&&(e.payMoney=Number(t.pay.pay_money),e.discountMoney=Number(t.pay.discount_money),e.merchantMoeny=Number(t.pay.merchant_money),e.merchantMoenyShow=e.merchantMoeny>0?e.merchantMoeny:-1*e.merchantMoeny,e.merchantMoenyShowType=e.merchantMoeny>0?1:2,e.$set(e,"payTypes",t.pay.pay_type),!e.payType&&t.pay.pay_type&&t.pay.pay_type.length&&(e.payType=t.pay.pay_type[0].value)))}))}}},l=y,d=(a("06d4"),a("2877")),p=Object(d["a"])(l,s,i,!1,null,"078f1f83",null);t["default"]=p.exports},b22d:function(e,t,a){}}]);