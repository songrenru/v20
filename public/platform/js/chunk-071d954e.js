(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-071d954e"],{"3b01":function(e,t,a){},"976d":function(e,t,a){"use strict";a("3b01")},f9cd:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-modal",{attrs:{title:"价格日历",width:840,visible:e.visible,destroyOnClose:""},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[a("div",{staticClass:"container"},[a("calendar",{attrs:{validRange:[e.moment(),e.moment().add(3,"month").subtract(1,"days")],headerRender:e.headerRender},scopedSlots:e._u([{key:"dateCellRender",fn:function(t){return[e.showPrice(t)?a("div",{staticClass:"date-cell"},[a("span",[e._v(e._s(e.priceList[e.moment(t.format("YYYY-MM-DD")).unix()].price))]),t.isAfter(e.moment().subtract(1,"days"))?a("a-icon",{staticClass:"edit",attrs:{type:"form"},on:{click:function(a){return a.stopPropagation(),e.editPrice(t)}}}):e._e()],1):e._e()]}}])})],1)]),a("a-modal",{attrs:{title:"编辑价格",width:650,visible:e.editVisiable,centered:"",destroyOnClose:""},on:{ok:e.handlePriceChange,cancel:e.handlePriceCancel}},[a("div",{staticClass:"edit-price"},[a("a-row",{attrs:{gutter:e.gutter}},[a("a-col",{attrs:{span:e.span.left}},[e._v(" 门票名称：")]),a("a-col",{attrs:{span:e.span.right}},[a("span",[e._v(e._s(e.ruleName))])])],1),a("a-row",{attrs:{gutter:e.gutter}},[a("a-col",{attrs:{span:e.span.left}},[e._v(" 生效时间：")]),a("a-col",{attrs:{span:e.span.right}},[e.dayPriceChange?a("span",[e._v(e._s(e.currentValue.day))]):a("a-range-picker",{staticStyle:{width:"300px"},attrs:{"disabled-date":e.disabledDate},model:{value:e.formData.day,callback:function(t){e.$set(e.formData,"day",t)},expression:"formData.day"}})],1)],1),a("a-row",{attrs:{gutter:e.gutter}},[a("a-col",{attrs:{span:e.span.left}},[e._v(" 售卖价格：")]),e.dayPriceChange?a("a-col",{attrs:{span:e.span.right}},[a("a-input-number",{staticStyle:{width:"300px"},attrs:{min:0,placeholder:"请输入价格"},model:{value:e.formData.price,callback:function(t){e.$set(e.formData,"price",t)},expression:"formData.price"}})],1):a("a-col",{attrs:{span:e.span.right}},[a("a-radio-group",{model:{value:e.formData.salePriceType,callback:function(t){e.$set(e.formData,"salePriceType",t)},expression:"formData.salePriceType"}},[a("a-radio",{attrs:{value:1}},[e._v(" 每天统一价格 ")]),a("a-radio",{attrs:{value:2}},[e._v(" 在周内设置不同价格 ")])],1),a("div",{staticClass:"mt-10"},[1==e.formData.salePriceType?a("a-input-number",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入价格",min:0},model:{value:e.formData.price,callback:function(t){e.$set(e.formData,"price",t)},expression:"formData.price"}}):a("div",[a("div",[a("a-input-number",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:"请输入价格",min:0},model:{value:e.formData.price1,callback:function(t){e.$set(e.formData,"price1",t)},expression:"formData.price1"}}),e._l(e.weekArr,(function(t,i){return a("a-checkable-tag",{key:t.key,on:{change:function(t){return e.weekCheckChange(t,"1",i)}},model:{value:t.check1,callback:function(a){e.$set(t,"check1",a)},expression:"item.check1"}},[e._v(" "+e._s(t.title)+" ")])}))],2),a("div",{staticClass:"mt-10"},[a("a-input-number",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{min:0,placeholder:"请输入价格"},model:{value:e.formData.price2,callback:function(t){e.$set(e.formData,"price2",t)},expression:"formData.price2"}}),e._l(e.weekArr,(function(t,i){return a("a-checkable-tag",{key:t.key,on:{change:function(t){return e.weekCheckChange(t,"2",i)}},model:{value:t.check2,callback:function(a){e.$set(t,"check2",a)},expression:"item.check2"}},[e._v(" "+e._s(t.title)+" ")])}))],2)])],1)],1)],1),a("a-row",{attrs:{gutter:e.gutter}},[a("a-col",{attrs:{span:e.span.left}},[e._v(" 是否售卖：")]),a("a-col",{attrs:{span:e.span.right}},[a("a-radio-group",{model:{value:e.formData.is_sale,callback:function(t){e.$set(e.formData,"is_sale",t)},expression:"formData.is_sale"}},[a("a-radio",{attrs:{value:1}},[e._v(" 售卖 ")]),a("a-radio",{attrs:{value:0}},[e._v(" 停售 ")])],1)],1)],1)],1)])],1)},r=[],s=(a("420d"),a("3d8c")),c=(a("d3b7"),a("159b"),a("caad"),a("c1df")),n=a.n(c),l={name:"GroupPriceCalendar",components:{Calendar:s["a"]},props:{},data:function(){return{gutter:[10,10],span:{left:4,right:20},visible:!1,rule:{},editVisiable:!1,priceList:{},weekArr:[{title:"周一",check1:!0,check2:!1,key:0},{title:"周二",check1:!0,check2:!1,key:1},{title:"周三",check1:!0,check2:!1,key:2},{title:"周四",check1:!0,check2:!1,key:3},{title:"周五",check1:!0,check2:!1,key:4},{title:"周六",check1:!0,check2:!1,key:5},{title:"周日",check1:!0,check2:!1,key:6}],dayPriceChange:!1,currentValue:{},currentValueKey:0,formData:{price:"",price1:"",price2:"",is_sale:1,day:[n()(),n()().add(3,"month").subtract(1,"days")],salePriceType:1}}},computed:{ruleName:function(){return this.rule.title}},methods:{moment:n.a,openModal:function(e){console.log(e);var t=e.rule;this.rule=t,this.getPriceList(),this.visible=!0},getPriceList:function(){var e=this;this.priceList={};var t=n()().subtract(1,"days"),a=n()().add(3,"month").subtract(1,"days"),i=a.diff(t,"days");if(this.rule.price_calendar&&this.rule.price_calendar.length){var r=this.rule.price_calendar.length;this.rule.price_calendar.forEach((function(t){var a=n()(t.day),i=a.unix();e.priceList[i]={price:t.price,is_sale:t.is_sale,day:t.day}}));for(var s=n()(this.rule.price_calendar[r-1].day),c=a.diff(s,"days"),l=0;l<c;l++){var o=n()().add(l,"day").format("YYYY-MM-DD");o=n()(o);var h=o.unix();this.priceList[h]||(this.priceList[h]={price:this.rule.price,is_sale:1,day:o.format("YYYY-MM-DD")})}}else for(var d=0;d<i;d++){var u=n()().add(d,"day"),p=u.format("YYYY-MM-DD"),f=n()(p).unix();this.priceList[f]={price:this.rule.price,is_sale:1,day:p}}},handleSubmit:function(){this.$emit("getPriceList",{priceList:this.priceList}),this.handleCancel()},handleCancel:function(){this.visible=!1},handlePriceCancel:function(){this.formData=this.$options.data().formData,this.editVisiable=!1},headerRender:function(e){for(var t=this,a=e.value,i=(e.type,e.onChange),r=(e.onTypeChange,this.$createElement),s=0,c=12,n=[],l=a.clone(),o=a.localeData(),h=[],d=0;d<12;d++)l.month(d),h.push(o.monthsShort(l));for(var u=s;u<c;u++)n.push(r("a-select-option",{class:"month-item",key:"".concat(u)},[h[u]]));for(var p=a.month(),f=a.year(),m=[],y=f-1;y<f+2;y+=1)m.push(r("a-select-option",{key:y,attrs:{value:y},class:"year-item"},[y]));var v=this.rule.title;return r("div",{style:{padding:"10px"}},[r("a-row",{attrs:{type:"flex",justify:"space-between"}},[r("a-col",[r("a-select",{attrs:{dropdownMatchSelectWidth:!1,value:String(f)},on:{change:function(e){var t=a.clone().year(e);i(t)}}},[m]),r("a-select",{style:{marginLeft:"10px"},attrs:{dropdownMatchSelectWidth:!1,value:String(p)},on:{change:function(e){var t=a.clone();t.month(parseInt(e,10)),i(t)}}},[n])]),r("a-col",[v]),r("a-col",[r("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.editPrice()}}},["批量设置"])])])])},disabledDate:function(e){return e.isBefore(n()().subtract(1,"days"))||e.isAfter(n()().add(3,"month").subtract(1,"days"))},showPrice:function(e){var t=n()(e.format("YYYY-MM-DD")).unix();return this.priceList&&this.priceList[t]},editPrice:function(e){e?(this.dayPriceChange=!0,this.currentValueKey=n()(e.format("YYYY-MM-DD")).unix(),this.currentValue=this.priceList[this.currentValueKey],this.formData.price=this.currentValue.price,this.formData.is_sale=this.currentValue.is_sale):this.dayPriceChange=!1,this.editVisiable=!0},handlePriceChange:function(){if(console.log(this.formData),!this.dayPriceChange&&(this.dayPriceChange||1!=this.formData.salePriceType)||""!==this.formData.price&&null!=this.formData.price){if(this.dayPriceChange)this.currentValue.price=this.formData.price,this.currentValue.is_sale=this.formData.is_sale,this.$set(this.priceList,this.currentValueKey,this.currentValue);else{if(2==this.formData.salePriceType&&(""===this.formData.price1||""===this.formData.price2))return void this.$message.error("请输入两个售卖价格");if(!this.formData.day.length)return void this.$message.error("请选择生效时间");var e=[],t=[];2==this.formData.salePriceType&&this.weekArr.forEach((function(a){a.check1?e.push(a.key):t.push(a.key)}));var a=this.formData.day[0].format("YYYY-MM-DD"),i=this.formData.day[1].format("YYYY-MM-DD");for(var r in this.priceList){var s=this.priceList[r];if(n()(s.day).isBetween(a,i,null,"[]")){if(1==this.formData.salePriceType)s.price=this.formData.price,s.is_sale=this.formData.is_sale;else{var c=n()(s.day).weekday();e.includes(c)?s.price=this.formData.price1:s.price=this.formData.price2,s.is_sale=this.formData.is_sale}this.$set(this.priceList,r,s)}}}this.handlePriceCancel()}else this.$message.error("请输入售卖价格")},weekCheckChange:function(e,t,a){var i=this.weekArr[a];1==t?i.check2=!e:i.check1=!e,this.$set(this.weekArr,a,i)}}},o=l,h=(a("976d"),a("2877")),d=Object(h["a"])(o,i,r,!1,null,"2ddb0357",null);t["default"]=d.exports}}]);