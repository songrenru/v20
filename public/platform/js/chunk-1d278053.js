(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1d278053","chunk-16347360"],{"40d3":function(e,t,a){"use strict";a("d667")},"5db9":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lane_management"},[a("div",{staticClass:"header_search"},[a("a-collapse",{attrs:{accordion:""}},[a("a-collapse-panel",{key:"1",attrs:{header:"操作说明"}},[e._v(" 每个通道二维码可自行打印出来，张贴在对应的通道处"),a("br"),e._v(" 入口二维码：用于无牌车扫码登记进入。"),a("br"),e._v(" 出口二维码：用户车辆到达出口扫码付费时，系统会自动快速读取当前车辆的车牌号，免输入，方便快捷。"),a("br")])],1)],1),a("div",{staticClass:"header_search",staticStyle:{"padding-top":"0"}},[a("a-button",{attrs:{type:"primary"},on:{click:e.addThis}},[e._v("添加车道")])],1),a("div",{staticClass:"table_content"},[a("a-table",{attrs:{columns:e.columns,"row-key":function(e){return e.id},pagination:e.pageInfo,loading:e.tableLoadding,"data-source":e.laneList},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"passage_direction",fn:function(t,n){return a("span",{},[a("span",[e._v(e._s(0==n.passage_direction?"出口":1==n.passage_direction?"入口":"出入口"))])])}},{key:"status",fn:function(t,n){return a("span",{},[a("span",[e._v(e._s(0==n.status?"开启":"关闭"))])])}},{key:"action",fn:function(t,n){return a("span",{},["D3"==n.park_sys_type?a("a",{on:{click:function(t){return e.manualLiftingrod(n)}}},[e._v("手动抬杆")]):e._e(),"D3"==n.park_sys_type?a("a-divider",{attrs:{type:"vertical"}}):e._e(),a("a",{on:{click:function(t){return e.lookErcode(n)}}},[e._v(e._s(1==n.passage_direction?"查看入口二维码":"查看出口二维码"))]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(t){return e.editThis(n)}}},[e._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-popconfirm",{attrs:{title:"确定要删除该项吗?","ok-text":"是","cancel-text":"否"},on:{confirm:function(t){return e.delConfirm(n)},cancel:e.delCancel}},[a("a",{staticStyle:{color:"red"}},[e._v("删除")])])],1)}}])}),a("lane-model",{attrs:{lane_id:e.lane_id,lane_type:e.lane_type,visible:e.laneVisible,modelTitle:e.modelTitle},on:{closeLane:e.closeLane}}),a("a-modal",{attrs:{title:e.codeTitle,width:500,visible:e.erCodeVisible,footer:null},on:{ok:e.handleCodeOk,cancel:e.handleCodeCancel}},[a("div",{staticStyle:{width:"100%",display:"flex","justify-content":"center","align-items":"center"}},[a("img",{staticStyle:{width:"150px",height:"150px"},attrs:{src:e.ercodeUrl}})])])],1)])},i=[],s=a("f018"),l=a("a0e0"),r=[{title:"车道名称",dataIndex:"passage_name",key:"passage_name",width:200},{title:"所属区域",dataIndex:"area_name",key:"area_name"},{title:"车道类型",key:"passage_direction",scopedSlots:{customRender:"passage_direction"}},{title:"车道状态",dataIndex:"status_txt",key:"status_txt"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],o={data:function(){return{codeTitle:"",parklotName:"",columns:r,laneVisible:!1,selectedRowKeys:[],modelTitle:"",erCodeVisible:!1,tableLoadding:!1,pageInfo:{page:1,current:1,pageSize:20,total:0},laneList:[],lane_type:"add",lane_id:"",ercodeUrl:""}},components:{laneModel:s["default"]},mounted:function(){this.getLaneList()},methods:{manualLiftingrod:function(e){var t=this;t.request(l["a"].open_gate,{id:e.id}).then((function(e){"0"!=e?t.$message.success("抬杆成功！"):t.$message.error("抬杆失败！")}))},editThis:function(e){this.modelTitle="编辑车道",this.lane_type="edit",this.laneVisible=!0,this.lane_id=e.id+""},delConfirm:function(e){var t=this;t.request(l["a"].delPassage,{id:e.id}).then((function(e){t.$message.success("删除成功！"),t.getLaneList()}))},getLaneList:function(){var e=this;e.tableLoadding=!0,e.request(l["a"].getPassageList,e.pageInfo).then((function(t){e.laneList=t.list,e.pageInfo.total=t.count,e.tableLoadding=!1})).catch((function(t){e.tableLoadding=!1}))},delCancel:function(){},closeLane:function(e){this.lane_id="",this.laneVisible=!1,e&&this.getLaneList()},addThis:function(){this.modelTitle="添加车道",this.lane_type="add",this.laneVisible=!0},lookErcode:function(e){var t=this;1==e.passage_direction?this.codeTitle="查看入口二维码":this.codeTitle="查看出口二维码",t.request(l["a"].getQrcodePassage,{passage_id:e.id}).then((function(e){t.ercodeUrl=e.qrcode,t.erCodeVisible=!0}))},handleCodeOk:function(){this.erCodeVisible=!1},handleCodeCancel:function(){this.ercodeUrl="",this.erCodeVisible=!1},handleTableChange:function(e,t,a){this.pageInfo.current=e.current,this.pageInfo.page=e.current,this.getLaneList()}}},c=o,d=(a("7928"),a("2877")),u=Object(d["a"])(c,n,i,!1,null,"79dac17a",null);t["default"]=u.exports},7928:function(e,t,a){"use strict";a("b294")},b294:function(e,t,a){},d667:function(e,t,a){},f018:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lane_model_container"},[a("a-drawer",{attrs:{title:e.modelTitle,width:1e3,visible:e.visible},on:{close:e.handleSubCancel}},[a("a-form-model",{ref:"ruleForm",attrs:{model:e.laneForm,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("div",{staticClass:"add_lane"},[a("a-form-model-item",{attrs:{label:"通道名称",prop:"passage_name"}},[a("a-input",{attrs:{placeholder:"请输入通道名称"},model:{value:e.laneForm.passage_name,callback:function(t){e.$set(e.laneForm,"passage_name",t)},expression:"laneForm.passage_name"}})],1),a("a-form-model-item",{attrs:{label:"归属区域",prop:"passage_area"}},[a("a-select",{staticStyle:{width:"200px"},attrs:{"show-search":"",placeholder:"请选择","filter-option":e.filterOption,value:e.laneForm.passage_area},on:{change:e.handleSelectChange}},e._l(e.areaList,(function(t,n){return a("a-select-option",{attrs:{value:t.id}},[e._v(" "+e._s(t.garage_num)+" ")])})),1)],1),a("a-form-model-item",{attrs:{label:"通道号",prop:"channel_number"}},[a("a-input",{attrs:{placeholder:"请上输入通道号"},model:{value:e.laneForm.channel_number,callback:function(t){e.$set(e.laneForm,"channel_number",t)},expression:"laneForm.channel_number"}})],1),a("a-form-model-item",{attrs:{label:"请填写设备编号",prop:"device_number"}},[a("a-input",{attrs:{placeholder:"请填写设备编号"},model:{value:e.laneForm.device_number,callback:function(t){e.$set(e.laneForm,"device_number",t)},expression:"laneForm.device_number"}})],1),a("a-form-model-item",{attrs:{label:"通道类型",prop:"passage_direction"}},[a("a-radio-group",{attrs:{name:"radioGroup","default-value":1},model:{value:e.laneForm.passage_direction,callback:function(t){e.$set(e.laneForm,"passage_direction",t)},expression:"laneForm.passage_direction"}},[a("a-radio",{attrs:{value:1}},[e._v("入口")]),a("a-radio",{attrs:{value:0}},[e._v("出口")])],1)],1),a("a-form-model-item",{attrs:{label:"通道坐标",prop:"long_lat"}},[a("a-input",{staticStyle:{width:"200px"},attrs:{disabled:!0},model:{value:e.laneForm.long_lat,callback:function(t){e.$set(e.laneForm,"long_lat",t)},expression:"laneForm.long_lat"}}),a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(t){return e.openMap()}}},[e._v("点击获取经纬度")])],1),a("a-form-model-item",{attrs:{label:"标签",prop:"current"}},[a("a-transfer",{attrs:{locale:{itemUnit:"【已选】",itemsUnit:"【全部】",notFoundContent:"列表为空",searchPlaceholder:"请输入搜索内容"},"show-search":"",rowKey:function(e){return e.key},"data-source":e.labelList,"list-style":{width:"210px",height:"270px"},render:e.renderItem,"show-select-all":!0,"target-keys":e.targetKeys},on:{change:e.handleTransferChange}})],1),a("a-form-model-item",{attrs:{label:"通道状态",prop:"status"}},[a("a-radio-group",{attrs:{name:"radioGroup","default-value":1},model:{value:e.laneForm.status,callback:function(t){e.$set(e.laneForm,"status",t)},expression:"laneForm.status"}},[a("a-radio",{attrs:{value:1}},[e._v("开启")]),a("a-radio",{attrs:{value:2}},[e._v("关闭")])],1)],1)],1),a("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right",zIndex:1}},[a("a-button",{style:{marginRight:"8px"},on:{click:e.handleSubCancel}},[e._v("取消")]),a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit()}}},[e._v("提交")])],1)])],1),e.mapVisible?a("a-modal",{attrs:{title:"百度地图拾取经纬度",visible:e.mapVisible,width:800},on:{ok:e.handleMapOk,cancel:e.handleMapCancel}},[a("a-input",{staticClass:"input_style",staticStyle:{width:"200px"},attrs:{type:"text",id:"suggestId",name:"address_detail",placeholder:"请输入城市名/地区名"},model:{value:e.address_detail,callback:function(t){e.address_detail=t},expression:"address_detail"}}),a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.searchMap}},[e._v("搜索")]),a("div",{staticStyle:{width:"100%",height:"500px","margin-top":"10px"},attrs:{id:"allmap"}})],1):e._e()],1)},i=[],s=(a("5cad"),a("7b2d")),l=(a("ac1f"),a("1276"),a("d81d"),a("841c"),a("c1df")),r=a.n(l),o=(a("8bbf"),a("a0e0")),c={props:{visible:{type:Boolean,default:!1},modelTitle:{type:String,default:""},lane_type:{type:String,default:""},lane_id:{type:String,default:""}},watch:{lane_id:{immediate:!0,handler:function(e){"edit"==this.lane_type&&this.getLaneInfo()}}},data:function(){return{labelCol:{span:4},wrapperCol:{span:14},laneForm:{long_lat:"",passage_area:"",status:1,passage_direction:1},rules:{passage_name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],channel_number:[{required:!0,message:"请输入通道号",trigger:"blur"}]},dateFormat:"YYYY-MM-DD",selectedKeys:[],targetKeys:[],labelList:[],mapVisible:!1,address_detail:"北京",userlocation:{lng:"",lat:""},userLng:"",userLat:"",areaList:[]}},mounted:function(){this.getLabelList(),this.getAreaList()},components:{"a-transfer":s["a"]},methods:{clearForm:function(){this.laneForm={long_lat:"",passage_area:"",status:1,passage_direction:1},this.targetKeys=[]},getAreaList:function(){var e=this;e.request(o["a"].getAreaList,{}).then((function(t){e.areaList=t.list}))},moment:r.a,handleSubmit:function(e){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return console.log("error submit!!"),t.confirmLoading=!1,!1;var a=t,n=o["a"].addPassage;"edit"==t.lane_type&&(n=o["a"].editPassage),a.request(n,a.laneForm).then((function(e){"edit"==t.lane_type?a.$message.success("编辑成功！"):a.$message.success("添加成功！"),t.$emit("closeLane",!0),t.clearForm(),t.confirmLoading=!1})).catch((function(e){t.confirmLoading=!1}))}))},handleSubCancel:function(e){this.$refs.ruleForm.resetFields(),this.$emit("closeLane",!1),this.clearForm()},getLaneInfo:function(){var e=this;e.lane_id&&e.request(o["a"].getPassageInfo,{id:this.lane_id}).then((function(t){e.laneForm=t,e.laneForm.passage_area=1*t.passage_area||"",e.laneForm.long_lat=t.lat+","+t.long,e.targetKeys=t.passage_label.split(",")}))},getLabelList:function(){var e=this;e.request(o["a"].getPassageLabelList,{}).then((function(t){e.labelList=[],t.map((function(t){e.labelList.push({key:t.id+"",title:t.label_name})}))}))},handleSelectChange:function(e){var t=this;this.laneForm.passage_area=1*e,this.areaList.map((function(a){a.id==e&&(t.laneForm.area_type=a.area_type)})),this.$forceUpdate(),console.log("selected ".concat(e))},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},onDateChange:function(e,t){console.log(e,t)},renderItem:function(e){var t=this.$createElement,a=t("span",{class:"custom-item"},[e.title]);return{label:a,value:e.title}},handleTransferChange:function(e,t,a){var n=this;this.targetKeys=e;var i="";this.targetKeys.map((function(e,t){t<n.targetKeys.length-1?i+=e+",":i+=e})),this.laneForm.passage_label=i},handleMapOk:function(){this.laneForm.long_lat=this.userLat+","+this.userLng,this.mapVisible=!1},handleMapCancel:function(){this.mapVisible=!1},openMap:function(){this.mapVisible=!0,this.initMap()},searchMap:function(){this.address_detail&&this.initMap()},initMap:function(){this.$nextTick((function(){var e=this,t=new BMap.Map("allmap");t.centerAndZoom(e.address_detail,15),t.enableScrollWheelZoom();var a,n=new BMap.Autocomplete({input:"suggestId",location:t});function i(){function n(){e.userlocation=i.getResults().getPoi(0).point,t.centerAndZoom(e.userlocation,18),t.addOverlay(new BMap.Marker(e.userlocation)),e.userLng=e.userlocation.lng,e.userLat=e.userlocation.lat}t.clearOverlays();var i=new BMap.LocalSearch(t,{onSearchComplete:n});i.search(a),t.addEventListener("click",(function(){}))}n.addEventListener("onconfirm",(function(t){var n=t.item.value;a=n.province+n.city+n.district+n.street+n.business,e.address_detail=a,i()})),t.addEventListener("click",(function(a){t.clearOverlays(),t.addOverlay(new BMap.Marker(a.point));var n={width:180,height:60},i=new BMap.InfoWindow("所选位置",n);t.openInfoWindow(i,a.point),e.userLng=a.point.lng,e.userLat=a.point.lat}))}))}}},d=c,u=(a("40d3"),a("2877")),p=Object(u["a"])(d,n,i,!1,null,"1b1909f8",null);t["default"]=p.exports}}]);