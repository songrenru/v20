(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-52a66054","chunk-2d0b6a79"],{"1da1":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r("d3b7");function i(e,t,r,i,o,n,a){try{var s=e[n](a),l=s.value}catch(c){return void r(c)}s.done?t(l):Promise.resolve(l).then(i,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,n){var a=e.apply(t,r);function s(e){i(a,o,n,s,l,"next",e)}function l(e){i(a,o,n,s,l,"throw",e)}s(void 0)}))}}},"4e18":function(e,t,r){},e087:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-drawer",{attrs:{title:"添加工单",placement:"right",closable:!1,visible:e.workVisible,width:900},on:{close:e.onClose}},[r("a-form-model",{ref:"ruleForm",attrs:{model:e.workerForm,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[e.workVisible?r("a-form-model-item",{attrs:{label:"对应位置",prop:"address_id"}},[r("a-select",{staticStyle:{width:"120px"},attrs:{"show-search":"",placeholder:"请选择"},on:{change:function(t){return e.housePositionChange1(t,0)}}},e._l(e.housePositionList,(function(t,i){return r("a-select-option",{attrs:{value:t.name}},[e._v(" "+e._s(t.name)+" ")])})),1),0!=e.positionChild1.length?r("a-select",{staticStyle:{width:"120px"},attrs:{"show-search":"",placeholder:"请选择"},on:{change:function(t){return e.housePositionChange1(t,1)}}},e._l(e.positionChild1,(function(t,i){return r("a-select-option",{attrs:{value:t.name}},[e._v(" "+e._s(t.name)+" ")])})),1):e._e(),0!=e.positionChild2.length?r("a-select",{staticStyle:{width:"120px"},attrs:{"show-search":"",placeholder:"请选择"},on:{change:function(t){return e.housePositionChange1(t,2)}}},e._l(e.positionChild2,(function(t,i){return r("a-select-option",{attrs:{value:t.name}},[e._v(" "+e._s(t.name)+" ")])})),1):e._e(),0!=e.positionChild3.length?r("a-select",{staticStyle:{width:"120px"},attrs:{"show-search":"",placeholder:"请选择"},on:{change:function(t){return e.housePositionChange1(t,3)}}},e._l(e.positionChild3,(function(t,i){return r("a-select-option",{attrs:{value:t.name}},[e._v(" "+e._s(t.name)+" ")])})),1):e._e()],1):e._e(),r("a-form-model-item",{attrs:{label:"工单类目",prop:"cat_fid"}},[r("a-select",{attrs:{value:e.workerForm.cat_fid,placeholder:"请选择工单类目"},on:{change:function(t){return e.handleSelectChange(t,"cat_fid")}}},e._l(e.orderCategory,(function(t,i){return r("a-select-option",{attrs:{value:t.category_id}},[e._v(" "+e._s(t.subject_name)+" ")])})),1)],1),r("a-form-model-item",{attrs:{label:"工单分类",prop:"cat_id"}},[r("a-select",{attrs:{value:e.workerForm.cat_id,placeholder:"请选择工单分类"},on:{change:function(t){return e.handleSelectChange(t,"cat_id")}}},e._l(e.orderClassification,(function(t,i){return r("a-select-option",{attrs:{value:t.cat_id}},[e._v(" "+e._s(t.cate_name)+" ")])})),1)],1),r("a-form-model-item",{attrs:{label:"标签",prop:"label_txt"}},[r("a-transfer",{attrs:{locale:{itemUnit:"【已选】",itemsUnit:"【全部】",notFoundContent:"列表为空",searchPlaceholder:"请输入搜索内容"},"show-search":"",rowKey:function(e){return e.key},"data-source":e.labelList,"list-style":{width:"200px",height:"270px"},render:e.renderItem,"show-select-all":!0,"target-keys":e.targetKeys},on:{change:e.handleTransferChange}})],1),r("a-form-model-item",{attrs:{label:"补充内容",prop:"order_content"}},[r("a-textarea",{staticStyle:{padding:"5px width:200px",height:"100px",resize:"none"},attrs:{placeholder:"请输入"},model:{value:e.workerForm.order_content,callback:function(t){e.$set(e.workerForm,"order_content",t)},expression:"workerForm.order_content"}})],1),e.workVisible?r("a-form-model-item",{attrs:{label:"",prop:"order_imgs"}},[r("a-upload",{staticStyle:{transform:"translateX(140px)"},attrs:{action:"/v20/public/index.php/community/village_api.ContentEngine/uploadFile","list-type":"picture-card","file-list":e.fileList,"before-upload":e.beforeUpload},on:{preview:e.handlePreview,change:e.handleUploadChange}},[e.fileList.length<8?r("div",[r("a-icon",{attrs:{type:"plus"}}),r("div",{staticClass:"ant-upload-text"},[e._v(" Upload ")])],1):e._e()]),r("div",{staticClass:"desc",staticStyle:{transform:"translateX(140px)"}},[e._v(" 已上传"+e._s(e.fileList.length)+"张, 最多可上传8张 ")]),r("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:e.handleCancel}},[r("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})])],1):e._e(),e.workVisible?r("a-form-model-item",{attrs:{label:"上门时间",prop:"go_time"}},[r("a-date-picker",{on:{change:e.onDateChange}}),r("a-time-picker",{staticStyle:{"margin-left":"10px"},on:{change:e.onTimeChange}})],1):e._e(),r("a-form-model-item",{attrs:{"wrapper-col":{span:14,offset:4}}},[r("a-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v(" 提交 ")])],1)],1)],1)},o=[],n=r("1da1"),a=(r("5cad"),r("7b2d")),s=(r("96cf"),r("d3b7"),r("a630"),r("3ca3"),r("6062"),r("ddb0"),r("d81d"),r("b0c0"),r("8bbf"),r("a0e0"));function l(e){return new Promise((function(t,r){var i=new FileReader;i.readAsDataURL(e),i.onload=function(){return t(i.result)},i.onerror=function(e){return r(e)}}))}var c={props:{workVisible:{type:Boolean,default:!1}},components:{"a-transfer":a["a"]},data:function(){return{workerForm:{address_id:"",cat_id:"",cat_fid:"",go_time:""},labelCol:{span:4},wrapperCol:{span:14},rules:{cat_fid:[{required:!0,message:"请选择工单类目",trigger:"blur"}],cat_id:[{required:!0,message:"请选择工单类目",trigger:"blur"}],order_content:[{required:!0,message:"请输入补充内容",trigger:"blur"}],address_id:[{required:!1,message:"请选择位置",trigger:"blur"}],go_time:[{required:!1,message:"请选择上门时间",trigger:"blur"}]},previewVisible:!1,previewImage:"",fileList:[],options:[],targetKeys:[],labelList:[],orderCategory:[],orderClassification:[],housePositionList:[],positionChild1:[],positionChild2:[],positionChild3:[],timeStr:""}},mounted:function(){this.getHousePosition(),this.getSubject()},methods:{onTimeChange:function(e,t){this.timeStr=t,console.log("timeString===>",t)},onSubmit:function(){var e=this,t=this;""==t.timeStr||""==t.workerForm.go_time?t.workerForm.go_time="":t.workerForm.go_time=t.workerForm.go_time+" "+t.timeStr,t.$refs.ruleForm.validate((function(r){if(!r)return console.log("error submit!!"),!1;t.request(s["a"].repairOrderAdd,t.workerForm).then((function(r){t.$message.success("添加成功！"),e.clearForm(),e.$refs.ruleForm.resetFields(),e.$emit("closeWorker",!0)}))}))},resetForm:function(){this.clearForm(),this.$refs.ruleForm.resetFields(),this.$emit("closeWorker",!1)},onClose:function(){this.clearForm(),this.$refs.ruleForm.resetFields(),this.$emit("closeWorker",!1)},uniqueKey:function(e){return Array.from(new Set(e))},handleCancel:function(){this.previewVisible=!1},housePositionChange1:function(e,t){var r=this;console.log(e,t),0==t?(r.positionChild1=[],r.positionChild2=[],r.positionChild3=[],r.housePositionList.map((function(i){i.name==e&&"public"!=i.type?(r.workerForm.address_type=i.type,r.workerForm.address_id=i.id,r.getHousePositionChidren(i.id,i.type,t)):i.name==e&&"public"==i.type&&(r.workerForm.address_type=i.type,r.workerForm.address_id=i.id)}))):1==t?(r.positionChild2=[],r.positionChild3=[],r.positionChild1.map((function(i){i.name==e&&"public"!=i.type?(r.workerForm.address_type=i.type,r.workerForm.address_id=i.id,r.getHousePositionChidren(i.id,i.type,t)):i.name==e&&"public"==i.type&&(r.workerForm.address_type=i.type,r.workerForm.address_id=i.id)}))):2==t?(r.positionChild3=[],r.positionChild2.map((function(i){i.name==e&&"public"!=i.type?(r.workerForm.address_type=i.type,r.workerForm.address_id=i.id,r.getHousePositionChidren(i.id,i.type,t)):i.name==e&&"public"==i.type&&(r.workerForm.address_type=i.type,r.workerForm.address_id=i.id)}))):3==t&&r.positionChild3.map((function(t){t.name==e&&(r.workerForm.address_type=t.type,r.workerForm.address_id=t.id)}))},handlePreview:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.url||e.preview){r.next=4;break}return r.next=3,l(e.originFileObj);case 3:e.preview=r.sent;case 4:t.previewImage=e.url||e.preview,t.previewVisible=!0;case 6:case"end":return r.stop()}}),r)})))()},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;t||this.$message.error("You can only upload JPG file!");var r=e.size/1024/1024<2;return r||this.$message.error("Image must smaller than 2MB!"),t&&r},handleUploadChange:function(e){var t=e.fileList,r=this;r.fileList=t,r.workerForm.order_imgs=[],r.fileList.map((function(e){e.response&&e.response.data&&e.response.data.url&&r.workerForm.order_imgs.push(e.response.data.url)}))},handleSelectChange:function(e,t){this.workerForm[t]=e,this.$forceUpdate(),"cat_fid"==t?(this.workerForm.cat_id="",this.getRepairCate(e)):"cat_id"==t&&(this.labelList=[],this.targetKeys=[],this.getLabel(e))},renderItem:function(e){var t=this.$createElement,r=t("span",{class:"custom-item"},[e.title]);return{label:r,value:e.title}},handleTransferChange:function(e,t,r){this.targetKeys=e,this.workerForm.label_txt=e},clearForm:function(){this.positionChild1=[],this.positionChild2=[],this.positionChild3=[],this.labelList=[],this.workerForm={cat_id:"",cat_fid:"",go_time:""},this.targetKeys=[],this.fileList=[],this.timeStr=""},getLabelList:function(){var e=this;e.request(s["a"].getLabelList,{}).then((function(t){e.labelList=[],t.list.map((function(t){e.labelList.push({key:t.id+"",title:t.label_name})}))}))},getHousePosition:function(){var e=this;e.request(s["a"].getHousePosition,{}).then((function(t){e.housePositionList=t}))},getHousePositionChidren:function(e,t,r){var i=this;i.request(s["a"].getHousePositionChidren,{id:e,type:t}).then((function(e){0==r?i.positionChild1=e:1==r?i.positionChild2=e:2==r&&(i.positionChild3=e)}))},getSubject:function(){var e=this;this.request(s["a"].getSubjectOrders,{}).then((function(t){e.orderCategory=t}))},getRepairCate:function(e){var t=this;this.request(s["a"].getRepairCate,{subject_id:e}).then((function(e){t.orderClassification=e}))},getLabel:function(e){var t=this;this.request(s["a"].getLabel,{cat_id:e}).then((function(e){e.map((function(e){t.labelList.push({key:e.id+"",title:e.name})}))}))},onDateChange:function(e,t){this.workerForm.go_time=t}}},d=c,u=(r("ecbe"),r("2877")),h=Object(u["a"])(d,i,o,!1,null,"44e81006",null);t["default"]=h.exports},ecbe:function(e,t,r){"use strict";r("4e18")}}]);