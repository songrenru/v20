(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-28064696"],{"976d":function(e,t,a){"use strict";a("e134")},e134:function(e,t,a){},f9cd:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{title:"价格日历",width:840,visible:e.visible,destroyOnClose:""},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("div",{staticClass:"container"},[t("calendar",{attrs:{validRange:[e.moment(),e.moment().add(3,"month").subtract(1,"days")],headerRender:e.headerRender},scopedSlots:e._u([{key:"dateCellRender",fn:function(a){return[e.showPrice(a)?t("div",{staticClass:"date-cell"},[t("span",[e._v(e._s(e.priceList[e.moment(a.format("YYYY-MM-DD")).unix()].price))]),a.isAfter(e.moment().subtract(1,"days"))?t("a-icon",{staticClass:"edit",attrs:{type:"form"},on:{click:function(t){return t.stopPropagation(),e.editPrice(a)}}}):e._e()],1):e._e()]}}])})],1)]),t("a-modal",{attrs:{title:"编辑价格",width:650,visible:e.editVisiable,centered:"",destroyOnClose:""},on:{ok:e.handlePriceChange,cancel:e.handlePriceCancel}},[t("div",{staticClass:"edit-price"},[t("a-row",{attrs:{gutter:e.gutter}},[t("a-col",{attrs:{span:e.span.left}},[e._v(" 门票名称：")]),t("a-col",{attrs:{span:e.span.right}},[t("span",[e._v(e._s(e.ruleName))])])],1),t("a-row",{attrs:{gutter:e.gutter}},[t("a-col",{attrs:{span:e.span.left}},[e._v(" 生效时间：")]),t("a-col",{attrs:{span:e.span.right}},[e.dayPriceChange?t("span",[e._v(e._s(e.currentValue.day))]):t("a-range-picker",{staticStyle:{width:"300px"},attrs:{"disabled-date":e.disabledDate},model:{value:e.formData.day,callback:function(t){e.$set(e.formData,"day",t)},expression:"formData.day"}})],1)],1),t("a-row",{attrs:{gutter:e.gutter}},[t("a-col",{attrs:{span:e.span.left}},[e._v(" 售卖价格：")]),e.dayPriceChange?t("a-col",{attrs:{span:e.span.right}},[t("a-input-number",{staticStyle:{width:"300px"},attrs:{min:0,placeholder:"请输入价格"},model:{value:e.formData.price,callback:function(t){e.$set(e.formData,"price",t)},expression:"formData.price"}})],1):t("a-col",{attrs:{span:e.span.right}},[t("a-radio-group",{model:{value:e.formData.salePriceType,callback:function(t){e.$set(e.formData,"salePriceType",t)},expression:"formData.salePriceType"}},[t("a-radio",{attrs:{value:1}},[e._v(" 每天统一价格 ")]),t("a-radio",{attrs:{value:2}},[e._v(" 在周内设置不同价格 ")])],1),t("div",{staticClass:"mt-10"},[1==e.formData.salePriceType?t("a-input-number",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入价格",min:0},model:{value:e.formData.price,callback:function(t){e.$set(e.formData,"price",t)},expression:"formData.price"}}):t("div",[t("div",[t("a-input-number",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:"请输入价格",min:0},model:{value:e.formData.price1,callback:function(t){e.$set(e.formData,"price1",t)},expression:"formData.price1"}}),e._l(e.weekArr,(function(a,r){return t("a-checkable-tag",{key:a.key,on:{change:function(t){return e.weekCheckChange(t,"1",r)}},model:{value:a.check1,callback:function(t){e.$set(a,"check1",t)},expression:"item.check1"}},[e._v(" "+e._s(a.title)+" ")])}))],2),t("div",{staticClass:"mt-10"},[t("a-input-number",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{min:0,placeholder:"请输入价格"},model:{value:e.formData.price2,callback:function(t){e.$set(e.formData,"price2",t)},expression:"formData.price2"}}),e._l(e.weekArr,(function(a,r){return t("a-checkable-tag",{key:a.key,on:{change:function(t){return e.weekCheckChange(t,"2",r)}},model:{value:a.check2,callback:function(t){e.$set(a,"check2",t)},expression:"item.check2"}},[e._v(" "+e._s(a.title)+" ")])}))],2)])],1)],1)],1),t("a-row",{attrs:{gutter:e.gutter}},[t("a-col",{attrs:{span:e.span.left}},[e._v(" 是否售卖：")]),t("a-col",{attrs:{span:e.span.right}},[t("a-radio-group",{model:{value:e.formData.is_sale,callback:function(t){e.$set(e.formData,"is_sale",t)},expression:"formData.is_sale"}},[t("a-radio",{attrs:{value:1}},[e._v(" 售卖 ")]),t("a-radio",{attrs:{value:0}},[e._v(" 停售 ")])],1)],1)],1)],1)])],1)},i=[];function s(e){throw new TypeError('"'+e+'" is read-only')}a("00b5");var c=a("e889"),n=(a("c5cb"),a("08c7"),a("5532"),a("2f42")),l=a.n(n),o={name:"GroupPriceCalendar",components:{Calendar:c["a"]},props:{},data:function(){return{gutter:[10,10],span:{left:4,right:20},visible:!1,rule:{},editVisiable:!1,priceList:{},weekArr:[{title:"周一",check1:!0,check2:!1,key:0},{title:"周二",check1:!0,check2:!1,key:1},{title:"周三",check1:!0,check2:!1,key:2},{title:"周四",check1:!0,check2:!1,key:3},{title:"周五",check1:!0,check2:!1,key:4},{title:"周六",check1:!0,check2:!1,key:5},{title:"周日",check1:!0,check2:!1,key:6}],dayPriceChange:!1,currentValue:{},currentValueKey:0,formData:{price:"",price1:"",price2:"",is_sale:1,day:[l()(),l()().add(3,"month").subtract(1,"days")],salePriceType:1}}},computed:{ruleName:function(){return this.rule.title}},methods:{moment:l.a,openModal:function(e){console.log(e);var t=e.rule;this.rule=t,this.getPriceList(),this.visible=!0},getPriceList:function(){var e=this;this.priceList={};var t=l()().subtract(1,"days"),a=l()().add(3,"month").subtract(1,"days"),r=a.diff(t,"days");if(this.rule.price_calendar&&this.rule.price_calendar.length){var i=this.rule.price_calendar.length;this.rule.price_calendar.forEach((function(t){var a=l()(t.day),r=a.unix();e.priceList[r]={price:t.price,is_sale:t.is_sale,day:t.day}}));for(var c=l()(this.rule.price_calendar[i-1].day),n=a.diff(c,"days"),o=0;o<n;o++){var h=l()().add(o,"day").format("YYYY-MM-DD");l()(h),s("day2");var u=h.unix();this.priceList[u]||(this.priceList[u]={price:this.rule.price,is_sale:1,day:h.format("YYYY-MM-DD")})}}else for(var d=0;d<r;d++){var p=l()().add(d,"day"),f=p.format("YYYY-MM-DD"),m=l()(f).unix();this.priceList[m]={price:this.rule.price,is_sale:1,day:f}}},handleSubmit:function(){this.$emit("getPriceList",{priceList:this.priceList}),this.handleCancel()},handleCancel:function(){this.visible=!1},handlePriceCancel:function(){this.formData=this.$options.data().formData,this.editVisiable=!1},headerRender:function(e){for(var t=this,a=e.value,r=(e.type,e.onChange),i=(e.onTypeChange,this.$createElement),s=0,c=12,n=[],l=a.clone(),o=a.localeData(),h=[],u=0;u<12;u++)l.month(u),h.push(o.monthsShort(l));for(var d=s;d<c;d++)n.push(i("a-select-option",{class:"month-item",key:"".concat(d)},[h[d]]));for(var p=a.month(),f=a.year(),m=[],y=f-1;y<f+2;y+=1)m.push(i("a-select-option",{key:y,attrs:{value:y},class:"year-item"},[y]));var v=this.rule.title;return i("div",{style:{padding:"10px"}},[i("a-row",{attrs:{type:"flex",justify:"space-between"}},[i("a-col",[i("a-select",{attrs:{dropdownMatchSelectWidth:!1,value:String(f)},on:{change:function(e){var t=a.clone().year(e);r(t)}}},[m]),i("a-select",{style:{marginLeft:"10px"},attrs:{dropdownMatchSelectWidth:!1,value:String(p)},on:{change:function(e){var t=a.clone();t.month(parseInt(e,10)),r(t)}}},[n])]),i("a-col",[v]),i("a-col",[i("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.editPrice()}}},["批量设置"])])])])},disabledDate:function(e){return e.isBefore(l()().subtract(1,"days"))||e.isAfter(l()().add(3,"month").subtract(1,"days"))},showPrice:function(e){var t=l()(e.format("YYYY-MM-DD")).unix();return this.priceList&&this.priceList[t]},editPrice:function(e){e?(this.dayPriceChange=!0,this.currentValueKey=l()(e.format("YYYY-MM-DD")).unix(),this.currentValue=this.priceList[this.currentValueKey],this.formData.price=this.currentValue.price,this.formData.is_sale=this.currentValue.is_sale):this.dayPriceChange=!1,this.editVisiable=!0},handlePriceChange:function(){if(console.log(this.formData),!this.dayPriceChange&&(this.dayPriceChange||1!=this.formData.salePriceType)||""!==this.formData.price&&null!=this.formData.price){if(this.dayPriceChange)this.currentValue.price=this.formData.price,this.currentValue.is_sale=this.formData.is_sale,this.$set(this.priceList,this.currentValueKey,this.currentValue);else{if(2==this.formData.salePriceType&&(""===this.formData.price1||""===this.formData.price2))return void this.$message.error("请输入两个售卖价格");if(!this.formData.day.length)return void this.$message.error("请选择生效时间");var e=[],t=[];2==this.formData.salePriceType&&this.weekArr.forEach((function(a){a.check1?e.push(a.key):t.push(a.key)}));var a=this.formData.day[0].format("YYYY-MM-DD"),r=this.formData.day[1].format("YYYY-MM-DD");for(var i in this.priceList){var s=this.priceList[i];if(l()(s.day).isBetween(a,r,null,"[]")){if(1==this.formData.salePriceType)s.price=this.formData.price,s.is_sale=this.formData.is_sale;else{var c=l()(s.day).weekday();e.includes(c)?s.price=this.formData.price1:s.price=this.formData.price2,s.is_sale=this.formData.is_sale}this.$set(this.priceList,i,s)}}}this.handlePriceCancel()}else this.$message.error("请输入售卖价格")},weekCheckChange:function(e,t,a){var r=this.weekArr[a];1==t?r.check2=!e:r.check1=!e,this.$set(this.weekArr,a,r)}}},h=o,u=(a("976d"),a("0b56")),d=Object(u["a"])(h,r,i,!1,null,"2ddb0357",null);t["default"]=d.exports}}]);